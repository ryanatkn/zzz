import{o as Z,v as $,q as ee,au as te,av as se,k as c,i as r,l as u,a7 as D,p as F,f as G,d as g,r as v,s as U,b as h,c as H,e as k,a as w,h as A,u as ne,t as Q,j as I}from"./DsYFF3e0.js";import"./DsnmJJEf.js";import{c as V,a as N,e as ie,d as re,s as ae}from"./D6t6EFf3.js";import{p as oe,i as b}from"./Nwe5dM3j.js";import{k as O,C as le,S as L,t as ce,q as ue}from"./dRtQjgBD.js";import{s as me}from"./BlUH4YWX.js";import{i as he}from"./DPkzVgCT.js";import{c as B}from"./Cm6bndgw.js";function Me(o,e,t){Z(()=>{var s=$(()=>e(o,t?.())||{});if(t&&s?.update){var n=!1,m={};ee(()=>{var d=t();te(d),n&&se(m,d)&&(m=d,s.update(d))}),n=!0}if(s?.destroy)return()=>s.destroy()})}class J{#e=c(0);get width(){return r(this.#e)}set width(e){u(this.#e,e,!0)}#t=c(0);get height(){return r(this.#t)}set height(e){u(this.#t,e,!0)}}class de{is_menu=!1;menu;#e=c(!1);get selected(){return r(this.#e)}set selected(e){u(this.#e,e,!0)}#t=c();get run(){return r(this.#t)}set run(e){u(this.#t,e,!0)}#s=c(!1);get pending(){return r(this.#s)}set pending(e){u(this.#s,e,!0)}#n=c(null);get error_message(){return r(this.#n)}set error_message(e){u(this.#n,e,!0)}#i=c(null);get promise(){return r(this.#i)}set promise(e){u(this.#i,e,!0)}constructor(e,t){this.menu=e,this.run=t}}class _e{is_menu=!0;menu;depth;#e=c(!1);get selected(){return r(this.#e)}set selected(e){u(this.#e,e,!0)}#t=c(D([]));get items(){return r(this.#t)}set items(e){u(this.#t,e,!0)}constructor(e,t){this.menu=e,this.depth=t}}class fe{is_menu=!0;menu=null;depth=1;#e=c(D([]));get items(){return r(this.#e)}set items(e){u(this.#e,e,!0)}}class De{layout;initial_layout;#e=c(!1);get opened(){return r(this.#e)}set opened(e){u(this.#e,e,!0)}#t=c(0);get x(){return r(this.#t)}set x(e){u(this.#t,e,!0)}#s=c(0);get y(){return r(this.#s)}set y(e){u(this.#s,e,!0)}#n=c(D([]));get params(){return r(this.#n)}set params(e){u(this.#n,e,!0)}#i=c();get error(){return r(this.#i)}set error(e){u(this.#i,e,!0)}root_menu=new fe;#r=c(D([]));get selections(){return r(this.#r)}set selections(e){u(this.#r,e,!0)}constructor(e){this.initial_layout=e?.layout,this.layout=this.initial_layout??new J}open(e,t,s){this.selections.length=0,this.opened=!0,this.x=t,this.y=s,this.params=e}close(){this.opened&&(this.reset_items(this.root_menu.items),this.opened=!1)}reset_items(e){for(const t of e)t.is_menu?this.reset_items(t.items):(t.promise!==null&&(t.promise=null),t.error_message!==null&&(t.error_message=null))}activate(e){if(e.is_menu)this.expand_selected();else{let t;try{t=e.run()}catch(s){const n=typeof s?.message=="string"?s.message:void 0;e.error_message=n??"unknown error",this.error=n}if(he(t)){e.pending=!0,e.error_message=null;const s=e.promise=t.then(n=>{if(s===e.promise){if(typeof n?.ok=="boolean")if(n.ok)this.close();else{const m=typeof n.message=="string"?n.message:void 0;e.error_message=m??"unknown error",this.error=m}else this.close();return n}},n=>{if(s!==e.promise)return;const m=typeof n?.message=="string"?n.message:void 0;e.error_message=m??"unknown error",this.error=m}).finally(()=>{s===e.promise&&(e.pending=!1,e.promise=null)});return e.promise}this.close()}return!0}activate_selected(){const e=this.selections.at(-1);if(e)return this.activate(e);this.select_first()}select(e){if(this.selections.at(-1)===e)return;for(const s of this.selections)s.selected=!1;this.selections.length=0;let t=e;do t.selected=!0,this.selections.unshift(t);while((t=t.menu)&&t.menu)}collapse_selected(){if(this.selections.length<=1)return;const e=this.selections.pop();e.selected=!1}expand_selected(){const e=this.selections.at(-1);if(!e?.is_menu)return;const t=e.items[0];t.selected=!0,this.selections.push(t)}select_next(){if(!this.selections.length){this.select_first();return}const e=this.selections.at(-1),t=e.menu.items.indexOf(e);this.select(e.menu.items[t===e.menu.items.length-1?0:t+1])}select_previous(){if(!this.selections.length){this.select_last();return}const e=this.selections.at(-1),t=e.menu.items.indexOf(e);this.select(e.menu.items[t===0?e.menu.items.length-1:t-1])}select_first(){this.select((this.selections.at(-1)?.menu??this.root_menu).items[0])}select_last(){const{items:e}=this.selections.at(-1)?.menu??this.root_menu;this.select(e.at(-1))}add_entry(e){const t=z.maybe_get()??this.root_menu,s=new de(t,e);return t.items.push(s),V(()=>{t.items.length=0}),s}add_submenu(){const e=z.maybe_get()??this.root_menu,t=new _e(e,e.depth+1);return e.items.push(t),z.set(t),V(()=>{e.items.length=0}),t}}const K="contextmenu",ge=`a,[data-${K}]`,M=new Map;let ve=0;const Ue=(o,e)=>{if(e==null)return;const t=ve+++"";return o.dataset[K]=t,M.set(t,e),{update:s=>{M.set(t,s)},destroy:()=>{M.delete(t)}}},pe=17,Re=(o,e,t,s)=>{const n=ye(o);return n?.length?(s.open(n,e,t),navigator.vibrate&&navigator.vibrate(pe),!0):!1},ye=o=>{let e=null,t=o,s,n;for(;t=t?.closest(ge);){if(s=t.dataset[K]){if(e??=[],n=M.get(s),n===void 0)continue;Array.isArray(n)?(e??=[]).push(...n):(e??=[]).push(n)}t.tagName==="A"&&(e??=[]).push({snippet:"link",props:{href:t.href}}),t=t.parentElement}if(e){const m=window.getSelection()?.toString();m&&e.unshift({snippet:"text",props:{content:"copy text",icon:"📋",run:()=>void navigator.clipboard.writeText(m)}})}return e},xe=B(),z=B(),Pe=B(()=>new J);var be=G("<span><span><!></span><span><!></span><span><!></span></span>");function ke(o,e){F(e,!0);const t=oe(e,"running",3,!0);var s=be();O(s,i=>({...e.attrs,class:`pending_animation ${e.attrs?.class??""}`,[le]:i}),[()=>({running:t(),display_flex:!e.inline,display_inline_flex:e.inline,align_items_center:e.inline})],void 0,"svelte-1cqkncp");var n=g(s);O(n,()=>({...e.item_attrs,[L]:{"animation-delay":"0s"}}),void 0,void 0,"svelte-1cqkncp");var m=g(n);{var d=i=>{var l=k(),y=w(l);N(y,()=>e.children,()=>0),h(i,l)},_=i=>{var l=A("•");h(i,l)};b(m,i=>{e.children?i(d):i(_,!1)})}v(n);var p=U(n);O(p,()=>({...e.item_attrs,[L]:{"animation-delay":"0.09s"}}),void 0,void 0,"svelte-1cqkncp");var q=g(p);{var E=i=>{var l=k(),y=w(l);N(y,()=>e.children,()=>1),h(i,l)},R=i=>{var l=A("•");h(i,l)};b(q,i=>{e.children?i(E):i(R,!1)})}v(p);var T=U(p);O(T,()=>({...e.item_attrs,[L]:{"animation-delay":"0.3s"}}),void 0,void 0,"svelte-1cqkncp");var P=g(T);{var S=i=>{var l=k(),y=w(l);N(y,()=>e.children,()=>2),h(i,l)},X=i=>{var l=A("•");h(i,l)};b(P,i=>{e.children?i(S):i(X,!1)})}v(T),v(s),h(o,s),H()}var we=G('<li role="menuitem" aria-label="contextmenu entry" tabindex="-1"><div class="content"><div class="icon"><!></div> <div class="title"><!></div> <!></div></li>');function Xe(o,e){F(e,!0);const t=xe.get(),s=t.add_entry(e.run);ne(()=>{s.run=e.run});const n=I(()=>s.selected),m=I(()=>s.pending),d=I(()=>s.error_message);var _=we();let p;_.__click=()=>{setTimeout(()=>t.activate(s))};var q=g(_),E=g(q),R=g(E);{var T=a=>{var f=A();Q(()=>ae(f,e.icon)),h(a,f)},P=a=>{var f=k(),Y=w(f);{var j=x=>{var C=k(),W=w(C);N(W,()=>e.icon),h(x,C)};b(Y,x=>{e.icon&&x(j)},!0)}h(a,f)};b(R,a=>{typeof e.icon=="string"?a(T):a(P,!1)})}v(E);var S=U(E,2),X=g(S);N(X,()=>e.children),v(S);var i=U(S,2);{var l=a=>{ke(a,{})},y=a=>{var f=k(),Y=w(f);{var j=x=>{var C=A("⚠️");h(x,C)};b(Y,x=>{r(d)&&x(j)},!0)}h(a,f)};b(i,a=>{r(m)?a(l):a(y,!1)})}v(q),v(_),Q(a=>{p=ce(_,1,"menu_item plain selectable deselectable svelte-n1zjgm",null,p,a),ue(_,"title",r(d)?`Error: ${r(d)}`:void 0)},[()=>({selected:r(n)})]),ie("mouseenter",_,a=>{me(a),t.select(s)}),h(o,_),H()}re(["click"]);export{Xe as C,ke as P,Me as a,Ue as b,xe as c,Pe as d,De as e,Re as o};
