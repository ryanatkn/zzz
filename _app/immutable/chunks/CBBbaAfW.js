import"./DsnmJJEf.js";import{s as F,d as st,a as Gt,o as Qt,b as Xt}from"./D6t6EFf3.js";import{p as J,f as p,a as j,s as _,l as K,k as tt,i as a,b as i,c as U,n as $,h as et,d as r,r as e,t as I,j as S,e as X,T as Zt,m as xt}from"./DsYFF3e0.js";import{p as Z,s as wt,r as Pt,i as G}from"./Nwe5dM3j.js";import{h as V,a6 as Ht,c as te,p as kt,E as Ct,k as gt,S as ee,t as lt,q as mt,j as nt,I as ht,z as Mt,a7 as Lt,M as ae,C as re,a8 as Rt,w as St,s as jt,i as Yt,G as At,H as ne,J as se}from"./dRtQjgBD.js";import{r as oe}from"./CF_rgvJJ.js";import{C as _t,P as Tt}from"./4X2iJCGk.js";import{M as zt,a as ie,C as le,b as _e}from"./4iQfpMJc.js";import{t as ot,s as dt,f as de,b as ce}from"./R2QwTmpq.js";import{D as ve}from"./oM8O-Qux.js";import{C as ft}from"./ZErG5RAz.js";import{f as at}from"./ChYHAxKB.js";import{R as ue}from"./D7jkYwLB.js";import{C as Et,a as Ot,b as ut}from"./BMCZ99yj.js";import{e as me,P as he,a as ge,b as fe,g as pe,c as be,d as ye,h as Bt,T as xe}from"./DcGg3-OB.js";import{a as It,M as ke,P as we}from"./CEnclk0t.js";import{c as Pe}from"./CNYcfd7V.js";import{b as Nt}from"./BwYh6stK.js";import{P as qt}from"./td2F1UoZ.js";import{T as Ce,J as Te,D as yt}from"./z7712QSE.js";import{D as ze}from"./D-75x-LD.js";import{c as Ee}from"./CPf3P_HK.js";import{a as vt}from"./DCN01I-p.js";import{E as Le,T as De}from"./DtoQsrlA.js";import{E as Ge}from"./BeRhWz1w.js";import{E as He}from"./BBNa1a7U.js";var Me=p("<span>clear conversation</span>"),Re=p("switch model &nbsp; <small> </small>",1),Se=p("<span>delete thread</span>"),je=p("<!> <!> <!> <!> <!>",1),Ye=p("<!> <!>",1);function Vt(T,t){J(t,!0);const s=v=>{Ot(v,{icon:u=>{V(u,{get glyph(){return Ht}})},menu:u=>{var C=je(),f=j(C);{var k=l=>{ut(l,{get content(){return o().content},label:"copy conversation",get preview(){return o().content_preview}})};G(f,l=>{o().content&&l(k)})}var d=_(f,2);{var g=l=>{_t(l,{run:()=>{o().remove_all_turns()},icon:M=>{V(M,{get glyph(){return Ct}})},children:(M,Y)=>{var D=Me();i(M,D)},$$slots:{icon:!0,default:!0}})};G(d,l=>{o().turns.size>0&&l(g)})}var w=_(d,2);me(w,{label:"thread",get enabled(){return o().enabled},set enabled(l){o().enabled=l}});var c=_(w,2);_t(c,{run:()=>K(E,!0),icon:L=>{V(L,{get glyph(){return te}})},children:(L,M)=>{$();var Y=Re(),D=_(j(Y)),H=r(D,!0);e(D),I(()=>F(H,o().model_name)),i(L,Y)},$$slots:{icon:!0,default:!0}});var m=_(c,2);_t(m,{run:()=>{confirm("Are you sure you want to delete this thread?")&&P.threads.remove(o().id)},icon:L=>{V(L,{get glyph(){return kt}})},children:(L,M)=>{var Y=Se();i(L,Y)},$$slots:{icon:!0,default:!0}}),i(u,C)},children:(u,C)=>{$();var f=et("thread");i(u,f)},$$slots:{icon:!0,menu:!0,default:!0}})},o=Z(t,"thread",7),n=Pt(t,["$$slots","$$events","$$legacy","thread"]),P=at.get();let E=tt(!1);var h=Ye(),z=j(h);Et(z,wt(()=>n,{get entries(){return s}}));var x=_(z,2);zt(x,{onpick:v=>{v&&o().switch_model(v.id)},get show(){return a(E)},set show(v){K(E,v,!0)}}),i(T,h),U()}var Ae=p("<input/>");function Oe(T,t){J(t,!0);const s=Z(t,"thread",7);var o=Ae();gt(o,()=>({type:"checkbox",class:"plain compact",title:`this thread is ${s().enabled?"enabled":"disabled"} and ${s().enabled?"":"not "}included in the chat`,...t.attrs,[ee]:{height:"auto"}}),void 0,void 0,void 0,!0),Pe(o,()=>s().enabled,n=>s().enabled=n),i(T,o),U()}var Be=p("<small> </small>"),Ie=p('<div><div class="row justify_content_space_between gap_xs"><div class="flex_1"><div class="font_weight_400"><!> </div> <div class="display_flex gap_xs"><!></div></div> <div class="display_flex gap_xs"><!> <!></div></div></div>');function Ne(T,t){J(t,!0);const s=S(()=>t.thread.turns.size),o=S(()=>t.chat.view_mode==="simple"),n=S(()=>a(o)&&t.chat.selected_thread_id===t.thread.id);Vt(T,{get thread(){return t.thread},children:(P,E)=>{var h=Ie();let z;h.__click=function(...m){(a(o)?()=>t.chat.select_thread(t.thread.id):void 0)?.apply(this,m)},h.__keydown=function(...m){(a(o)?l=>l.key==="Enter"&&t.chat.select_thread(t.thread.id):void 0)?.apply(this,m)};var x=r(h),v=r(x),b=r(v),y=r(b);It(y,{get name(){return t.thread.model.provider_name},size:"var(--font_size_md)"});var u=_(y);e(b);var C=_(b,2),f=r(C);{var k=m=>{var l=Be(),L=r(l);e(l),I(()=>F(L,`${a(s)??""} message${a(s)!==1?"s":""}, ${t.thread.token_count??""} token${t.thread.token_count!==1?"s":""}`)),i(m,l)},d=m=>{var l=et(" ");i(m,l)};G(f,m=>{a(s)>0?m(k):m(d,!1)})}e(C),e(v);var g=_(v,2),w=r(g);Oe(w,{get thread(){return t.thread}});var c=_(w,2);ft(c,{onconfirm:()=>t.chat.remove_thread(t.thread.id),class:"icon_button plain",title:"delete thread",children:(m,l)=>{V(m,{get glyph(){return Ct}})},$$slots:{default:!0}}),e(g),e(x),e(h),I(m=>{z=lt(h,1,"thread_listitem p_xs2 svelte-pia7u5",null,z,m),mt(h,"role",a(o)?"button":void 0),mt(h,"tabindex",a(o)?0:void 0),F(u,` ${t.thread.model_name??""}`)},[()=>({dormant:!t.thread.enabled,selected:a(n)})]),i(P,h)},$$slots:{default:!0}}),U()}st(["click","keydown"]);var qe=p('<li class="border_radius_xs"><!></li>'),Ve=p('<ul class="unstyled column gap_xs5"></ul>'),Fe=p('<p class="text_align_center">No chat selected</p>');function Je(T,t){J(t,!0);const s=Z(t,"chat",19,()=>at.get().chats.selected),o=new ue;var n=X(),P=j(n);{var E=z=>{var x=Ve();nt(x,23,()=>s().threads,v=>v.id,(v,b,y)=>{var u=qe(),C=r(u);Ne(C,{get thread(){return a(b)},get chat(){return s()}}),e(u),ht(u,()=>o.item({index:a(y)})),ot(3,u,()=>dt),i(v,u)}),e(x),ht(x,()=>o.list({onreorder:(v,b)=>{s().reorder_threads(v,b)}})),i(z,x)},h=z=>{var x=Fe();i(z,x)};G(P,z=>{s()?z(E):z(h,!1)})}i(T,n),U()}var Ue=p('<span class="color_c_5"><!> <!></span>');function Dt(T,t){const s=Z(t,"glyph",3,Mt);var o=Ue(),n=r(o);{var P=h=>{V(h,{get glyph(){return s()}})};G(n,h=>{s()&&h(P)})}var E=_(n,2);Gt(E,()=>t.children),e(o),i(T,o)}var We=p('<div><div class="display_flex mb_0 justify_content_space_between"><div class="font_size_lg m_0"><!> </div> <div class="display_flex gap_xs"><!> <!></div></div> <div><!></div> <!></div>'),Ke=p("parts not found: <code> </code>",1),$e=p('<div class="p_sm"><!></div>');function Qe(T,t){J(t,!0);const s=Z(t,"show_actions",3,!0),o=at.get(),{prompts:n}=o;Ft(T,{get turn(){return t.turn},children:(P,E)=>{var h=X(),z=j(h);{var x=b=>{var y=X(),u=j(y);nt(u,17,()=>t.turn.parts,C=>C.id,(C,f)=>{var k=We();let d;var g=r(k),w=r(g),c=r(w);{let R=S(()=>pe(a(f)));V(c,{get glyph(){return a(R)}})}var m=_(c);e(w);var l=_(w,2),L=r(l);he(L,{get part(){return a(f)}});var M=_(L,2);ge(M,{get part(){return a(f)},get prompts(){return n}}),e(l),e(g);var Y=_(g,2),D=r(Y);{var H=R=>{be(R,{get text_part(){return a(f)},get show_actions(){return s()}})},N=R=>{var O=X(),q=j(O);{var W=Q=>{ye(Q,{get diskfile_part(){return a(f)},get show_actions(){return s()}})};G(q,Q=>{a(f).type==="diskfile"&&Q(W)},!0)}i(R,O)};G(D,R=>{a(f).type==="text"?R(H):R(N,!1)})}e(Y);var A=_(Y,2);fe(A,{get part(){return a(f)}}),e(k),I(R=>{d=lt(k,1,"column gap_sm mb_md",null,d,R),F(m,` 
						${a(f).name??""}`)},[()=>({dormant:!a(f).enabled})]),i(C,k)}),i(b,y)},v=b=>{var y=$e(),u=r(y);{var C=k=>{var d=Ke(),g=_(j(d)),w=r(g,!0);e(g),I(c=>F(w,c),[()=>t.turn.part_ids.join(", ")]),i(k,d)},f=k=>{var d=et("no parts in turn");i(k,d)};G(u,k=>{t.turn.part_ids.length>0?k(C):k(f,!1)})}e(y),i(b,y)};G(z,b=>{t.turn.parts.length>0?b(x):b(v,!1)})}i(P,h)},$$slots:{default:!0}}),U()}var Xe=p("<span>edit content</span>"),Ze=p("<!> <!> <!> <!>",1),ta=p('<div class="pane p_md width_upto_md mx_auto"><h2 class="mt_0 mb_sm"><!> edit turn</h2> <!></div>'),ea=p("<!> <!>",1);function Ft(T,t){J(t,!0);const s=x=>{Ot(x,{icon:y=>{V(y,{get glyph(){return Lt}})},menu:y=>{var u=Ze(),C=j(u);{var f=m=>{ut(m,{get content(){return t.turn.content},label:"copy content",get preview(){return t.turn.content}})};G(C,m=>{t.turn.content&&m(f)})}var k=_(C,2);_t(k,{run:()=>K(n,!0),icon:l=>{V(l,{get glyph(){return ae}})},children:(l,L)=>{var M=Xe();i(l,M)},$$slots:{icon:!0,default:!0}});var d=_(k,2);{var g=m=>{ut(m,{content:()=>JSON.stringify(t.turn.request,null,2),label:"copy request data",preview:""})};G(d,m=>{t.turn.request&&m(g)})}var w=_(d,2);{var c=m=>{ut(m,{content:()=>JSON.stringify(t.turn.response,null,2),label:"copy response data",preview:""})};G(w,m=>{t.turn.response&&m(c)})}i(y,u)},children:(y,u)=>{$();var C=et("turn");i(y,C)},$$slots:{icon:!0,menu:!0,default:!0}})},o=Pt(t,["$$slots","$$events","$$legacy","turn"]);let n=tt(!1);var P=ea(),E=j(P);Et(E,wt(()=>o,{get entries(){return s}}));var h=_(E,2);{var z=x=>{ze(x,{onclose:()=>K(n,!1),children:(v,b)=>{var y=ta(),u=r(y),C=r(u);V(C,{get glyph(){return Lt}}),$(),e(u);var f=_(u,2);Qe(f,{get turn(){return t.turn}}),e(y),i(v,y)},$$slots:{default:!0}})};G(h,x=>{a(n)&&x(z)})}i(T,P),U()}var aa=p('<span class="text_color_4 font_family_mono"> </span>'),ra=p('<div><div class="white_space_pre_wrap overflow_wrap_break_word"><small class="mr_xs font_weight_600"> </small> <!></div></div>');function na(T,t){J(t,!0),Ft(T,{get turn(){return t.turn},children:(s,o)=>{var n=ra();let P;var E=r(n),h=r(E),z=r(h);e(h);var x=_(h,2);{var v=y=>{Tt(y,{inline:!0})},b=y=>{var u=X(),C=j(u);{var f=d=>{Dt(d,{children:(g,w)=>{$();var c=et();I(()=>F(c,t.turn.error_message)),i(g,c)},$$slots:{default:!0}})},k=d=>{var g=X(),w=j(g);{var c=l=>{var L=et();I(()=>F(L,t.turn.content)),i(l,L)},m=l=>{var L=X(),M=j(L);{var Y=H=>{var N=aa(),A=r(N);e(N),I(R=>F(A,`missing parts: ${R??""}`),[()=>t.turn.part_ids.join(", ")]),i(H,N)},D=H=>{Dt(H,{children:(N,A)=>{$();var R=et();I(()=>F(R,Ce)),i(N,R)},$$slots:{default:!0}})};G(M,H=>{t.turn.parts.length===0?H(Y):H(D,!1)},!0)}i(l,L)};G(w,l=>{t.turn.is_content_loaded?l(c):l(m,!1)},!0)}i(d,g)};G(C,d=>{t.turn.error_message?d(f):d(k,!1)},!0)}i(y,u)};G(x,y=>{t.turn.pending?y(v):y(b,!1)})}e(E),e(n),I(y=>{P=lt(n,1,"px_sm py_xl",null,P,y),mt(h,"title",t.turn.created),F(z,`@${t.turn.role??""}:`)},[()=>({user:t.turn.role==="user",assistant:t.turn.role==="assistant",system:t.turn.role==="system",dormant:!t.turn.enabled})]),i(s,n)},$$slots:{default:!0}}),U()}class sa{#t=tt();get target_class(){return a(this.#t)}set target_class(t){K(this.#t,t,!0)}#e=tt();get threshold(){return a(this.#e)}set threshold(t){K(this.#e,t,!0)}#a=tt(0);get scroll_y(){return a(this.#a)}set scroll_y(t){K(this.#a,t,!0)}#r=S(()=>this.scroll_y>this.threshold);get scrolled(){return a(this.#r)}set scrolled(t){K(this.#r,t)}constructor(t){this.target_class=t?.target_class??"scrolled",this.threshold=t?.threshold??0}container=t=>{const s=window.getComputedStyle(t),o=()=>{const P=s.flexDirection==="column-reverse";this.scroll_y=t.scrollTop*(P?-1:1)},n=Qt(t,"scroll",o);return o(),()=>{n()}};target=t=>(this.scrolled?t.classList.add(this.target_class):t.classList.remove(this.target_class),()=>{t.classList.remove(this.target_class)})}var oa=p("<li><!></li>"),ia=p('<div><ul class="unstyled"></ul></div>');function la(T,t){J(t,!0);const s=new sa,o=S(()=>t.thread.turns.values);var n=ia();gt(n,()=>({...t.attrs,class:`turn_list ${t.attrs?.class??""}`}),void 0,void 0,"svelte-1d6x1dz");var P=r(n);nt(P,21,()=>a(o),E=>E.id,(E,h)=>{var z=oa(),x=r(z);na(x,{get turn(){return a(h)}}),e(z),ot(3,z,()=>dt),i(E,z)}),e(P),e(n),ht(n,()=>s.container),ht(n,()=>s.target),i(T,n),U()}var _a=(T,t)=>K(t,!0),da=p('<span class="ml_xs3" title="model loading"><!></span>'),ca=p('<span class="color_c_5 ml_sm"><!> </span>'),va=p('<div><div class="display_flex justify_content_space_between align_items_start"><header><button type="button" class="plain compact font_size_lg text_align_left font_weight_400"> <!></button> <small><!><!></small></header></div> <!> <div><!></div></div> <!>',1);function Jt(T,t){J(t,!0);let s=Z(t,"pending_element_to_focus_key",15),o=tt("");const n=S(()=>Te(a(o)));let P,E=tt(!1);const h=async()=>{const k=a(o).trim();if(!k){P?.focus();return}K(o,""),Zt().then(()=>P?.focus()),K(E,!0),await t.onsend(k),K(E,!1)},z=S(()=>t.thread.turns.size),x=S(()=>!a(z));let v=tt(!1);const b=S(()=>t.thread.model.provider_name==="ollama"),y=S(()=>a(b)&&!t.thread.model.loaded),u=S(()=>t.thread.model.provider),C=S(()=>a(u)?.available?null:a(u)?.status&&!a(u).status.available?a(u).status.error:"provider unavailable"),f=S(()=>a(E)||!!a(C));ke(T,{get model(){return t.thread.model},children:(k,d)=>{Vt(k,{get thread(){return t.thread},children:(g,w)=>{var c=va(),m=j(c);gt(m,B=>({...t.attrs,class:`chat_thread ${t.attrs?.class??""}`,[re]:B}),[()=>({empty:a(x),dormant:!t.thread.enabled})],void 0,"svelte-11z7mve");var l=r(m),L=r(l),M=r(L);M.__click=[_a,v];var Y=r(M),D=_(Y);{var H=B=>{var rt=da(),it=r(rt);Tt(it,{inline:!0}),e(rt),i(B,rt)};G(D,B=>{a(y)&&B(H)})}e(M);var N=_(M,2),A=r(N);we(A,{get provider(){return a(u)},icon:"svg",icon_props:{size:"var(--font_size_sm)"},show_name:!0});var R=_(A);{var O=B=>{var rt=ca(),it=r(rt);V(it,{get glyph(){return Mt}});var bt=_(it);e(rt),I(()=>F(bt,` ${a(C)??""}`)),i(B,rt)};G(R,B=>{a(C)&&B(O)})}e(N),e(L),e(l);var q=_(l,2);{var W=B=>{la(B,{get thread(){return t.thread},get attrs(){return t.turns_attrs}})};G(q,B=>{a(z)&&B(W)})}var Q=_(q,2),ct=r(Q);Nt(Bt(ct,{get token_count(){return a(n)},get placeholder(){return St},show_stats:!0,show_actions:!0,get focus_key(){return t.focus_key},get content(){return a(o)},set content(B){K(o,B,!0)},get pending_element_to_focus_key(){return s()},set pending_element_to_focus_key(B){s(B)},children:(B,rt)=>{{let it=S(()=>({class:"plain"+(a(C)?" color_c_5":"")})),bt=S(()=>a(u)?.available?`send ${a(n)} tokens to ${t.thread.model_name}`:a(C)??void 0);qt(B,{get pending(){return a(E)},get disabled(){return a(f)},onclick:h,get attrs(){return a(it)},get title(){return a(bt)},children:($t,ir)=>{V($t,{get glyph(){return Rt}})},$$slots:{default:!0}})}},$$slots:{default:!0}}),B=>P=B,()=>P),e(Q),e(m);var pt=_(m,2);zt(pt,{onpick:B=>{B&&t.thread.switch_model(B.id)},get show(){return a(v)},set show(B){K(v,B,!0)}}),I(()=>F(Y,`${t.thread.model.name??""} `)),i(g,c)},$$slots:{default:!0}})},$$slots:{default:!0}}),U()}st(["click"]);var ua=(T,t,s)=>t()(s()),ma=p('<button type="button" class="listitem compact width_100"><!></button>');function Ut(T,t){J(t,!0);const s=at.get(),{models:o}=s,n=Z(t,"items",19,()=>o.ordered_by_name),P=Z(t,"heading",3,"pick a model");{const E=(z,x=xt,v=xt)=>{var b=ma();b.__click=[ua,v,x];var y=r(b);ie(y,{get model(){return x()}}),e(b),i(z,b)};let h=S(()=>[vt("name_asc","name (a-z)","name"),vt("name_desc","name (z-a)","name","desc"),vt("provider_asc","provider (a-z)","provider_name"),vt("provider_desc","provider (z-a)","provider_name","desc")]);Ee(T,{get items(){return n()},get onpick(){return t.onpick},get filter(){return t.filter},get sorters(){return a(h)},sort_key_default:"name_asc",show_sort_controls:!0,get heading(){return P()},children:E,$$slots:{default:!0}})}U()}st(["click"]);var ha=p('<div><header class="mb_md font_size_lg">add by model</header> <!> <!></div>');function Wt(T,t){J(t,!0);var s=ha();gt(s,()=>({...t.attrs,class:`p_sm $${t.attrs?.class??""}`}));var o=_(r(s),2);Ut(o,{onpick:P=>{P&&t.chat.add_thread(P)},heading:null});var n=_(o,2);Gt(n,()=>t.children??xt),e(s),i(T,s),U()}var ga=(T,t,s)=>{t.chat.add_threads_by_model_tag(s)},fa=p("<span> </span>"),pa=p('<button type="button" class="width_100 font_size_sm py_xs3 justify_content_space_between plain border_radius_xs font_weight_600"><span> </span> <!></button>'),ba=p("<span> </span>"),ya=p("<span> </span> <!>",1),xa=p('<div><div class="display_flex"><div class="flex_1 p_xs"><header class="font_size_lg text_align_center mb_xs">add by tag</header> <menu class="unstyled column"></menu></div> <div class="flex_1 p_xs fg_1"><header class="font_size_lg text_align_center mb_xs">remove by tag</header> <menu class="unstyled column"></menu></div></div></div>');function Kt(T,t){J(t,!0);const s=S(()=>t.chat.app),o=S(()=>Array.from(a(s).tags));var n=xa(),P=r(n),E=r(P),h=_(r(E),2);nt(h,20,()=>a(o),v=>v,(v,b)=>{const y=S(()=>a(s).models.filter_by_tag(b));var u=pa();u.__click=[ga,t,b],jt(u,"",{},{"min-height":"0"});var C=r(u),f=r(C,!0);e(C);var k=_(C,2);{var d=g=>{var w=fa(),c=r(w,!0);e(w),I(()=>F(c,a(y).length)),i(g,w)};G(k,g=>{a(y).length&&g(d)})}e(u),I(()=>F(f,b)),i(v,u)}),e(h),e(E);var z=_(E,2),x=_(r(z),2);nt(x,20,()=>a(o),v=>v,(v,b)=>{const y=S(()=>t.chat.threads.filter(u=>u.model.tags.includes(b)));{let u=S(()=>!a(y).length);ft(v,{get disabled(){return a(u)},class:"width_100 font_size_sm py_xs3 justify_content_space_between plain border_radius_xs font_weight_600",style:"min-height: 0;",onconfirm:()=>{t.chat.remove_threads_by_model_tag(b)},children:(C,f)=>{var k=ya(),d=j(k),g=r(d,!0);e(d);var w=_(d,2);{var c=m=>{var l=ba(),L=r(l,!0);e(l),I(()=>F(L,a(y).length)),i(m,l)};G(w,m=>{a(y).length&&m(c)})}I(()=>F(g,b)),i(C,k)},$$slots:{default:!0}})}}),e(x),e(z),e(P),e(n),i(T,n),U()}st(["click"]);var ka=p("<div><div><!></div></div>"),wa=p('<section class="column_section"><!></section> <section class="column_section"><!></section>',1);function Pa(T,t){J(t,!0);const s=Z(t,"chat",7),o=S(()=>t.thread?.turns.size),n=S(()=>!a(o));var P=X(),E=j(P);{var h=x=>{var v=ka();let b,y;var u=r(v);let C;var f=r(u),k=()=>s().app.ui.pending_element_to_focus_key,d=g=>{s().app.ui.pending_element_to_focus_key=g};{let g=S(()=>({class:a(n)?"floating p_sm":"height_100"}));Jt(f,{get thread(){return t.thread},onsend:w=>s().send_to_thread(t.thread.id,w),get attrs(){return a(g)},get focus_key(){return s().id},get pending_element_to_focus_key(){return k()},set pending_element_to_focus_key(w){d(w)}})}e(u),e(v),I((g,w,c)=>{b=lt(v,1,"column_fluid column flex_1",null,b,g),y=jt(v,"",y,w),C=lt(u,1,"column width_upto_md width_atleast_sm",null,C,c)},[()=>({pr_xl:a(n)}),()=>({overflow:a(n)?"visible":void 0,"justify-content":a(n)?"center":void 0}),()=>({height_100:!a(n),p_sm:!a(n)})]),i(x,v)},z=x=>{var v=wa(),b=j(v),y=r(b);Wt(y,{get chat(){return s()}}),e(b);var u=_(b,2),C=r(u);Kt(C,{get chat(){return s()}}),e(u),i(x,v)};G(E,x=>{t.thread?x(h):x(z,!1)})}i(T,P),U()}var Ca=p("<!> ",1),Ta=(T,t)=>K(t,!0),za=p("<!>&nbsp; remove all",1),Ea=p("<li><!></li>"),La=p('<div class="column_fluid"><div class="column_bg_1 p_sm"><!> <div class="display_flex mt_lg"><button type="button" class="plain"><!>&nbsp; add thread</button> <!></div> <ul class="threads unstyled mt_lg svelte-jv56xz"></ul></div></div> <!>',1);function Da(T,t){J(t,!0);const s=Z(t,"chat",7);let o,n=tt(!1);const P=async()=>{if(!a(E))return;const c=s().main_input.trim();if(!c){o?.focus();return}s().main_input="",K(n,!0),await s().send_to_all(c),K(n,!1)},E=S(()=>s().enabled_threads.length);let h=tt(!1);var z=La(),x=j(z),v=r(x),b=r(v),y=()=>s().app.ui.pending_element_to_focus_key,u=c=>{s().app.ui.pending_element_to_focus_key=c};Nt(Bt(b,{get token_count(){return s().main_input_token_count},get placeholder(){return`${St} to ${a(E)??""}`},show_actions:!0,show_stats:!0,get focus_key(){return s().id},get pending_element_to_focus_key(){return y()},set pending_element_to_focus_key(c){u(c)},get content(){return s().main_input},set content(c){s().main_input=c},children:(c,m)=>{{let l=S(()=>a(E)?void 0:!0);qt(c,{get pending(){return a(n)},onclick:P,get disabled(){return a(l)},attrs:{class:"plain"},children:(L,M)=>{var Y=Ca(),D=j(Y);V(D,{get glyph(){return Rt}});var H=_(D);I(()=>F(H,` to ${a(E)??""}`)),i(L,Y)},$$slots:{default:!0}})}},$$slots:{default:!0}}),c=>o=c,()=>o);var C=_(b,2),f=r(C);f.__click=[Ta,h];var k=r(f);V(k,{get glyph(){return Yt}}),$(),e(f);var d=_(f,2);{let c=S(()=>!a(E));ft(d,{onconfirm:()=>s().remove_all_threads(),position:"right",get disabled(){return a(c)},class:"plain",children:(m,l)=>{var L=za(),M=j(L);V(M,{get glyph(){return Ct}}),$(),i(m,L)},$$slots:{default:!0}})}e(C);var g=_(C,2);nt(g,21,()=>s().threads,c=>c.id,(c,m)=>{var l=Ea(),L=r(l);Jt(L,{get thread(){return a(m)},onsend:M=>s().send_to_thread(a(m).id,M),turns_attrs:{class:"max_height_sm"},attrs:{class:"p_md"}}),e(l),ot(1,l,()=>dt),i(c,l)}),e(g),e(v),e(x);var w=_(x,2);zt(w,{onpick:c=>{c&&s().add_thread(c)},get show(){return a(h)},set show(c){K(h,c,!0)}}),i(T,z),U()}st(["click"]);var Ga=p('<h2 class="mt_0 mb_lg"> </h2>'),Ha=(T,t,s)=>t(a(s)),Ma=p("<!>&nbsp;",1),Ra=p('<small class="chip"><!> </small>'),Sa=p('<button type="button" class="plain selectable width_100 py_sm text_align_left justify_content_start font_weight_400"><div><div class="font_size_lg mb_sm"> </div> <div class="display_flex flex_wrap_wrap gap_xs2"></div></div></button>'),ja=p('<!> <div class="display_flex"><section class="width_upto_sm width_atleast_sm"><h3 class="mt_0 mb_lg">with model</h3> <!></section> <section class="width_upto_sm width_atleast_sm"><h3 class="mt_0 mb_lg px_md">from template</h3> <menu class="unstyled column gap_xs px_md"></menu></section></div>',1);function Ya(T,t){J(t,!0);const s=at.get(),o=Z(t,"heading",3,"create new chat"),n=()=>t.chat??s.chats.add(),P=f=>{const k=n(),d=s.models.filter_by_names(f.model_names);if(d&&d.length>0){for(const g of d)k.add_thread(g);d.length>=2&&(k.view_mode="multi")}t.oninit?.(k.id)},E=f=>{const k=n();k.add_thread(f),t.oninit?.(k.id)};var h=ja(),z=j(h);{var x=f=>{var k=Ga(),d=r(k,!0);e(k),I(()=>F(d,o())),i(f,k)};G(z,f=>{o()&&f(x)})}var v=_(z,2),b=r(v),y=_(r(b),2);Ut(y,{onpick:f=>{f&&E(f)},get items(){return t.items},heading:""}),e(b);var u=_(b,2),C=_(r(u),2);nt(C,21,()=>s.chats.chat_templates,f=>f.id,(f,k)=>{var d=Sa();d.__click=[Ha,P,k];var g=r(d),w=r(g),c=r(w,!0);e(w);var m=_(w,2);nt(m,20,()=>a(k).model_names,l=>l,(l,L)=>{const M=S(()=>s.models.find_by_name(L)?.provider_name);var Y=Ra(),D=r(Y);{var H=A=>{var R=Ma(),O=j(R);It(O,{get name(){return a(M)},size:"var(--font_size_xs)"}),$(),i(A,R)};G(D,A=>{a(M)&&A(H)})}var N=_(D,1,!0);e(Y),I(()=>F(N,L)),i(l,Y)}),e(m),e(g),e(d),I(()=>F(c,a(k).name)),i(f,d)}),e(C),e(u),e(v),i(T,h),U()}st(["click"]);var Aa=p('<section class="column_section"><div class="font_size_lg display_flex align_items_center"><!> <!></div> <div class="row"><small class="flex_1"> </small> <div class="row gap_xs py_xs"><!> <!></div></div></section>'),Oa=p('<section class="column_section"><header class="mt_0 mb_lg font_size_lg display_flex justify_content_space_between" title="threads are the individual threads of conversation in a chat -- each chat can have many threads, comprising its history"><span><!> threads</span><span> </span></header> <!></section>'),Ba=p('<section class="column_section"><!></section> <section class="column_section"><!></section>',1),Ia=p('<div class="column_fluid p_md"><!></div>'),Na=p('<div class="flex_1 height_100 display_flex align_items_start"><div class="column_fixed"><!> <!> <!></div> <!></div>');function qa(T,t){J(t,!0);const s=at.get(),{chats:o}=s,n=Z(t,"chat",7),P=S(()=>n().threads.length);var E=Na(),h=r(E),z=r(h);{var x=d=>{var g=Aa(),w=r(g),c=r(w);V(c,{get glyph(){return At}});var m=_(c,2);Le(m,{get value(){return n().name},set value(A){n().name=A}}),e(w);var l=_(w,2),L=r(l),M=r(L);e(L);var Y=_(L,2),D=r(Y);{var H=A=>{var R=()=>n().view_mode==="simple",O=q=>n().view_mode=q?"simple":"multi";{let q=S(()=>n().view_mode==="multi"?"simple":"multi");xe(A,{get active(){return R()},set active(W){O(W)},active_content:"simple",inactive_content:"multi",class:"plain compact",get title(){return`toggle chat to $${a(q)??""} view`},children:(W,Q)=>{V(W,{get glyph(){return ne},class:"mr_xs"})},$$slots:{default:!0}})}};G(D,A=>{a(P)&&A(H)})}var N=_(D,2);{const A=O=>{V(O,{get glyph(){return kt}})};let R=S(()=>'"'+n().name+'"');ft(N,{onconfirm:()=>n().id&&o.remove(n().id),get title(){return`delete chat ${a(R)??""}`},class:"plain icon_button",popover_button_content:A,children:(O,q)=>{V(O,{get glyph(){return kt}})},$$slots:{popover_button_content:!0,default:!0}})}e(Y),e(l),e(g),I(()=>{mt(L,"title",n().created_formatted_datetime),F(M,`created ${n().created_formatted_short_date??""}`)}),ot(3,g,()=>dt),i(d,g)};G(z,d=>{n()&&d(x)})}var v=_(z,2);{var b=d=>{var g=Oa(),w=r(g),c=r(w),m=r(c);V(m,{get glyph(){return Ht}}),$(),e(c);var l=_(c),L=r(l,!0);e(l),e(w);var M=_(w,2);Je(M,{get chat(){return n()}}),e(g),I(()=>F(L,a(P))),i(d,g)};G(v,d=>{a(P)&&(n().view_mode!=="simple"||a(P)>1)&&d(b)})}var y=_(v,2);{var u=d=>{ve(d,{summary:w=>{$();var c=et("manage threads");i(w,c)},children:(w,c)=>{var m=Ba(),l=j(m),L=r(l);Wt(L,{get chat(){return n()}}),e(l);var M=_(l,2),Y=r(M);Kt(Y,{get chat(){return n()}}),e(M),i(w,m)},$$slots:{summary:!0,default:!0}})};G(y,d=>{n().view_mode==="multi"&&d(u)})}e(h);var C=_(h,2);{var f=d=>{var g=Ia(),w=r(g);Ya(w,{get chat(){return n()},oninit:c=>o.navigate_to(c)}),e(g),i(d,g)},k=d=>{var g=X(),w=j(g);{var c=l=>{Pa(l,{get chat(){return n()},get thread(){return n().current_thread}})},m=l=>{Da(l,{get chat(){return n()}})};G(w,l=>{n().view_mode==="simple"?l(c):l(m,!1)},!0)}i(d,g)};G(C,d=>{a(P)?d(k,!1):d(f)})}e(E),i(T,E),U()}var Va=p("<span>create new chat</span>");function Fa(T,t){J(t,!0);const s=P=>{_t(P,{run:()=>n.chats.add(void 0,!0),icon:h=>{V(h,{get glyph(){return At}})},children:(h,z)=>{var x=Va();i(h,x)},$$slots:{icon:!0,default:!0}})},o=Pt(t,["$$slots","$$events","$$legacy"]),n=at.get();Et(T,wt(()=>o,{get entries(){return s}})),U()}var Ja=p(`<div class="pt_lg"><div><aside><p>This currently supports chatting with local models via Ollama, and if you bring your own
					API key, it supports basic text chat with ChatGPT, Claude, and Gemini. It's still early,
					share your ideas in the <!>.</p> <button type="button" class="compact">k</button></aside></div></div>`);function Ua(T,t){J(t,!0);const s=at.get();var o=X(),n=j(o);{var P=E=>{var h=Ja(),z=r(h),x=r(z),v=r(x),b=_(r(v));Ge(b,{href:"https://github.com/ryanatkn/zzz/discussions",children:(u,C)=>{$();var f=et("discussions");i(u,f)},$$slots:{default:!0}}),$(),e(v);var y=_(v,2);y.__click=()=>{s.ui.tutorial_for_chats=!1},e(x),e(z),e(h),ot(2,x,()=>de,()=>({duration:yt,x:-10,y:-1})),ot(2,z,()=>ce,()=>({duration:yt})),ot(2,h,()=>dt,()=>({delay:yt})),i(E,h)};G(n,E=>{s.ui.tutorial_for_chats&&E(P)})}i(T,o),U()}st(["click"]);var Wa=(T,t)=>t.add(void 0,!0),Ka=(T,t)=>t.toggle_sort_controls(),$a=p('<button type="button" title="toggle sort controls"><!></button>'),Qa=(T,t)=>t.check_backend(),Xa=p(`<p>Backend is not available. Chats require a backend connection to communicate with AI
						models.</p> <p class="mt_md"><button type="button">retry connection</button></p>`,1),Za=p('<div class="box mt_lg"><!></div>'),tr=p('<div class="box mt_lg"><blockquote>checking backend connection <!></blockquote></div>'),er=(T,t)=>t.add(void 0,!0),ar=(T,t)=>{const s=oe(t.ordered_items);t.navigate_to(s.id)},rr=p('<div class="box height_100 flex_1"><div class="p_md text_align_center"><p>select a chat from the list, <button type="button" class="inline color_d">create a new chat</button>, or <button type="button" class="inline color_f">go fish</button>?</p></div></div>'),nr=(T,t)=>t.add(void 0,!0),sr=p('<div class="box height_100"><p>no chats yet, <button type="button" class="inline color_d">create a new chat</button>?</p></div>'),or=p('<div class="column_fixed"><div class="py_sm pr_sm"><div class="row gap_xs2 mb_xs pl_xs2"><button class="plain flex_1 justify_content_start" type="button"><!>&nbsp; new chat</button> <!></div> <!></div> <!> <!> <!></div> <div class="column_fluid"><!></div>',1);function Rr(T,t){J(t,!0);const s=at.get(),{chats:o,capabilities:n}=s;Xt(()=>{n.init_backend_check()}),Fa(T,{attrs:{class:"display_flex width_100 height_100"},children:(P,E)=>{var h=or(),z=j(h),x=r(z),v=r(x),b=r(v);b.__click=[Wa,o];var y=r(b);V(y,{get glyph(){return Yt}}),$(),e(b);var u=_(b,2);{var C=D=>{var H=$a();let N;H.__click=[Ka,o];var A=r(H);V(A,{get glyph(){return se}}),e(H),I(R=>N=lt(H,1,"plain compact selectable deselectable",null,N,R),[()=>({selected:o.show_sort_controls})]),i(D,H)};G(u,D=>{o.items.size>1&&D(C)})}e(v);var f=_(v,2);{var k=D=>{le(D,{})};G(f,D=>{o.items.size&&D(k)})}e(x);var d=_(x,2);De(d,{});var g=_(d,2);Ua(g,{});var w=_(g,2);{var c=D=>{var H=Za(),N=r(H);He(N,{children:(A,R)=>{var O=Xa(),q=_(j(O),2),W=r(q);W.__click=[Qa,n],e(q),I(()=>W.disabled=n.backend.status==="pending"),i(A,O)},$$slots:{default:!0}}),e(H),i(D,H)},m=D=>{var H=X(),N=j(H);{var A=R=>{var O=tr(),q=r(O),W=_(r(q));Tt(W,{inline:!0}),e(q),e(O),i(R,O)};G(N,R=>{(n.backend_available===null||n.backend_available===void 0)&&R(A)},!0)}i(D,H)};G(w,D=>{n.backend_available===!1?D(c):D(m,!1)})}e(z);var l=_(z,2),L=r(l);{var M=D=>{_e(D,{get chat(){return o.selected},children:(H,N)=>{qa(H,{get chat(){return o.selected}})},$$slots:{default:!0}})},Y=D=>{var H=X(),N=j(H);{var A=O=>{var q=rr(),W=r(q),Q=r(W),ct=_(r(Q));ct.__click=[er,o];var pt=_(ct,2);pt.__click=[ar,o],$(),e(Q),e(W),e(q),i(O,q)},R=O=>{var q=sr(),W=r(q),Q=_(r(W));Q.__click=[nr,o],$(),e(W),e(q),i(O,q)};G(N,O=>{o.items.size?O(A):O(R,!1)},!0)}i(D,H)};G(L,D=>{o.selected?D(M):D(Y,!1)})}e(l),i(P,h)},$$slots:{default:!0}}),U()}st(["click"]);export{Rr as D};
