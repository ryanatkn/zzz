import{o}from"./9dtTqLgI.js";import{E as v}from"./ChZWrY-Y.js";import{c as u}from"./BLr52B8G.js";const p=a=>{const i=window.getComputedStyle(a),t=i.display;return t==="grid"||t==="inline-grid"?i.gridAutoFlow.includes("column")?"vertical":"horizontal":t==="flex"||t==="inline-flex"?i.flexDirection.includes("column")?"vertical":"horizontal":"vertical"},g=(a,i,t)=>a==="horizontal"?i>t?"left":"right":i>t?"top":"bottom",f=(a,i,t)=>{let e=i;return(t==="bottom"||t==="right")&&(e+=1),a<i&&(e-=1),e},m=(a,i,t)=>!a||a(i,t),b=(a,i)=>a<0?0:a>i+1?i+1:a,A=(a,i)=>{a.effectAllowed="move",a.setData("text/plain",i)},L="reorderable_list",T="reorderable_item",x="dragging",E="drag_over",D="drag_over_top",S="drag_over_bottom",R="drag_over_left",F="drag_over_right",z="invalid_drop";class G{initialized=!1;source_index=-1;source_item_id=null;active_indicator_item_id=null;current_indicator="none";direction="vertical";id=`r${u()}`;list_class;item_class;dragging_class;drag_over_class;drag_over_top_class;drag_over_bottom_class;drag_over_left_class;drag_over_right_class;invalid_drop_class;get#_(){return[this.dragging_class,this.drag_over_class,this.drag_over_top_class,this.drag_over_bottom_class,this.drag_over_left_class,this.drag_over_right_class,this.invalid_drop_class].filter(i=>i!==null)}list_node=null;list_params=null;indices=new Map;elements=new Map;#e=null;#i=null;pending_items=[];constructor(i=v){const{list_class:t=L,item_class:e=T,dragging_class:s=x,drag_over_class:r=E,drag_over_top_class:_=D,drag_over_bottom_class:l=S,drag_over_left_class:n=R,drag_over_right_class:d=F,invalid_drop_class:c=z,direction:h}=i;this.list_class=t,this.item_class=e,this.dragging_class=s,this.drag_over_class=r,this.drag_over_top_class=_,this.drag_over_bottom_class=l,this.drag_over_left_class=n,this.drag_over_right_class=d,this.invalid_drop_class=c,h&&(this.direction=h)}init(){if(!(!this.list_node||this.initialized)){for(const{id:i,index:t,element:e}of this.pending_items)this.indices.set(i,t),this.elements.set(i,e);this.pending_items=[],this.#l(this.list_node),this.initialized=!0}}#t(){if(this.source_item_id&&this.dragging_class){const i=this.elements.get(this.source_item_id);i&&i.classList.remove(this.dragging_class)}this.source_item_id=null,this.source_index=-1,this.clear_indicators()}get#a(){return this.source_index!==-1&&this.source_item_id!==null}clear_indicators(){if(!this.active_indicator_item_id)return;const i=this.elements.get(this.active_indicator_item_id);i&&i.classList.remove(...this.#_),this.active_indicator_item_id=null,this.current_indicator="none"}update_indicator(i,t,e=!0){if(this.source_item_id===i||t==="none"){this.clear_indicators();return}if(i===this.active_indicator_item_id&&t===this.current_indicator)return;const s=this.elements.get(i);if(s){if(this.clear_indicators(),this.drag_over_class&&s.classList.add(this.drag_over_class),!e)this.invalid_drop_class&&s.classList.add(this.invalid_drop_class);else{const r={top:this.drag_over_top_class,bottom:this.drag_over_bottom_class,left:this.drag_over_left_class,right:this.drag_over_right_class}[t];r&&s.classList.add(r)}this.active_indicator_item_id=i,this.current_indicator=t}}#s(i){const t=i.target;if(!t||!this.list_node)return null;let e=t;for(;e&&e!==this.list_node;){const s=e.dataset.reorderable_item_id;if(s){const r=this.indices.get(s),_=this.elements.get(s);if(r!==void 0&&_)return[s,r,_]}e=e.parentElement}return null}#l(i){this.#r();const t=[o(i,"dragstart",e=>{if(!e.dataTransfer)return;const s=this.#s(e);if(!s)return;const[r,_,l]=s;this.source_index=_,this.source_item_id=r,this.dragging_class&&l.classList.add(this.dragging_class),A(e.dataTransfer,r)},{capture:!0}),o(i,"dragend",()=>{this.#t()},{capture:!0}),o(i,"dragover",e=>{if(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!this.#a){this.clear_indicators();return}const s=this.#s(e);if(!s){this.clear_indicators();return}const[r,_]=s;if(this.source_item_id===r){this.clear_indicators();return}const l=g(this.direction,this.source_index,_),n=f(this.source_index,_,l),d=m(this.list_params?.can_reorder,this.source_index,n);this.update_indicator(r,l,d)}),o(i,"drop",e=>{if(e.preventDefault(),!this.#a){this.#t();return}const s=this.#s(e);if(!s){this.#t();return}const[r,_]=s;if(this.source_item_id===r){this.#t();return}const l=g(this.direction,this.source_index,_);let n=f(this.source_index,_,l);if(n=b(n,this.indices.size-1),!m(this.list_params?.can_reorder,this.source_index,n)){this.#t();return}const d=this.source_index;this.#t();try{this.list_params?.onreorder(d,n)}catch(c){console.error("[reorderable] error during reordering:",c)}}),o(i,"dragleave",e=>{const s=e.relatedTarget;(!s||!i.contains(s))&&this.clear_indicators()}),o(i,"dragenter",e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")})];this.#e=()=>{for(const e of t)e()}}#r(){this.#e&&(this.#e(),this.#e=null),this.#i!==null&&(cancelAnimationFrame(this.#i),this.#i=null)}list=i=>t=>{if(this.list_node&&this.list_node!==t)throw new Error("reorderable instance is already attached to a different list element");return this.list_node===t&&(this.#r(),this.initialized=!1),i.direction?this.direction=i.direction:this.initialized||(this.direction=p(t)),this.list_params=i,this.list_node=t,this.indices.clear(),this.elements.clear(),this.#t(),this.list_class&&t.classList.add(this.list_class),t.setAttribute("role","list"),t.dataset.reorderable_list_id=this.id,this.#i=requestAnimationFrame(()=>{this.#i=null,this.init()}),()=>{this.#r(),this.list_class&&t.classList.remove(this.list_class),t.removeAttribute("role"),delete t.dataset.reorderable_list_id,this.list_node=null,this.list_params=null,this.initialized=!1,this.pending_items=[],this.indices.clear(),this.elements.clear(),this.#t()}};item=i=>t=>{const{index:e}=i;let s=t.dataset.reorderable_item_id;s||(s=`i${u()}`,t.dataset.reorderable_item_id=s),t.setAttribute("draggable","true");const r=this.item_class;return r&&t.classList.add(r),t.setAttribute("role","listitem"),t.dataset.reorderable_list_id=this.id,this.initialized?(this.indices.set(s,e),this.elements.set(s,t)):this.pending_items.push({id:s,index:e,element:t}),()=>{this.initialized?(this.indices.delete(s),this.elements.delete(s)):this.pending_items=this.pending_items.filter(_=>_.id!==s),r&&t.classList.remove(r),t.removeAttribute("role"),t.removeAttribute("draggable"),delete t.dataset.reorderable_list_id,delete t.dataset.reorderable_item_id,this.active_indicator_item_id===s&&(this.active_indicator_item_id=null,this.current_indicator="none"),this.source_item_id===s&&this.#t()}}}export{G as R};
