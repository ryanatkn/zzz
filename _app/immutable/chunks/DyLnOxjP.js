import{k as n,i as s,l as i,a7 as g,j as d}from"./DsYFF3e0.js";import{C as y,h as Z,i as C,U as v,j,k as h,_ as M,l as S,m as T,H as b,n as c,o as w,r as _,p as P,q as a,c as V}from"./z7712QSE.js";import{p as H}from"./CdyEdxWZ.js";import{g as l}from"./GnWsGiEa.js";const D=y.extend({name:h().default(""),status:M(["active","pending","inactive"]).default("pending"),ssl:Z().default(!1)}).meta({cell_class_name:"Domain"}),J=y.extend({path:h().default("/"),title:h().default("New page"),content:h().default(`# New page

Add your content here.`)}).meta({cell_class_name:"Page"}),G=S({id:v,path:h(),label:h(),tags:j(h())}),N=y.extend({git_url:h(),checkouts:j(G).default([])}).meta({cell_class_name:"Repo"}),I=y.extend({name:h().default("new project"),description:h().default(""),pages:j(J).default(()=>[]),domains:j(D).default(()=>[]),repos:j(N).default([])}).meta({cell_class_name:"Project"}),U=y.extend({projects:j(I).default(()=>[]),current_project_id:v.nullable().default(null),current_page_id:v.nullable().default(null),current_domain_id:v.nullable().default(null),expanded_projects:C(h(),Z()).default({}),previewing:Z().default(!1)}).meta({cell_class_name:"Projects"});class $ extends T{#t=n();get name(){return s(this.#t)}set name(t){i(this.#t,t,!0)}#e=n();get status(){return s(this.#e)}set status(t){i(this.#e,t,!0)}#s=n();get ssl(){return s(this.#s)}set ssl(t){i(this.#s,t,!0)}constructor(t){super(D,t),this.init()}}class z extends T{#t=n();get path(){return s(this.#t)}set path(t){i(this.#t,t,!0)}#e=n();get title(){return s(this.#e)}set title(t){i(this.#e,t,!0)}#s=n();get content(){return s(this.#s)}set content(t){i(this.#s,t,!0)}constructor(t){super(J,t),this.init()}}class A extends T{#t=n();get git_url(){return s(this.#t)}set git_url(t){i(this.#t,t,!0)}#e=n();get checkouts(){return s(this.#e)}set checkouts(t){i(this.#e,t,!0)}constructor(t){super(N,t),this.init()}}class f extends T{#t=n();get name(){return s(this.#t)}set name(t){i(this.#t,t,!0)}#e=n();get description(){return s(this.#e)}set description(t){i(this.#e,t,!0)}#s=n(g([]));get pages(){return s(this.#s)}set pages(t){i(this.#s,t,!0)}#i=n(g([]));get domains(){return s(this.#i)}set domains(t){i(this.#i,t,!0)}#r=n(g([]));get repos(){return s(this.#r)}set repos(t){i(this.#r,t,!0)}constructor(t){super(I,t),this.decoders={pages:e=>{if(Array.isArray(e))return this.pages=e.map(r=>new z({app:this.app,json:r})),b},domains:e=>{if(Array.isArray(e))return this.domains=e.map(r=>new $({app:this.app,json:r})),b},repos:e=>{if(Array.isArray(e))return this.repos=e.map(r=>new A({app:this.app,json:r})),b}},this.init()}add_page(t){this.pages.push(t),this.updated=c()}update_page(t){const e=this.pages.findIndex(r=>r.id===t.id);e!==-1&&(this.pages[e]=t,this.updated=c())}delete_page(t){const e=this.pages.findIndex(r=>r.id===t);e!==-1&&(this.pages.splice(e,1),this.updated=c())}add_domain(t){this.domains.push(t),this.updated=c()}update_domain(t){const e=this.domains.findIndex(r=>r.id===t.id);e!==-1&&(this.domains[e]=t,this.updated=c())}delete_domain(t){const e=this.domains.findIndex(r=>r.id===t);e!==-1&&(this.domains.splice(e,1),this.updated=c())}add_repo(t){this.repos.push(t),this.updated=c()}update_repo(t){const e=this.repos.findIndex(r=>r.id===t.id);e!==-1&&(this.repos[e]=t,this.updated=c())}delete_repo(t){const e=this.repos.findIndex(r=>r.id===t);e!==-1&&(this.repos.splice(e,1),this.updated=c())}}w(f);class R{projects;#t=n();get project_id(){return s(this.#t)}set project_id(t){i(this.#t,t,!0)}#e=n();get edited_name(){return s(this.#e)}set edited_name(t){i(this.#e,t,!0)}#s=n();get edited_description(){return s(this.#s)}set edited_description(t){i(this.#s,t,!0)}#i=n(!1);get editing_project(){return s(this.#i)}set editing_project(t){i(this.#i,t,!0)}#r=d(()=>this.project&&(this.edited_name!==this.project.name||this.edited_description!==this.project.description));get has_changes(){return s(this.#r)}set has_changes(t){i(this.#r,t)}#n=d(()=>this.projects.current_project);get project(){return s(this.#n)}set project(t){i(this.#n,t)}constructor(t){this.projects=t.projects,this.project_id=t.project_id,this.reset_form()}reset_form(){this.project?(this.edited_name=this.project.name,this.edited_description=this.project.description):(this.edited_name="",this.edited_description="")}save_project_details(){if(this.project){if(!this.edited_name.trim()){alert("Project name is required.");return}this.project.name=this.edited_name,this.project.description=this.edited_description,this.project.updated=c(),this.editing_project=!1}}delete_current_project(){if(!this.project)return;confirm("Are you sure you want to delete this project? This action cannot be undone.")&&(this.projects.delete_project(this.project_id),l(_("/projects")))}delete_project_page(t){if(!this.project)return;confirm("Are you sure you want to delete this page? This action cannot be undone.")&&this.project.delete_page(t)}create_new_page(){if(!this.project)return;const t="New page",e=this.project.pages.map(k=>k.title),r=P(t,new Set(e)),o=a(),u=c(),x=new z({app:this.projects.app,json:{id:o,title:r,path:"/new-page",content:`# ${r}

Add your content here.`,created:u,updated:u}});this.project.add_page(x),l(_(`/projects/${this.project_id}/pages/${o}`))}create_new_domain(){if(!this.project)return;const t=a(),e=c(),r=new $({app:this.projects.app,json:{id:t,created:e,updated:e,name:"",status:"pending",ssl:!1}});this.project.add_domain(r),l(_(`/projects/${this.project_id}/domains/${t}`))}create_new_repo(){if(!this.project)return;const t=a(),e=new A({app:this.projects.app,json:{id:t,git_url:"",checkouts:[]}});this.project.add_repo(e),l(_(`/projects/${this.project_id}/repos/${t}`))}}w(R);const m=p=>p.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/gi,"").replace(/on\w+='[^']*'/gi,"").replace(/on\w+=\S+/gi,""),E=p=>p.split(/\n\n+/).map(r=>{let o=r.trim();if(!o)return"";if(o.startsWith("# "))return`<h1>${m(o.substring(2))}</h1>`;if(o.startsWith("## "))return`<h2>${m(o.substring(3))}</h2>`;if(o.startsWith("### "))return`<h3>${m(o.substring(4))}</h3>`;if(o.includes(`
- `)){const u=o.split(`
- `),x=u.slice(1).map(k=>`<li>${m(k)}</li>`).join("");return u[0].trim()===""?`<ul>${x}</ul>`:`<p>${m(u[0])}</p><ul>${x}</ul>`}return o=o.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),o=o.replace(/\*(.*?)\*/g,"<em>$1</em>"),`<p>${m(o)}</p>`}).join("");class W{projects;#t=n();get project_id(){return s(this.#t)}set project_id(t){i(this.#t,t,!0)}#e=n();get page_id(){return s(this.#e)}set page_id(t){i(this.#e,t,!0)}#s=n();get title(){return s(this.#s)}set title(t){i(this.#s,t,!0)}#i=n();get path(){return s(this.#i)}set path(t){i(this.#i,t,!0)}#r=n();get content(){return s(this.#r)}set content(t){i(this.#r,t,!0)}#n=d(()=>this.current_page&&(this.title!==this.current_page.title||this.path!==this.current_page.path||this.content!==this.current_page.content));get has_changes(){return s(this.#n)}set has_changes(t){i(this.#n,t)}#o=d(()=>this.projects.current_project);get project(){return s(this.#o)}set project(t){i(this.#o,t)}#a=d(()=>{const{page_id:t}=this;return this.project?.pages.find(e=>e.id===t)||null});get current_page(){return s(this.#a)}set current_page(t){i(this.#a,t)}#d=d(()=>E(this.content));get formatted_content(){return s(this.#d)}set formatted_content(t){i(this.#d,t)}constructor(t){this.projects=t.projects,this.project_id=t.project_id,this.page_id=t.page_id,this.reset_form()}reset_form(){this.current_page?(this.title=this.current_page.title,this.path=this.current_page.path,this.content=this.current_page.content):(this.title="New page",this.path="/",this.content=`# New page

Your content goes here.`)}save_page(){if(!this.project)return;if(!this.title.trim()||!this.path.trim()){alert("Title and path are required.");return}const t=this.path.startsWith("/")?this.path:`/${this.path}`,e=c();let r=this.current_page;r?this.current_page&&(this.current_page.title=this.title,this.current_page.path=t,this.current_page.content=this.content,this.current_page.updated=e):(r=new z({app:this.projects.app,json:{title:this.title,path:t,content:this.content,created:e,updated:e}}),this.projects.add_page(this.project_id,r)),l(_(`/projects/${this.project_id}/pages`))}}w(W);class q{projects;#t=n();get project_id(){return s(this.#t)}set project_id(t){i(this.#t,t,!0)}#e=n();get domain_id(){return s(this.#e)}set domain_id(t){i(this.#e,t,!0)}#s=n();get domain_name(){return s(this.#s)}set domain_name(t){i(this.#s,t,!0)}#i=n();get domain_status(){return s(this.#i)}set domain_status(t){i(this.#i,t,!0)}#r=n();get ssl_enabled(){return s(this.#r)}set ssl_enabled(t){i(this.#r,t,!0)}#n=d(()=>this.domain===null||this.domain_name!==this.domain.name||this.domain_status!==this.domain.status||this.ssl_enabled!==this.domain.ssl);get has_changes(){return s(this.#n)}set has_changes(t){i(this.#n,t)}#o=d(()=>this.projects.current_project);get project(){return s(this.#o)}set project(t){i(this.#o,t)}#a=d(()=>{const{domain_id:t}=this;return t&&this.project?.domains.find(e=>e.id===t)||null});get domain(){return s(this.#a)}set domain(t){i(this.#a,t)}constructor(t){this.projects=t.projects,this.project_id=t.project_id,this.domain_id=t.domain_id,this.reset_form()}reset_form(){this.domain?(this.domain_name=this.domain.name,this.domain_status=this.domain.status,this.ssl_enabled=this.domain.ssl):(this.domain_name="",this.domain_status="pending",this.ssl_enabled=!1)}save_domain_settings(){if(!this.project)return;const t=c();if(this.domain)this.domain.name=this.domain_name,this.domain.status=this.domain_status,this.domain.ssl=this.ssl_enabled,this.domain.updated=t;else{const e=new $({app:this.projects.app,json:{name:this.domain_name,status:this.domain_status,ssl:this.ssl_enabled,created:t,updated:t}});this.projects.add_domain(this.project_id,e)}l(_(`/projects/${this.project_id}/domains`))}remove_domain(){!this.project||!this.domain_id||confirm("Are you sure you want to remove this domain? This action cannot be undone.")&&(this.projects.delete_domain(this.project_id,this.domain_id),l(_(`/projects/${this.project_id}/domains`)))}}w(q);class O{projects;#t=n();get project_id(){return s(this.#t)}set project_id(t){i(this.#t,t,!0)}#e=n();get repo_id(){return s(this.#e)}set repo_id(t){i(this.#e,t,!0)}#s=n();get git_url(){return s(this.#s)}set git_url(t){i(this.#s,t,!0)}#i=n(g([]));get checkouts(){return s(this.#i)}set checkouts(t){i(this.#i,t,!0)}#r=d(()=>this.repo===null||this.git_url!==this.repo.git_url||JSON.stringify(this.checkouts)!==JSON.stringify(this.repo.checkouts));get has_changes(){return s(this.#r)}set has_changes(t){i(this.#r,t)}#n=d(()=>this.projects.current_project);get project(){return s(this.#n)}set project(t){i(this.#n,t)}#o=d(()=>{const{repo_id:t}=this;return t&&this.project?.repos.find(e=>e.id===t)||null});get repo(){return s(this.#o)}set repo(t){i(this.#o,t)}constructor(t){this.projects=t.projects,this.project_id=t.project_id,this.repo_id=t.repo_id,this.reset_form()}reset_form(){this.repo?(this.git_url=this.repo.git_url,this.checkouts=[...this.repo.checkouts]):(this.git_url="",this.checkouts=[])}add_checkout_dir(t){this.checkouts.push({id:a(),path:t?.path??"",label:t?.label??"",tags:t?.tags??[]})}remove_checkout_dir(t){t>=0&&t<this.checkouts.length&&this.checkouts.splice(t,1)}save_repo_settings(){if(!this.project)return;const t=c();if(this.repo)this.repo.git_url=this.git_url,this.repo.checkouts=[...this.checkouts],this.repo.updated=t;else{const e=new A({app:this.projects.app,json:{git_url:this.git_url,checkouts:this.checkouts,created:t,updated:t}});this.projects.add_repo(this.project_id,e)}l(_(`/projects/${this.project_id}/repos`))}remove_repo(){!this.project||!this.repo_id||confirm("Are you sure you want to remove this repo? This action cannot be undone.")&&(this.projects.delete_repo(this.project_id,this.repo_id),l(_(`/projects/${this.project_id}/repos`)))}}w(O);const L=p=>[new f({app:p,json:{id:a(),name:"Zzz",description:"web environment 💤 nice web things for the tired",created:"2023-01-15T12:00:00Z",updated:"2023-04-20T15:30:00Z",domains:[{id:a(),name:"zzz.software",status:"active",ssl:!0,created:"2023-01-15T12:00:00Z",updated:"2023-04-20T15:30:00Z"},{id:a(),name:"zzz.zzz.software",status:"active",ssl:!0,created:"2023-01-15T12:00:00Z",updated:"2023-04-20T15:30:00Z"}],pages:[{id:a(),path:"/",title:"home",content:`# Welcome to Zzz

Zzz is both a browser and editor for the read-write web.`,created:"2023-01-15T12:05:00Z",updated:"2023-01-16T09:30:00Z"},{id:a(),path:"/about",title:"about",content:`# About Zzz

Zzz is a project that aims to make managing websites routine and easy.`,created:"2023-01-15T14:20:00Z",updated:"2023-02-01T11:15:00Z"}],repos:[{id:a(),git_url:"https://github.com/ryanatkn/zzz.git",checkouts:[{id:a(),path:"./zzz/",label:"development",tags:["main","dev"]}],created:"2023-01-15T12:05:00Z",updated:"2023-01-16T09:30:00Z"}]}}),new f({app:p,json:{id:a(),name:"Dealt",description:"toy 2D web game engine with a focus on topdown action RPGs 🔮",created:"2023-02-10T09:15:00Z",updated:"2023-03-05T16:45:00Z",domains:[{id:a(),name:"dealt.dev",status:"active",ssl:!0,created:"2023-02-10T09:15:00Z",updated:"2023-03-05T16:45:00Z"},{id:a(),name:"tarot.dealt.dev",status:"active",ssl:!0,created:"2023-02-10T09:15:00Z",updated:"2023-03-05T16:45:00Z"}],pages:[{id:a(),path:"/",title:"Dealt",content:`# Dealt

toy 2D web game engine with a focus on topdown action RPGs 🔮 <a href="https://www.dealt.dev/">dealt.dev</a>`,created:"2023-02-10T10:00:00Z",updated:"2023-03-01T14:20:00Z"},{id:a(),path:"/tarot",title:"Dealt: tarot",content:`# Tarot

giving meaning a chance 🔮 <a href="https://tarot.dealt.dev/">tarot.dealt.dev</a>`,created:"2023-02-11T11:30:00Z",updated:"2023-02-15T09:45:00Z"}],repos:[{id:a(),git_url:"https://github.com/ryanatkn/dealt.git",checkouts:[{id:a(),path:"./dealt/",label:"development",tags:["main","dev"]},{id:a(),path:"./dealt_prod/",label:"production",tags:["deploy","prod"]}],created:"2023-02-10T10:00:00Z",updated:"2023-03-01T14:20:00Z"}]}}),new f({app:p,json:{id:a(),name:"cosmicplayground",description:"tools and toys for expanding minds 🌌",created:"2023-05-15T08:00:00Z",updated:"2023-06-20T14:15:00Z",domains:[{id:a(),name:"cosmicplayground.org",status:"active",ssl:!0,created:"2023-05-15T08:00:00Z",updated:"2023-06-20T14:15:00Z"}],pages:[],repos:[]}})],X=V();class Y extends T{#t=n(g([]));get projects(){return s(this.#t)}set projects(t){i(this.#t,t,!0)}#e=n(null);get current_project_id(){return s(this.#e)}set current_project_id(t){i(this.#e,t,!0)}#s=n(null);get current_page_id(){return s(this.#s)}set current_page_id(t){i(this.#s,t,!0)}#i=n(null);get current_domain_id(){return s(this.#i)}set current_domain_id(t){i(this.#i,t,!0)}#r=n(g({}));get expanded_projects(){return s(this.#r)}set expanded_projects(t){i(this.#r,t,!0)}#n=n(!1);get previewing(){return s(this.#n)}set previewing(t){i(this.#n,t,!0)}#o=d(()=>{const t=new Map;for(const e of this.projects)t.set(e.name,e);return t});get items_by_name(){return s(this.#o)}set items_by_name(t){i(this.#o,t)}#a=d(()=>H);get page_matches(){return s(this.#a)}set page_matches(t){i(this.#a,t)}#d=d(()=>this.projects.find(t=>t.id===this.current_project_id)||null);get current_project(){return s(this.#d)}set current_project(t){i(this.#d,t)}#c=d(()=>this.current_project?.pages.find(t=>t.id===this.current_page_id)||null);get current_page(){return s(this.#c)}set current_page(t){i(this.#c,t)}#p=d(()=>this.current_project?.domains.find(t=>t.id===this.current_domain_id)||null);get current_domain(){return s(this.#p)}set current_domain(t){i(this.#p,t)}#h=d(()=>{const t=this.page_matches.params.repo_id;return t?v.parse(t):null});get current_repo_id(){return s(this.#h)}set current_repo_id(t){i(this.#h,t)}#u=d(()=>this.current_project?.repos.find(t=>t.id===this.current_repo_id)||null);get current_repo(){return s(this.#u)}set current_repo(t){i(this.#u,t)}#_=d(()=>this.current_project_id?new O({projects:this,project_id:this.current_project_id,repo_id:this.current_repo_id}):null);get current_repos_viewmodel(){return s(this.#_)}set current_repos_viewmodel(t){i(this.#_,t)}#l=new Map;#m=new Map;#g=new Map;#j=d(()=>{if(!this.current_project_id)return null;let t=this.#l.get(this.current_project_id);return t||(t=new R({projects:this,project_id:this.current_project_id}),this.#l.set(this.current_project_id,t)),t});get current_project_viewmodel(){return s(this.#j)}set current_project_viewmodel(t){i(this.#j,t)}#f=d(()=>{if(!this.current_project_id||!this.current_page_id)return null;const t=`${this.current_project_id}_${this.current_page_id}`;let e=this.#m.get(t);return e||(e=new W({projects:this,project_id:this.current_project_id,page_id:this.current_page_id}),this.#m.set(t,e)),e});get current_page_viewmodel(){return s(this.#f)}set current_page_viewmodel(t){i(this.#f,t)}#w=d(()=>{if(!this.current_project_id)return null;this.current_domain_id||console.error("TODO ? current_domain_id is null");const t=`${this.current_project_id}_${this.current_domain_id||"new"}`;let e=this.#g.get(t);return e||(e=new q({projects:this,project_id:this.current_project_id,domain_id:this.current_domain_id}),this.#g.set(t,e)),e});get current_domains_viewmodel(){return s(this.#w)}set current_domains_viewmodel(t){i(this.#w,t)}constructor(t){super(U,t),this.decoders={projects:e=>{if(Array.isArray(e))return this.projects=e.map(r=>new f({app:this.app,json:r})),b;if(!e||!Array.isArray(e)||e.length===0)return this.projects=L(this.app),b}},this.init()}set_current_project(t){console.log("set_current_project",t),this.current_project_id=t}set_current_page(t){console.log("set_current_page",t),this.current_page_id=t}set_current_domain(t){console.log("set_current_domain",t),this.current_domain_id=t}create_new_project(){const e=P("new project",this.items_by_name),r=a(),o=c(),u=new f({app:this.app,json:{id:r,name:e,created:o,updated:o,pages:[{id:a(),path:"/",title:"Home",content:`# Welcome

This is the home page of your new project.`,created:o,updated:o}]}});return this.add_project(u),u}toggle_project_expanded(t){this.expanded_projects[t]=!this.expanded_projects[t]}add_project(t){this.projects.push(t)}delete_project(t){const e=this.projects.findIndex(r=>r.id===t);e!==-1&&this.projects.splice(e,1)}add_page(t,e){const r=this.projects.find(o=>o.id===t);r&&r.add_page(e)}delete_page(t,e){const r=this.projects.find(o=>o.id===t);r&&r.delete_page(e)}add_domain(t,e){const r=this.projects.find(o=>o.id===t);r&&r.add_domain(e)}update_domain(t,e){const r=this.projects.find(o=>o.id===t);r&&r.update_domain(e)}delete_domain(t,e){const r=this.projects.find(o=>o.id===t);r&&r.delete_domain(e)}find_project(t){return this.projects.find(e=>e.id===t)||null}save(){this.updated=c()}add_repo(t,e){const r=this.find_project(t);r&&(r.add_repo(e),this.save())}delete_repo(t,e){const r=this.find_project(t);r&&(r.delete_repo(e),this.save())}}w(Y);export{Y as P,X as p};
