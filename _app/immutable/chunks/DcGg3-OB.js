import"./DsnmJJEf.js";import{p as K,e as U,a as F,i as n,j as h,b as l,c as M,f as L,d as f,r as u,t as B,m as it,s as b,h as J,k as q,l as g,bk as Ct,Y as Lt,n as at,g as Dt,v as Ht}from"./DsYFF3e0.js";import{a as W,s as S,e as Rt,d as dt}from"./D6t6EFf3.js";import{p as R,s as rt,r as tt,i as H}from"./Nwe5dM3j.js";import{h as Q,u as Tt,t as ut,b as vt,D as ft,k as et,s as lt,_ as Gt,T as Yt,w as yt,I as At,$ as gt,p as jt,P as ct,j as zt,q as St,E as Bt}from"./dRtQjgBD.js";import{C as It}from"./4X2iJCGk.js";import{f as mt}from"./ChYHAxKB.js";import{t as X,s as $,c as ht}from"./R2QwTmpq.js";import{b as kt}from"./BwYh6stK.js";import{b as Kt,c as Mt}from"./CNYcfd7V.js";import{C as bt}from"./Cxhqr6gh.js";import{s as Ot}from"./BlUH4YWX.js";import{J as _t,K as Ft}from"./z7712QSE.js";import{C as st}from"./ZErG5RAz.js";import{D as Nt}from"./CPf3P_HK.js";var Vt=L("<!> ",1),qt=L("<span><!></span>");function Fe(c,t){K(t,!0);const e=(P,m=it)=>{var E=Vt(),C=F(E);{var p=k=>{var v=J("disable");l(k,v)},T=k=>{var v=J("enable");l(k,v)};H(C,k=>{m()?k(p):k(T,!1)})}var Y=b(C);B(()=>S(Y,` ${s()??""}`)),l(P,E)},r=P=>{var m=qt();let E;var C=f(m);Q(C,{get glyph(){return Tt}}),u(m),B(p=>E=ut(m,1,"",null,E,p),[()=>({dormant:a(),font_size_xs:a()})]),l(P,m)};let a=R(t,"enabled",15),_=R(t,"icon",3,r),i=R(t,"run",3,()=>{a(!a())}),s=R(t,"label",3,"item"),o=tt(t,["$$slots","$$events","$$legacy","enabled","icon","run","label","children"]);const x=h(()=>t.children??e);It(c,rt(()=>o,{get run(){return i()},get icon(){return _()},children:(P,m)=>{var E=U(),C=F(E);W(C,()=>n(x),a),l(P,E)},$$slots:{default:!0}})),M()}const Jt=(c,t=",")=>{if(!t)return c;const e=c.indexOf("."),r=(e===-1?c.length:e)-1;let a=e===-1?"":c.slice(r+1),_=0;for(let i=r;i>=0;i--)_++,_>3&&_%3===1&&(a=t+a),a=c[i]+a;return a};var Ut=L('<div title="the token count is currently approximated using just one algorithm, when in practice models differ"> </div>'),Wt=L('<div class="display_flex gap_xs font_family_mono font_size_sm"><!></div>');function xt(c,t){K(t,!0);var e=Wt(),r=f(e);{var a=i=>{var s=J(" ");l(i,s)},_=i=>{var s=Ut(),o=f(s);u(s),B(x=>S(o,`≈ ${x??""} token${t.token_count===1?"":"s"}`),[()=>Jt(t.token_count+"")]),l(i,s)};H(r,i=>{t.token_count?i(_,!1):i(a)})}u(e),l(c,e),M()}function Ne(c,t){K(t,!0);const e=h(()=>t.part.token_count??0);xt(c,{get token_count(){return n(e)}}),M()}const Qt={text:ft,diskfile:vt},Ve=c=>Qt[c.type]??ft;var Xt=L("<button><!></button>");function pt(c,t){K(t,!0);var e=Xt(),r=async()=>{try{const s=await navigator.clipboard.readText();t.onpaste(s)}catch(s){t.onerror?.(s)}};et(e,()=>({type:"button",title:"paste from clipboard",...t.attrs,onclick:r}));var a=f(e);{var _=s=>{var o=U(),x=F(o);W(x,()=>t.children),l(s,o)},i=s=>{var o=J("paste");l(s,o)};H(a,s=>{t.children?s(_):s(i,!1)})}u(e),l(c,e),M()}var Zt=L('<button><!> <span class="position_relative"><span class="display_inline_flex flex_direction_column height_0"><span><!></span> <span><!></span></span> <span class="position_absolute display_inline_flex align_items_center"><!></span></span></button>');function $t(c,t){K(t,!0);let e=R(t,"active",15),r=tt(t,["$$slots","$$events","$$legacy","active","active_content","inactive_content"]);var a=Zt(),_=()=>e(!e());et(a,()=>({type:"button",class:"plain icon_button",...r,onclick:_}));var i=f(a);W(i,()=>t.children??it);var s=b(i,2),o=f(s);lt(o,"",{},{visibility:"hidden"});var x=f(o),P=f(x);{var m=d=>{var y=J();B(()=>S(y,t.active_content)),l(d,y)},E=d=>{var y=U(),I=F(y);W(I,()=>t.active_content),l(d,y)};H(P,d=>{typeof t.active_content=="string"?d(m):d(E,!1)})}u(x);var C=b(x,2),p=f(C);{var T=d=>{var y=J();B(()=>S(y,t.inactive_content)),l(d,y)},Y=d=>{var y=U(),I=F(y);W(I,()=>t.inactive_content),l(d,y)};H(p,d=>{typeof t.inactive_content=="string"?d(T):d(Y,!1)})}u(C),u(o);var k=b(o,2);lt(k,"",{},{inset:"0"});var v=f(k);{var w=d=>{var y=U(),I=F(y);{var V=G=>{var j=J();B(()=>S(j,t.active_content)),l(G,j)},N=G=>{var j=U(),O=F(j);W(O,()=>t.active_content),l(G,j)};H(I,G=>{typeof t.active_content=="string"?G(V):G(N,!1)})}l(d,y)},D=d=>{var y=U(),I=F(y);{var V=G=>{var j=J();B(()=>S(j,t.inactive_content)),l(G,j)},N=G=>{var j=U(),O=F(j);W(O,()=>t.inactive_content),l(G,j)};H(I,G=>{typeof t.inactive_content=="string"?G(V):G(N,!1)},!0)}l(d,y)};H(v,d=>{e()?d(w):d(D,!1)})}u(k),u(s),u(a),l(c,a),M()}function wt(c,t){K(t,!0);let e=R(t,"value",15),r=R(t,"restore_icon",3,Gt),a=R(t,"clear_icon",3,Yt),_=tt(t,["$$slots","$$events","$$legacy","value","onchange","restore_icon","clear_icon"]),i=q("");const s=h(()=>!!e()),o=h(()=>!e()&&!n(i)),x=h(()=>n(s)?"clear":"restore");var P=()=>n(s),m=E=>{if(E){const C=n(i);g(i,""),e(C)}else g(i,e(),!0),e("")};$t(c,rt({get active(){return P()},set active(E){m(E)},get active_content(){return a()},get inactive_content(){return r()}},()=>_,{get disabled(){return n(o)},get title(){return n(x)}})),M()}var te=L('<div class="display_flex mt_xs"><!> <!> <!></div>'),ee=L('<div class="column width_100 flex_1"><div class="display_flex flex_1 gap_xs2 width_100"><textarea></textarea> <!></div> <!> <!> <!></div>');function ot(c,t){K(t,!0);let e=R(t,"content",15),r=R(t,"placeholder",3,yt),a=R(t,"readonly",3,!1),_=R(t,"show_stats",3,!1),i=R(t,"show_actions",3,!1),s=R(t,"pending_element_to_focus_key",15),o=q(void 0);const x=h(()=>t.token_count??_t(e())),P=()=>{n(o)?.focus()};var m={focus:P},E=ee();Rt("keydown",Ct,function(...d){(t.onsave?y=>{(y.ctrlKey||y.metaKey)&&y.key==="s"&&(Ot(y),t.onsave(e()))}:void 0)?.apply(this,d)});var C=f(E),p=f(C);Lt(p),et(p,()=>({...t.attrs,class:`plain mb_0 width_100 flex_1 ${t.attrs?.class??""}`,placeholder:r(),readonly:a(),style:`${t.textarea_height?`height: ${t.textarea_height};`:""} ${(t.attrs?.style||"")??""}`})),kt(p,d=>g(o,d),()=>n(o)),At(p,()=>t.focus_key==null?null:()=>{t.focus_key===s()&&(s(null),P())});var T=b(p,2);W(T,()=>t.children??it),u(C);var Y=b(C,2);{var k=d=>{xt(d,{get token_count(){return n(x)}})};H(Y,d=>{_()&&d(k)})}var v=b(Y,2);W(v,()=>t.after??it);var w=b(v,2);{var D=d=>{var y=te(),I=f(y);bt(I,{get text(){return e()},attrs:{class:"plain"}});var V=b(I,2);pt(V,{onpaste:O=>{const nt=e()+O;e(nt),P()},attrs:{class:"plain icon_button font_size_lg"},children:(O,nt)=>{Q(O,{get glyph(){return gt}})},$$slots:{default:!0}});var N=b(V,2),G=()=>e(),j=O=>{e(O),P()};wt(N,{get value(){return G()},set value(O){j(O)}}),u(y),l(d,y)};H(w,d=>{i()&&!a()&&d(D)})}return u(E),Kt(p,e),l(c,E),M(m)}function qe(c,t){K(t,!0);const e=R(t,"text_part",7),r=R(t,"show_actions",3,!0),a=tt(t,["$$slots","$$events","$$legacy","text_part","show_actions"]);ot(c,rt(()=>a,{get show_actions(){return r()},get content(){return e().content},set content(_){e().content=_}})),M()}var ne=L("<!> <!>",1),ie=(c,t)=>t().save_changes(),se=L('<div class="mt_xs display_flex"><button class="flex_1 color_f" type="button">save changes</button></div>'),re=L('<div class="display_flex gap_xs"><!> <!> <!></div> <!>',1);function ae(c,t){K(t,!0);const e=R(t,"editor_state",7),r=R(t,"readonly",3,!1),a=R(t,"auto_save",3,!1),_=mt.get();var i=re(),s=F(i),o=f(s);bt(o,{get text(){return e().current_content},attrs:{class:"plain"}});var x=b(o,2);{var P=p=>{var T=ne(),Y=F(T);pt(Y,{onpaste:v=>{e().current_content+=v},attrs:{class:"plain icon_button font_size_lg"},children:(v,w)=>{Q(v,{get glyph(){return gt}})},$$slots:{default:!0}});var k=b(Y,2);wt(k,{get value(){return e().current_content},set value(v){e().current_content=v}}),l(p,T)};H(x,p=>{r()||p(P)})}var m=b(x,2);st(m,{onconfirm:()=>_.diskfiles.delete(t.diskfile.path),class:"plain icon_button",title:"delete file",children:(p,T)=>{Q(p,{get glyph(){return jt}})},$$slots:{default:!0}}),u(s);var E=b(s,2);{var C=p=>{var T=se(),Y=f(T);Y.__click=[ie,e],u(T),B(()=>Y.disabled=!e().has_changes),X(3,T,()=>$),l(p,T)};H(E,p=>{!r()&&!a()&&p(C)})}l(c,i),M()}dt(["click"]);var _e=L("<span><!> </span>"),oe=L('<div class="white_space_nowrap"> </div>'),de=L("<span><!> </span>"),le=L('<div class="white_space_nowrap"> </div>'),ce=L('<div class="font_family_mono font_size_sm"><div class="display_flex justify_content_space_between"><div> <!></div> <!></div> <div class="display_flex justify_content_space_between"><div> <!></div> <!></div></div>');function he(c,t){K(t,!0);var e=ce(),r=f(e),a=f(r),_=f(a),i=b(_);{var s=k=>{var v=_e(),w=f(v);Q(w,{get glyph(){return ct}});var D=b(w);u(v),B(()=>S(D,` ${t.editor_state.current_length??""}`)),X(3,v,()=>ht,()=>({duration:80})),l(k,v)};H(i,k=>{t.editor_state.original_length!==t.editor_state.current_length&&k(s)})}u(a);var o=b(a,2);{var x=k=>{var v=oe(),w=f(v);u(v),B(()=>S(w,`${t.editor_state.length_diff>0?"+":""}${t.editor_state.length_diff??""} =
				${t.editor_state.length_diff>0?"+":""}${t.editor_state.length_diff_percent??""}%`)),X(3,v,()=>$,()=>({axis:"x"})),l(k,v)};H(o,k=>{t.editor_state.length_diff&&k(x)})}u(r);var P=b(r,2),m=f(P),E=f(m),C=b(E);{var p=k=>{var v=de(),w=f(v);Q(w,{get glyph(){return ct}});var D=b(w);u(v),B(()=>S(D,` ${t.editor_state.current_token_count??""}`)),X(3,v,()=>ht,()=>({duration:80})),l(k,v)};H(C,k=>{t.editor_state.original_token_count!==t.editor_state.current_token_count&&k(p)})}u(m);var T=b(m,2);{var Y=k=>{var v=le(),w=f(v);u(v),B(()=>S(w,`${t.editor_state.token_diff>0?"+":""}${t.editor_state.token_diff??""} =
				${t.editor_state.token_diff>0?"+":""}${t.editor_state.token_diff_percent??""}%`)),X(3,v,()=>$,()=>({axis:"x"})),l(k,v)};H(T,k=>{t.editor_state.token_diff&&k(Y)})}u(P),u(e),B(()=>{S(_,`chars
			${t.editor_state.original_length??""} `),S(E,`tokens
			${t.editor_state.original_token_count??""} `)}),l(c,e),M()}class ue{app;#e=q();get diskfile(){return n(this.#e)}set diskfile(t){g(this.#e,t,!0)}#n=q(null);get unsaved_edit_entry_id(){return n(this.#n)}set unsaved_edit_entry_id(t){g(this.#n,t,!0)}#i=q(null);get selected_history_entry_id(){return n(this.#i)}set selected_history_entry_id(t){g(this.#i,t,!0)}#s=q(!1);get content_was_modified_by_user(){return n(this.#s)}set content_was_modified_by_user(t){g(this.#s,t,!0)}#r=q(null);get last_seen_disk_content(){return n(this.#r)}set last_seen_disk_content(t){g(this.#r,t,!0)}#a=h(()=>this.diskfile.content);get original_content(){return n(this.#a)}set original_content(t){g(this.#a,t)}#_=h(()=>this.diskfile.path);get path(){return n(this.#_)}set path(t){g(this.#_,t)}#o=h(()=>this.original_content===null?this.current_content!=="":this.current_content!==this.original_content);get has_changes(){return n(this.#o)}set has_changes(t){g(this.#o,t)}#d=h(()=>this.app.get_diskfile_history(this.diskfile.path));get history(){return n(this.#d)}set history(t){g(this.#d,t)}#l=h(()=>this.history&&this.selected_history_entry_id?this.history.find_entry_by_id(this.selected_history_entry_id):null);get selected_history_entry(){return n(this.#l)}set selected_history_entry(t){g(this.#l,t)}#c=h(()=>this.history?.entries||[]);get content_history(){return n(this.#c)}set content_history(t){g(this.#c,t)}#h=h(()=>this.content_history.filter(t=>!t.is_unsaved_edit));get saved_history_entries(){return n(this.#h)}set saved_history_entries(t){g(this.#h,t)}#u=h(()=>this.content_history.filter(t=>t.is_unsaved_edit));get unsaved_history_entries(){return n(this.#u)}set unsaved_history_entries(t){g(this.#u,t)}#v=h(()=>this.content_history.length>1);get has_history(){return n(this.#v)}set has_history(t){g(this.#v,t)}#f=h(()=>this.unsaved_history_entries.length>0);get has_unsaved_edits(){return n(this.#f)}set has_unsaved_edits(t){g(this.#f,t)}#y=h(()=>this.saved_history_entries.length>1);get can_clear_history(){return n(this.#y)}set can_clear_history(t){g(this.#y,t)}#g=h(()=>this.unsaved_history_entries.length>0);get can_clear_unsaved_edits(){return n(this.#g)}set can_clear_unsaved_edits(t){g(this.#g,t)}#m=h(()=>this.unsaved_history_entries.map(t=>t.id));get unsaved_entry_ids(){return n(this.#m)}set unsaved_entry_ids(t){g(this.#m,t)}#k=h(()=>this.content_history.filter(t=>t.content===this.current_content).map(t=>t.id));get content_matching_entry_ids(){return n(this.#k)}set content_matching_entry_ids(t){g(this.#k,t)}#b=h(()=>this.original_content?.length??0);get original_length(){return n(this.#b)}set original_length(t){g(this.#b,t)}#x=h(()=>this.current_content.length);get current_length(){return n(this.#x)}set current_length(t){g(this.#x,t)}#p=h(()=>this.current_length-this.original_length);get length_diff(){return n(this.#p)}set length_diff(t){g(this.#p,t)}#w=h(()=>this.original_length>0?Math.round(this.length_diff/this.original_length*100):100);get length_diff_percent(){return n(this.#w)}set length_diff_percent(t){g(this.#w,t)}#P=h(()=>this.original_content==null?0:_t(this.original_content));get original_token_count(){return n(this.#P)}set original_token_count(t){g(this.#P,t)}#E=h(()=>_t(this.current_content));get current_token_count(){return n(this.#E)}set current_token_count(t){g(this.#E,t)}#C=h(()=>this.current_token_count-this.original_token_count);get token_diff(){return n(this.#C)}set token_diff(t){g(this.#C,t)}#L=h(()=>this.original_token_count>0?Math.round(this.token_diff/this.original_token_count*100):100);get token_diff_percent(){return n(this.#L)}set token_diff_percent(t){g(this.#L,t)}get current_content(){return this.selected_history_entry?this.selected_history_entry.content:this.original_content||""}set current_content(t){const e=t!==this.current_content;this.content_was_modified_by_user=t!==this.original_content,e&&this.#D(t)}constructor(t){this.app=t.app,this.diskfile=t.diskfile,this.last_seen_disk_content=this.diskfile.content;const e=this.#t();this.original_content!==null&&e.entries.length===0&&e.add_entry(this.original_content,{is_original_state:!0}),e.current_entry&&(this.selected_history_entry_id=e.current_entry.id)}#t(){let t=this.app.get_diskfile_history(this.path);return t||(t=this.app.create_diskfile_history(this.path)),this.original_content!==null&&t.entries.length===0&&t.add_entry(this.original_content,{is_original_state:!0}),t}#D(t){const e=this.#t();if(t===this.original_content){if(this.unsaved_edit_entry_id){const o=e.entries.findIndex(x=>x.id===this.unsaved_edit_entry_id);o!==-1&&e.entries.splice(o,1),this.unsaved_edit_entry_id=null}const s=e.entries.find(o=>!o.is_unsaved_edit&&o.content===this.original_content);s?this.selected_history_entry_id=s.id:this.selected_history_entry_id=e.current_entry?.id??null;return}if(this.unsaved_edit_entry_id){const s=e.find_entry_by_id(this.unsaved_edit_entry_id);if(s){s.content=t,this.selected_history_entry_id=this.unsaved_edit_entry_id;return}}const a=e.entries.find(s=>s.content===t&&s.is_unsaved_edit);if(a){this.selected_history_entry_id=a.id,this.unsaved_edit_entry_id=a.id;return}const _=e.entries.find(s=>s.content===t&&!s.is_unsaved_edit);if(_){this.selected_history_entry_id=_.id,this.unsaved_edit_entry_id=null;return}const i=e.add_entry(t,{created:Date.now(),label:"Unsaved edit",is_unsaved_edit:!0});this.unsaved_edit_entry_id=i.id,this.selected_history_entry_id=i.id}reset(){this.last_seen_disk_content=this.diskfile.content,this.content_was_modified_by_user=!1,this.unsaved_edit_entry_id=null,this.selected_history_entry_id=null}check_disk_changes(){if(this.diskfile.content===null)return;if(this.last_seen_disk_content===null){this.last_seen_disk_content=this.diskfile.content;return}if(this.diskfile.content===this.last_seen_disk_content)return;const t=this.#t();if(t.entries.length===0||t.entries[0].content!==this.diskfile.content){const e=t.add_entry(this.diskfile.content,{is_disk_change:!0,label:"Disk change"});this.content_was_modified_by_user||(this.selected_history_entry_id=e.id)}else t.entries[0].is_disk_change=!0,t.entries[0].is_unsaved_edit=!1;this.last_seen_disk_content=this.diskfile.content}async save_changes(){if(!this.has_changes)return!1;const t=this.#t(),e=this.current_content;if(this.unsaved_edit_entry_id!==null){const a=t.entries.findIndex(_=>_.id===this.unsaved_edit_entry_id);a!==-1&&t.entries.splice(a,1)}const r=t.add_entry(e);return await this.app.diskfiles.update(this.path,e),this.last_seen_disk_content=e,this.content_was_modified_by_user=!1,this.unsaved_edit_entry_id=null,this.selected_history_entry_id=r.id,!0}set_content_from_history(t){const e=this.history;if(!e)return;this.selected_history_entry_id=t;const r=e.find_entry_by_id(t);r&&(this.content_was_modified_by_user=r.content!==this.original_content,r.is_unsaved_edit?this.unsaved_edit_entry_id=t:this.unsaved_edit_entry_id=null)}update_diskfile(t){if(this.diskfile.id!==t.id&&(this.diskfile=t,this.reset(),this.original_content!==null)){const e=this.#t();e.entries.length===0&&e.add_entry(this.original_content,{is_original_state:!0}),e.current_entry&&(this.selected_history_entry_id=e.current_entry.id)}}clear_history(){const t=this.history;if(!t||t.entries.length<=1)return;const e=t.entries.filter(i=>!i.is_unsaved_edit),r=e.length>0?e[0]:null,_=[...t.entries.filter(i=>i.is_unsaved_edit)];r&&(_.push(r),r.is_original_state=!0),_.sort((i,s)=>s.created-i.created),t.entries=_,!this.selected_history_entry&&r&&(this.selected_history_entry_id=r.id)}clear_unsaved_edits(){const t=this.history;if(!t)return;const e=this.selected_history_entry?.is_unsaved_edit||!1;if(t.entries=t.entries.filter(r=>!r.is_unsaved_edit),this.unsaved_edit_entry_id=null,e){const r=t.entries.find(a=>a.content===this.original_content);r?this.selected_history_entry_id=r.id:t.current_entry?this.selected_history_entry_id=t.current_entry.id:this.selected_history_entry_id=null,this.content_was_modified_by_user=!1}}}var ve=(c,t,e)=>t.onselectentry(n(e).id),fe=L('<span class="ml_xl">from disk</span>'),ye=L('<span class="ml_xl">unsaved</span>'),ge=L('<button type="button"><span><span> </span> <!></span> <span> </span></button>'),me=L('<div><small class="px_sm display_flex justify_content_space_between mb_sm"><!> <!></small> <menu></menu></div>');function ke(c,t){K(t,!0);var e=me(),r=f(e),a=f(r);{let s=h(()=>!t.editor_state.can_clear_history),o=h(()=>t.editor_state.can_clear_history?"Clear history entries except the current disk state":"No history entries to clear");st(a,{onconfirm:()=>t.editor_state.clear_history(),position:"right",class:"plain compact",get disabled(){return n(s)},get title(){return n(o)},children:(x,P)=>{at();var m=J("clear history");l(x,m)},$$slots:{default:!0}})}var _=b(a,2);{let s=h(()=>!t.editor_state.can_clear_unsaved_edits),o=h(()=>t.editor_state.can_clear_unsaved_edits?"Remove all unsaved edit entries from history":"No unsaved edits to clear");st(_,{onconfirm:()=>{t.editor_state.clear_unsaved_edits()},class:"plain compact",get disabled(){return n(s)},get title(){return n(o)},children:(x,P)=>{at();var m=J("clear unsaved edits");l(x,m)},$$slots:{default:!0}})}u(r);var i=b(r,2);et(i,()=>({...t.attrs,class:`unstyled ${t.attrs?.class??"max_height_sm"??""}`}),void 0,void 0,"svelte-vbresr"),zt(i,21,()=>t.editor_state.content_history,s=>s.id,(s,o)=>{const x=h(()=>n(o).id===t.editor_state.selected_history_entry_id),P=h(()=>t.editor_state.content_matching_entry_ids.includes(n(o).id));var m=ge();let E;m.__click=[ve,t,o];var C=f(m),p=f(C),T=f(p,!0);u(p);var Y=b(p,2);{var k=d=>{var y=fe();l(d,y)},v=d=>{var y=U(),I=F(y);{var V=N=>{var G=ye();l(N,G)};H(I,N=>{n(o).is_unsaved_edit&&N(V)},!0)}l(d,y)};H(Y,d=>{n(o).is_disk_change?d(k):d(v,!1)})}u(C);var w=b(C,2),D=f(w);u(w),u(m),B((d,y)=>{E=ut(m,1,"listitem compact svelte-vbresr",null,E,d),St(m,"title",n(o).label),S(T,y),S(D,`${n(o).content.length??""} chars`)},[()=>({selected:n(x),content_matches:n(P),plain:!n(x)&&!n(P)}),()=>Ft(new Date(n(o).created))]),X(3,m,()=>$),l(s,m)}),u(i),u(e),l(c,e),M()}dt(["click"]);var be=L('<small class="mb_xs display_block formatted"> </small>'),xe=(c,t)=>{g(t,!0)},pe=L('<div class="mt_xs"><!></div>'),we=L('<div class="my_xs font_size_sm"><!></div>'),Pe=L("<div><!></div>"),Ee=L('<div><div class="column"><!> <!></div> <!> <!></div>'),Ce=L('<div class="mb_xs"><!> <button type="button" class="plain compact"><!> <small class="ml_xs2">pick file</small></button></div> <!> <!>',1);function Je(c,t){K(t,!0);const e=R(t,"diskfile_part",7),r=R(t,"show_actions",3,!0),a=mt.get(),_=h(()=>e().diskfile);let i=q(void 0),s=q(void 0),o=q(!1);Dt(()=>{if(!n(_)){g(i,void 0),e().link_editor_state(null);return}Ht(()=>{if(!n(i)){g(i,new ue({app:a,diskfile:n(_)}),!0),e().link_editor_state(n(i));return}if(n(i).diskfile.id!==n(_).id){n(i).update_diskfile(n(_)),e().link_editor_state(n(i));return}n(_).content!==n(i).last_seen_disk_content&&n(i).check_disk_changes()})});var x=Ce(),P=F(x),m=f(P);{var E=w=>{var D=be(),d=f(D,!0);u(D),B(()=>S(d,n(_).path_relative)),l(w,D)};H(m,w=>{n(_)&&w(E)})}var C=b(m,2);C.__click=[xe,o];var p=f(C);Q(p,{get glyph(){return vt}}),at(2),u(C),u(P);var T=b(P,2);{var Y=w=>{var D=Ee(),d=f(D),y=f(d),I=()=>n(i).current_content,V=z=>{n(i)&&(n(i).current_content=z)};{let z=h(()=>yt+" "+n(_).path_relative);kt(ot(y,{get content(){return I()},set content(A){V(A)},get token_count(){return n(i).current_token_count},get placeholder(){return n(z)},show_stats:!1,readonly:!1,onsave:async A=>{await a.diskfiles.update(n(_).path,A)}}),A=>g(s,A,!0),()=>n(s))}var N=b(y,2);{var G=z=>{var A=pe(),Z=f(A);ae(Z,{get diskfile(){return n(_)},get editor_state(){return n(i)}}),u(A),l(z,A)};H(N,z=>{r()&&z(G)})}u(d);var j=b(d,2);{var O=z=>{var A=we(),Z=f(A);he(Z,{get editor_state(){return n(i)}}),u(A),l(z,A)};H(j,z=>{n(i)&&z(O)})}var nt=b(j,2);{var Pt=z=>{var A=Pe(),Z=f(A);ke(Z,{get editor_state(){return n(i)},onselectentry:Et=>{n(i)&&(n(i).set_content_from_history(Et),n(s)?.focus())}}),u(A),X(3,A,()=>$),l(z,A)};H(nt,z=>{n(i).has_history&&z(Pt)})}u(D),l(w,D)},k=w=>{{let D=h(()=>e().content||"");ot(w,{get content(){return n(D)},readonly:!0,placeholder:"[no file]",attrs:{disabled:!0}})}};H(T,w=>{n(_)&&n(i)?w(Y):w(k,!1)})}var v=b(T,2);{let w=h(()=>n(_)?[n(_).id]:[]);Nt(v,{get selected_ids(){return n(w)},onpick:D=>{D!==void 0&&(e().path=D&&D.path)},get show(){return n(o)},set show(D){g(o,D,!0)}})}l(c,x),M()}dt(["click"]);var Le=L("<input/>");function Ue(c,t){K(t,!0);const e=R(t,"part",7);var r=Le();et(r,()=>({type:"checkbox",class:"plain compact",title:`this part is ${e().enabled?"enabled":"disabled"} and ${e().enabled?"":"not "}included in the prompt`,...t.attrs}),void 0,void 0,void 0,!0),Mt(r,()=>e().enabled,a=>e().enabled=a),l(c,r),M()}function We(c,t){K(t,!0);const e=tt(t,["$$slots","$$events","$$legacy","part","prompt","prompts"]);{let r=h(()=>'"'+t.part.name+'"');st(c,rt(()=>e,{onconfirm:()=>{t.prompt?t.prompt.remove_part(t.part.id):t.prompts&&t.prompts.remove_part(t.part.id)},class:"plain compact",get title(){return`remove part ${n(r)??""}`},children:(a,_)=>{Q(a,{get glyph(){return Bt}})},$$slots:{default:!0}}))}M()}export{xt as C,he as D,Ue as P,$t as T,We as a,Ne as b,qe as c,Je as d,Fe as e,ue as f,Ve as g,ot as h,ae as i,ke as j};
