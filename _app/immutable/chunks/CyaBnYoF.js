import"./DsnmJJEf.js";import{p as M,e as U,a as K,x as n,y as c,b as l,c as F,f as L,d as v,r as h,t as j,a2 as it,s as x,h as q,L as V,z as y,a4 as Ct,a5 as Lt,n as at,g as Ht,J as Dt}from"./-CpFIzHZ.js";import{a as W,s as S,e as Rt,d as dt}from"./DzZ7Rzvg.js";import{i as D}from"./DH5XRg4H.js";import{c as ut,a as et,b as lt,f as Gt,e as Tt,s as Yt}from"./trDA34-_.js";import{p as R,s as rt,r as Z}from"./Rk-Dv8br.js";import{C as At}from"./DNrAa8_K.js";import{i as Q,p as zt,b as vt,w as ft,O as Ot,J as St,r as yt,P as gt,o as jt,E as ct,x as Bt}from"./CIQxfFOX.js";import{t as X,s as tt,c as ht}from"./D7AV01aJ.js";import{b as mt}from"./BiJ5jRlW.js";import{f as kt}from"./CtVB41cF.js";import{b as Mt,c as Ft}from"./DUXOEpA9.js";import{C as bt}from"./Bg2OdvGn.js";import{s as It}from"./V2q5a4YM.js";import{p as _t,q as Kt}from"./DHmKwG-o.js";import{C as st}from"./BYwzef9o.js";import{D as Jt}from"./C2D0UujT.js";var Nt=L("<!> ",1),Vt=L("<span><!></span>");function Ie(f,t){M(t,!0);const e=(p,g=it)=>{var P=Nt(),C=K(P);{var E=m=>{var u=q("disable");l(m,u)},G=m=>{var u=q("enable");l(m,u)};D(C,m=>{g()?m(E):m(G,!1)})}var Y=x(C);j(()=>S(Y,` ${_()??""}`)),l(p,P)},s=p=>{var g=Vt();let P;var C=v(g);Q(C,{get glyph(){return zt}}),h(g),j(()=>P=ut(g,1,"",null,P,{dormant:r(),font_size_xs:r()})),l(p,g)};let r=R(t,"enabled",15),o=R(t,"icon",3,s),i=R(t,"run",3,()=>{r(!r())}),_=R(t,"label",3,"item"),a=Z(t,["$$slots","$$events","$$legacy","enabled","icon","run","label","children"]);const b=c(()=>t.children??e);At(f,rt(()=>a,{get run(){return i()},get icon(){return o()},children:(p,g)=>{var P=U(),C=K(P);W(C,()=>n(b),r),l(p,P)},$$slots:{default:!0}})),F()}const qt=(f,t=",")=>{if(!t)return f;const e=f.indexOf("."),s=(e===-1?f.length:e)-1;let r=e===-1?"":f.slice(s+1),o=0;for(let i=s;i>=0;i--)o++,o>3&&o%3===1&&(r=t+r),r=f[i]+r;return r};var Ut=L('<div title="the token count is currently approximated using just one algorithm, when in practice models differ"> </div>'),Wt=L('<div class="display_flex gap_xs font_family_mono font_size_sm"><!></div>');function xt(f,t){M(t,!0);var e=Wt(),s=v(e);{var r=i=>{var _=q(" ");l(i,_)},o=i=>{var _=Ut(),a=v(_);h(_),j(b=>S(a,`≈ ${b??""} token${t.token_count===1?"":"s"}`),[()=>qt(t.token_count+"")]),l(i,_)};D(s,i=>{t.token_count?i(o,!1):i(r)})}h(e),l(f,e),F()}function Ke(f,t){M(t,!0);const e=c(()=>t.part.token_count??0);xt(f,{get token_count(){return n(e)}}),F()}const Qt={text:ft,diskfile:vt},Je=f=>Qt[f.type]??ft;var Xt=L("<button><!></button>");function pt(f,t){M(t,!0);const e=Z(t,["$$slots","$$events","$$legacy","onclipboardtext","onerror","children","class"]);var s=Xt(),r=async()=>{try{const a=await navigator.clipboard.readText();t.onclipboardtext(a)}catch(a){t.onerror?.(a)}};et(s,()=>({type:"button",title:"paste from clipboard",...e,class:`paste_from_clipboard ${t.class??""}`,onclick:r}));var o=v(s);{var i=a=>{var b=U(),p=K(b);W(p,()=>t.children),l(a,b)},_=a=>{var b=q("paste");l(a,b)};D(o,a=>{t.children?a(i):a(_,!1)})}h(s),l(f,s),F()}var Zt=L('<button><!> <span class="position_relative"><span class="display_inline_flex flex_direction_column height_0"><span><!></span> <span><!></span></span> <span class="position_absolute display_inline_flex align_items_center"><!></span></span></button>');function $t(f,t){M(t,!0);let e=R(t,"active",15),s=Z(t,["$$slots","$$events","$$legacy","active","active_content","inactive_content"]);var r=Zt(),o=()=>e(!e());et(r,()=>({type:"button",class:"plain icon_button",...s,onclick:o}));var i=v(r);W(i,()=>t.children??it);var _=x(i,2),a=v(_);lt(a,"",{},{visibility:"hidden"});var b=v(a),p=v(b);{var g=d=>{var k=q();j(()=>S(k,t.active_content)),l(d,k)},P=d=>{var k=U(),B=K(k);W(B,()=>t.active_content),l(d,k)};D(p,d=>{typeof t.active_content=="string"?d(g):d(P,!1)})}h(b);var C=x(b,2),E=v(C);{var G=d=>{var k=q();j(()=>S(k,t.inactive_content)),l(d,k)},Y=d=>{var k=U(),B=K(k);W(B,()=>t.inactive_content),l(d,k)};D(E,d=>{typeof t.inactive_content=="string"?d(G):d(Y,!1)})}h(C),h(a);var m=x(a,2);lt(m,"",{},{inset:"0"});var u=v(m);{var w=d=>{var k=U(),B=K(k);{var N=T=>{var z=q();j(()=>S(z,t.active_content)),l(T,z)},J=T=>{var z=U(),I=K(z);W(I,()=>t.active_content),l(T,z)};D(B,T=>{typeof t.active_content=="string"?T(N):T(J,!1)})}l(d,k)},H=d=>{var k=U(),B=K(k);{var N=T=>{var z=q();j(()=>S(z,t.inactive_content)),l(T,z)},J=T=>{var z=U(),I=K(z);W(I,()=>t.inactive_content),l(T,z)};D(B,T=>{typeof t.inactive_content=="string"?T(N):T(J,!1)},!0)}l(d,k)};D(u,d=>{e()?d(w):d(H,!1)})}h(m),h(_),h(r),l(f,r),F()}function wt(f,t){M(t,!0);let e=R(t,"value",15),s=R(t,"restore_icon",3,Ot),r=R(t,"clear_icon",3,St),o=Z(t,["$$slots","$$events","$$legacy","value","onchange","restore_icon","clear_icon"]),i=V("");const _=c(()=>!!e()),a=c(()=>!e()&&!n(i)),b=c(()=>n(_)?"clear":"restore");var p=()=>n(_),g=P=>{if(P){const C=n(i);y(i,""),e(C)}else y(i,e(),!0),e("")};$t(f,rt({get active(){return p()},set active(P){g(P)},get active_content(){return r()},get inactive_content(){return s()}},()=>o,{get disabled(){return n(a)},get title(){return n(b)}})),F()}var te=L('<div class="display_flex mt_xs"><!> <!> <!></div>'),ee=L('<div class="column width_100 flex_1"><div class="display_flex flex_1 gap_xs2 width_100"><textarea></textarea> <!></div> <!> <!> <!></div>');function ot(f,t){M(t,!0);let e=R(t,"content",15),s=R(t,"placeholder",3,yt),r=R(t,"readonly",3,!1),o=R(t,"show_stats",3,!1),i=R(t,"show_actions",3,!1),_=R(t,"pending_element_to_focus_key",15),a=V(void 0);const b=c(()=>t.token_count??_t(e())),p=()=>{n(a)?.focus()};var g={focus:p},P=ee();Rt("keydown",Ct,function(...d){(t.onsave?k=>{(k.ctrlKey||k.metaKey)&&k.key==="s"&&(It(k),t.onsave(e()))}:void 0)?.apply(this,d)});var C=v(P),E=v(C);Lt(E),et(E,()=>({...t.attrs,class:`plain mb_0 width_100 flex_1 ${t.attrs?.class??""}`,placeholder:s(),readonly:r(),style:`${t.textarea_height?`height: ${t.textarea_height};`:""} ${(t.attrs?.style||"")??""}`})),mt(E,d=>y(a,d),()=>n(a)),Gt(E,()=>t.focus_key==null?null:()=>{t.focus_key===_()&&(_(null),p())});var G=x(E,2);W(G,()=>t.children??it),h(C);var Y=x(C,2);{var m=d=>{xt(d,{get token_count(){return n(b)}})};D(Y,d=>{o()&&d(m)})}var u=x(Y,2);W(u,()=>t.after??it);var w=x(u,2);{var H=d=>{var k=te(),B=v(k);bt(B,{get text(){return e()},class:"plain"});var N=x(B,2);pt(N,{onclipboardtext:I=>{const nt=e()+I;e(nt),p()},class:"plain icon_button font_size_lg",children:(I,nt)=>{Q(I,{get glyph(){return gt}})},$$slots:{default:!0}});var J=x(N,2),T=()=>e(),z=I=>{e(I),p()};wt(J,{get value(){return T()},set value(I){z(I)}}),h(k),l(d,k)};D(w,d=>{i()&&!r()&&d(H)})}return h(P),Mt(E,e),l(f,P),F(g)}function Ne(f,t){M(t,!0);const e=R(t,"text_part",7),s=R(t,"show_actions",3,!0),r=Z(t,["$$slots","$$events","$$legacy","text_part","show_actions"]);ot(f,rt(()=>r,{get show_actions(){return s()},get content(){return e().content},set content(o){e().content=o}})),F()}var ne=L("<!> <!>",1),ie=L('<div class="mt_xs display_flex"><button class="flex_1 color_f" type="button">save changes</button></div>'),se=L('<div class="display_flex gap_xs"><!> <!> <!></div> <!>',1);function re(f,t){M(t,!0);const e=R(t,"editor_state",7),s=R(t,"readonly",3,!1),r=R(t,"auto_save",3,!1),o=kt.get();var i=se(),_=K(i),a=v(_);bt(a,{get text(){return e().current_content},class:"plain"});var b=x(a,2);{var p=E=>{var G=ne(),Y=K(G);pt(Y,{onclipboardtext:u=>{e().current_content+=u},class:"plain icon_button font_size_lg",children:(u,w)=>{Q(u,{get glyph(){return gt}})},$$slots:{default:!0}});var m=x(Y,2);wt(m,{get value(){return e().current_content},set value(u){e().current_content=u}}),l(E,G)};D(b,E=>{s()||E(p)})}var g=x(b,2);st(g,{onconfirm:()=>o.diskfiles.delete(t.diskfile.path),class:"plain icon_button",title:"delete file",children:(E,G)=>{Q(E,{get glyph(){return jt}})},$$slots:{default:!0}}),h(_);var P=x(_,2);{var C=E=>{var G=ie(),Y=v(G);Y.__click=()=>e().save_changes(),h(G),j(()=>Y.disabled=!e().has_changes),X(3,G,()=>tt),l(E,G)};D(P,E=>{!s()&&!r()&&E(C)})}l(f,i),F()}dt(["click"]);var ae=L("<span><!> </span>"),_e=L('<div class="white_space_nowrap"> </div>'),oe=L("<span><!> </span>"),de=L('<div class="white_space_nowrap"> </div>'),le=L('<div class="font_family_mono font_size_sm"><div class="display_flex justify_content_space_between"><div> <!></div> <!></div> <div class="display_flex justify_content_space_between"><div> <!></div> <!></div></div>');function ce(f,t){M(t,!0);var e=le(),s=v(e),r=v(s),o=v(r),i=x(o);{var _=m=>{var u=ae(),w=v(u);Q(w,{get glyph(){return ct}});var H=x(w);h(u),j(()=>S(H,` ${t.editor_state.current_length??""}`)),X(3,u,()=>ht,()=>({duration:80})),l(m,u)};D(i,m=>{t.editor_state.original_length!==t.editor_state.current_length&&m(_)})}h(r);var a=x(r,2);{var b=m=>{var u=_e(),w=v(u);h(u),j(()=>S(w,`${t.editor_state.length_diff>0?"+":""}${t.editor_state.length_diff??""} =
				${t.editor_state.length_diff>0?"+":""}${t.editor_state.length_diff_percent??""}%`)),X(3,u,()=>tt,()=>({axis:"x"})),l(m,u)};D(a,m=>{t.editor_state.length_diff&&m(b)})}h(s);var p=x(s,2),g=v(p),P=v(g),C=x(P);{var E=m=>{var u=oe(),w=v(u);Q(w,{get glyph(){return ct}});var H=x(w);h(u),j(()=>S(H,` ${t.editor_state.current_token_count??""}`)),X(3,u,()=>ht,()=>({duration:80})),l(m,u)};D(C,m=>{t.editor_state.original_token_count!==t.editor_state.current_token_count&&m(E)})}h(g);var G=x(g,2);{var Y=m=>{var u=de(),w=v(u);h(u),j(()=>S(w,`${t.editor_state.token_diff>0?"+":""}${t.editor_state.token_diff??""} =
				${t.editor_state.token_diff>0?"+":""}${t.editor_state.token_diff_percent??""}%`)),X(3,u,()=>tt,()=>({axis:"x"})),l(m,u)};D(G,m=>{t.editor_state.token_diff&&m(Y)})}h(p),h(e),j(()=>{S(o,`chars
			${t.editor_state.original_length??""} `),S(P,`tokens
			${t.editor_state.original_token_count??""} `)}),l(f,e),F()}class he{app;#e=V();get diskfile(){return n(this.#e)}set diskfile(t){y(this.#e,t,!0)}#n=V(null);get unsaved_edit_entry_id(){return n(this.#n)}set unsaved_edit_entry_id(t){y(this.#n,t,!0)}#i=V(null);get selected_history_entry_id(){return n(this.#i)}set selected_history_entry_id(t){y(this.#i,t,!0)}#s=V(!1);get content_was_modified_by_user(){return n(this.#s)}set content_was_modified_by_user(t){y(this.#s,t,!0)}#r=V(null);get last_seen_disk_content(){return n(this.#r)}set last_seen_disk_content(t){y(this.#r,t,!0)}#a=c(()=>this.diskfile.content);get original_content(){return n(this.#a)}set original_content(t){y(this.#a,t)}#_=c(()=>this.diskfile.path);get path(){return n(this.#_)}set path(t){y(this.#_,t)}#o=c(()=>this.original_content===null?this.current_content!=="":this.current_content!==this.original_content);get has_changes(){return n(this.#o)}set has_changes(t){y(this.#o,t)}#d=c(()=>this.app.get_diskfile_history(this.diskfile.path));get history(){return n(this.#d)}set history(t){y(this.#d,t)}#l=c(()=>this.history&&this.selected_history_entry_id?this.history.find_entry_by_id(this.selected_history_entry_id):null);get selected_history_entry(){return n(this.#l)}set selected_history_entry(t){y(this.#l,t)}#c=c(()=>this.history?.entries||[]);get content_history(){return n(this.#c)}set content_history(t){y(this.#c,t)}#h=c(()=>this.content_history.filter(t=>!t.is_unsaved_edit));get saved_history_entries(){return n(this.#h)}set saved_history_entries(t){y(this.#h,t)}#u=c(()=>this.content_history.filter(t=>t.is_unsaved_edit));get unsaved_history_entries(){return n(this.#u)}set unsaved_history_entries(t){y(this.#u,t)}#v=c(()=>this.content_history.length>1);get has_history(){return n(this.#v)}set has_history(t){y(this.#v,t)}#f=c(()=>this.unsaved_history_entries.length>0);get has_unsaved_edits(){return n(this.#f)}set has_unsaved_edits(t){y(this.#f,t)}#y=c(()=>this.saved_history_entries.length>1);get can_clear_history(){return n(this.#y)}set can_clear_history(t){y(this.#y,t)}#g=c(()=>this.unsaved_history_entries.length>0);get can_clear_unsaved_edits(){return n(this.#g)}set can_clear_unsaved_edits(t){y(this.#g,t)}#m=c(()=>this.unsaved_history_entries.map(t=>t.id));get unsaved_entry_ids(){return n(this.#m)}set unsaved_entry_ids(t){y(this.#m,t)}#k=c(()=>this.content_history.filter(t=>t.content===this.current_content).map(t=>t.id));get content_matching_entry_ids(){return n(this.#k)}set content_matching_entry_ids(t){y(this.#k,t)}#b=c(()=>this.original_content?.length??0);get original_length(){return n(this.#b)}set original_length(t){y(this.#b,t)}#x=c(()=>this.current_content.length);get current_length(){return n(this.#x)}set current_length(t){y(this.#x,t)}#p=c(()=>this.current_length-this.original_length);get length_diff(){return n(this.#p)}set length_diff(t){y(this.#p,t)}#w=c(()=>this.original_length>0?Math.round(this.length_diff/this.original_length*100):100);get length_diff_percent(){return n(this.#w)}set length_diff_percent(t){y(this.#w,t)}#P=c(()=>this.original_content==null?0:_t(this.original_content));get original_token_count(){return n(this.#P)}set original_token_count(t){y(this.#P,t)}#E=c(()=>_t(this.current_content));get current_token_count(){return n(this.#E)}set current_token_count(t){y(this.#E,t)}#C=c(()=>this.current_token_count-this.original_token_count);get token_diff(){return n(this.#C)}set token_diff(t){y(this.#C,t)}#L=c(()=>this.original_token_count>0?Math.round(this.token_diff/this.original_token_count*100):100);get token_diff_percent(){return n(this.#L)}set token_diff_percent(t){y(this.#L,t)}get current_content(){return this.selected_history_entry?this.selected_history_entry.content:this.original_content||""}set current_content(t){const e=t!==this.current_content;this.content_was_modified_by_user=t!==this.original_content,e&&this.#H(t)}constructor(t){this.app=t.app,this.diskfile=t.diskfile,this.last_seen_disk_content=this.diskfile.content;const e=this.#t();this.original_content!==null&&e.entries.length===0&&e.add_entry(this.original_content,{is_original_state:!0}),e.current_entry&&(this.selected_history_entry_id=e.current_entry.id)}#t(){let t=this.app.get_diskfile_history(this.path);return t||(t=this.app.create_diskfile_history(this.path)),this.original_content!==null&&t.entries.length===0&&t.add_entry(this.original_content,{is_original_state:!0}),t}#H(t){const e=this.#t();if(t===this.original_content){if(this.unsaved_edit_entry_id){const a=e.entries.findIndex(b=>b.id===this.unsaved_edit_entry_id);a!==-1&&e.entries.splice(a,1),this.unsaved_edit_entry_id=null}const _=e.entries.find(a=>!a.is_unsaved_edit&&a.content===this.original_content);_?this.selected_history_entry_id=_.id:this.selected_history_entry_id=e.current_entry?.id??null;return}if(this.unsaved_edit_entry_id){const _=e.find_entry_by_id(this.unsaved_edit_entry_id);if(_){_.content=t,this.selected_history_entry_id=this.unsaved_edit_entry_id;return}}const r=e.entries.find(_=>_.content===t&&_.is_unsaved_edit);if(r){this.selected_history_entry_id=r.id,this.unsaved_edit_entry_id=r.id;return}const o=e.entries.find(_=>_.content===t&&!_.is_unsaved_edit);if(o){this.selected_history_entry_id=o.id,this.unsaved_edit_entry_id=null;return}const i=e.add_entry(t,{created:Date.now(),label:"Unsaved edit",is_unsaved_edit:!0});this.unsaved_edit_entry_id=i.id,this.selected_history_entry_id=i.id}reset(){this.last_seen_disk_content=this.diskfile.content,this.content_was_modified_by_user=!1,this.unsaved_edit_entry_id=null,this.selected_history_entry_id=null}check_disk_changes(){if(this.diskfile.content===null)return;if(this.last_seen_disk_content===null){this.last_seen_disk_content=this.diskfile.content;return}if(this.diskfile.content===this.last_seen_disk_content)return;const t=this.#t(),e=t.entries[0];if(t.entries.length===0||!e||e.content!==this.diskfile.content){const s=t.add_entry(this.diskfile.content,{is_disk_change:!0,label:"Disk change"});this.content_was_modified_by_user||(this.selected_history_entry_id=s.id)}else e.is_disk_change=!0,e.is_unsaved_edit=!1;this.last_seen_disk_content=this.diskfile.content}async save_changes(){if(!this.has_changes)return!1;const t=this.#t(),e=this.current_content;if(this.unsaved_edit_entry_id!==null){const r=t.entries.findIndex(o=>o.id===this.unsaved_edit_entry_id);r!==-1&&t.entries.splice(r,1)}const s=t.add_entry(e);return await this.app.diskfiles.update(this.path,e),this.last_seen_disk_content=e,this.content_was_modified_by_user=!1,this.unsaved_edit_entry_id=null,this.selected_history_entry_id=s.id,!0}set_content_from_history(t){const e=this.history;if(!e)return;this.selected_history_entry_id=t;const s=e.find_entry_by_id(t);s&&(this.content_was_modified_by_user=s.content!==this.original_content,s.is_unsaved_edit?this.unsaved_edit_entry_id=t:this.unsaved_edit_entry_id=null)}update_diskfile(t){if(this.diskfile.id!==t.id&&(this.diskfile=t,this.reset(),this.original_content!==null)){const e=this.#t();e.entries.length===0&&e.add_entry(this.original_content,{is_original_state:!0}),e.current_entry&&(this.selected_history_entry_id=e.current_entry.id)}}clear_history(){const t=this.history;if(!t||t.entries.length<=1)return;const e=t.entries.filter(i=>!i.is_unsaved_edit),s=e.length>0?e[0]:null,o=[...t.entries.filter(i=>i.is_unsaved_edit)];s&&(o.push(s),s.is_original_state=!0),o.sort((i,_)=>_.created-i.created),t.entries=o,!this.selected_history_entry&&s&&(this.selected_history_entry_id=s.id)}clear_unsaved_edits(){const t=this.history;if(!t)return;const e=this.selected_history_entry?.is_unsaved_edit||!1;if(t.entries=t.entries.filter(s=>!s.is_unsaved_edit),this.unsaved_edit_entry_id=null,e){const s=t.entries.find(r=>r.content===this.original_content);s?this.selected_history_entry_id=s.id:t.current_entry?this.selected_history_entry_id=t.current_entry.id:this.selected_history_entry_id=null,this.content_was_modified_by_user=!1}}}var ue=L('<span class="ml_xl">from disk</span>'),ve=L('<span class="ml_xl">unsaved</span>'),fe=L('<button type="button"><span><span> </span> <!></span> <span> </span></button>'),ye=L('<div><small class="px_sm display_flex justify_content_space_between mb_sm"><!> <!></small> <menu></menu></div>');function ge(f,t){M(t,!0);var e=ye(),s=v(e),r=v(s);{let _=c(()=>!t.editor_state.can_clear_history),a=c(()=>t.editor_state.can_clear_history?"Clear history entries except the current disk state":"No history entries to clear");st(r,{onconfirm:()=>t.editor_state.clear_history(),position:"right",class:"plain compact",get disabled(){return n(_)},get title(){return n(a)},children:(b,p)=>{at();var g=q("clear history");l(b,g)},$$slots:{default:!0}})}var o=x(r,2);{let _=c(()=>!t.editor_state.can_clear_unsaved_edits),a=c(()=>t.editor_state.can_clear_unsaved_edits?"Remove all unsaved edit entries from history":"No unsaved edits to clear");st(o,{onconfirm:()=>{t.editor_state.clear_unsaved_edits()},class:"plain compact",get disabled(){return n(_)},get title(){return n(a)},children:(b,p)=>{at();var g=q("clear unsaved edits");l(b,g)},$$slots:{default:!0}})}h(s);var i=x(s,2);et(i,()=>({...t.attrs,class:`unstyled ${t.attrs?.class??"max_height_sm"??""}`}),void 0,void 0,void 0,"svelte-lgk5l3"),Tt(i,21,()=>t.editor_state.content_history,_=>_.id,(_,a)=>{const b=c(()=>n(a).id===t.editor_state.selected_history_entry_id),p=c(()=>t.editor_state.content_matching_entry_ids.includes(n(a).id));var g=fe();let P;g.__click=()=>t.onselectentry(n(a).id);var C=v(g),E=v(C),G=v(E,!0);h(E);var Y=x(E,2);{var m=d=>{var k=ue();l(d,k)},u=d=>{var k=U(),B=K(k);{var N=J=>{var T=ve();l(J,T)};D(B,J=>{n(a).is_unsaved_edit&&J(N)},!0)}l(d,k)};D(Y,d=>{n(a).is_disk_change?d(m):d(u,!1)})}h(C);var w=x(C,2),H=v(w);h(w),h(g),j(d=>{P=ut(g,1,"listitem compact svelte-lgk5l3",null,P,{selected:n(b),content_matches:n(p),plain:!n(b)&&!n(p)}),Yt(g,"title",n(a).label),S(G,d),S(H,`${n(a).content.length??""} chars`)},[()=>Kt(new Date(n(a).created))]),X(3,g,()=>tt),l(_,g)}),h(i),h(e),l(f,e),F()}dt(["click"]);var me=L('<small class="mb_xs display_block formatted"> </small>'),ke=L('<div class="mt_xs"><!></div>'),be=L('<div class="my_xs font_size_sm"><!></div>'),xe=L("<div><!></div>"),pe=L('<div><div class="column"><!> <!></div> <!> <!></div>'),we=L('<div class="mb_xs"><!> <button type="button" class="plain compact"><!> <small class="ml_xs2">pick file</small></button></div> <!> <!>',1);function Ve(f,t){M(t,!0);const e=R(t,"diskfile_part",7),s=R(t,"show_actions",3,!0),r=kt.get(),o=c(()=>e().diskfile);let i=V(void 0),_=V(void 0),a=V(!1);Ht(()=>{if(!n(o)){y(i,void 0),e().link_editor_state(null);return}Dt(()=>{if(!n(i)){y(i,new he({app:r,diskfile:n(o)}),!0),e().link_editor_state(n(i));return}if(n(i).diskfile.id!==n(o).id){n(i).update_diskfile(n(o)),e().link_editor_state(n(i));return}n(o).content!==n(i).last_seen_disk_content&&n(i).check_disk_changes()})});var b=we(),p=K(b),g=v(p);{var P=w=>{var H=me(),d=v(H,!0);h(H),j(()=>S(d,n(o).path_relative)),l(w,H)};D(g,w=>{n(o)&&w(P)})}var C=x(g,2);C.__click=()=>{y(a,!0)};var E=v(C);Q(E,{get glyph(){return vt}}),at(2),h(C),h(p);var G=x(p,2);{var Y=w=>{var H=pe(),d=v(H),k=v(d),B=()=>n(i).current_content,N=O=>{n(i)&&(n(i).current_content=O)};{let O=c(()=>yt+" "+n(o).path_relative);mt(ot(k,{get content(){return B()},set content(A){N(A)},get token_count(){return n(i).current_token_count},get placeholder(){return n(O)},show_stats:!1,readonly:!1,onsave:async A=>{await r.diskfiles.update(n(o).path,A)}}),A=>y(_,A,!0),()=>n(_))}var J=x(k,2);{var T=O=>{var A=ke(),$=v(A);re($,{get diskfile(){return n(o)},get editor_state(){return n(i)}}),h(A),l(O,A)};D(J,O=>{s()&&O(T)})}h(d);var z=x(d,2);{var I=O=>{var A=be(),$=v(A);ce($,{get editor_state(){return n(i)}}),h(A),l(O,A)};D(z,O=>{n(i)&&O(I)})}var nt=x(z,2);{var Pt=O=>{var A=xe(),$=v(A);ge($,{get editor_state(){return n(i)},onselectentry:Et=>{n(i)&&(n(i).set_content_from_history(Et),n(_)?.focus())}}),h(A),X(3,A,()=>tt),l(O,A)};D(nt,O=>{n(i).has_history&&O(Pt)})}h(H),l(w,H)},m=w=>{{let H=c(()=>e().content||"");ot(w,{get content(){return n(H)},readonly:!0,placeholder:"[no file]",attrs:{disabled:!0}})}};D(G,w=>{n(o)&&n(i)?w(Y):w(m,!1)})}var u=x(G,2);{let w=c(()=>n(o)?[n(o).id]:[]);Jt(u,{get selected_ids(){return n(w)},onpick:H=>{H!==void 0&&(e().path=H&&H.path)},get show(){return n(a)},set show(H){y(a,H,!0)}})}l(f,b),F()}dt(["click"]);var Pe=L("<input/>");function qe(f,t){M(t,!0);const e=R(t,"part",7);var s=Pe();et(s,()=>({type:"checkbox",class:"plain compact",title:`this part is ${e().enabled?"enabled":"disabled"} and ${e().enabled?"":"not "}included in the prompt`,...t.attrs}),void 0,void 0,void 0,void 0,!0),Ft(s,()=>e().enabled,r=>e().enabled=r),l(f,s),F()}function Ue(f,t){M(t,!0);const e=Z(t,["$$slots","$$events","$$legacy","part","prompt","prompts"]);{let s=c(()=>'"'+t.part.name+'"');st(f,rt(()=>e,{onconfirm:()=>{t.prompt?t.prompt.remove_part(t.part.id):t.prompts&&t.prompts.remove_part(t.part.id)},class:"plain compact",get title(){return`remove part ${n(s)??""}`},children:(r,o)=>{Q(r,{get glyph(){return Bt}})},$$slots:{default:!0}}))}F()}export{xt as C,ce as D,qe as P,$t as T,Ue as a,Ke as b,Ne as c,Ve as d,Ie as e,he as f,Je as g,ot as h,re as i,ge as j};
