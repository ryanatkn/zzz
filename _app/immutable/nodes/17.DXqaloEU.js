import"../chunks/DsnmJJEf.js";import{s as j,d as se,a as Ee,f as Pe,e as Le}from"../chunks/DzZ7Rzvg.js";import{p as Q,f as g,d as i,x as e,y as I,r as t,b as _,c as U,e as $,a as N,s as c,a2 as Re,t as q,L as ae,a9 as me,g as ue,z as O,u as ze,J as He,ap as Ge,n as be}from"../chunks/-CpFIzHZ.js";import{i as A}from"../chunks/DH5XRg4H.js";import{c as de,e as ke,s as ne,f as pe}from"../chunks/trDA34-_.js";import{s as ie,i as Te}from"../chunks/V2q5a4YM.js";import{r as Oe}from"../chunks/CF_rgvJJ.js";import{P as ye}from"../chunks/9LCMksTx.js";import{f as ee,h as Ye}from"../chunks/CjAsNweL.js";import{t as J,s as te,f as Ae,b as Fe}from"../chunks/D7AV01aJ.js";import{P as ge}from"../chunks/Bbu_b0BK.js";import{a as Se,b as xe,D as Ce}from"../chunks/C2bowmR0.js";import{i as W,L as Ie,M as Ke,N as Me,A as Ne,b as qe,n as Ve,E as je,k as We,r as Be,x as Je}from"../chunks/CIQxfFOX.js";import{S as Qe,a as he,s as oe}from"../chunks/BlkkiOfe.js";import{b as Ue}from"../chunks/BiJ5jRlW.js";import{D as Xe,f as Ze,h as $e,i as et,j as tt}from"../chunks/joER-KjB.js";import{r as at}from"../chunks/D06rzCAg.js";import{P as it}from"../chunks/NHSGjllA.js";import{D as fe}from"../chunks/CH9V2Gy3.js";import{R as st}from"../chunks/Dx4JTTsB.js";import{E as rt}from"../chunks/ZMi9mf8B.js";var lt=g("<div>&nbsp;</div>"),ot=g('<div class="row height_input_height"><!></div>'),nt=g('<button type="button" title="toggle sort controls"><!></button>'),dt=g("<div><!></div>"),_t=g('<div class="row height_input_height justify_content_space_between px_xs"><small class="ellipsis"><!> </small> <div class="display_flex gap_xs2"><!> <!> <!></div></div> <!> <!>',1),ct=g('<div class="height_100 overflow_auto scrollbar_width_thin"><!></div>');function vt(T,a){Q(a,!0);const D=ee.get(),{diskfiles:s}=D,{editor:v}=s,l=I(()=>D.zzz_dir),u=!1,o=!1,f=async()=>{if(!e(l)){alert("cannot create file: filesystem is not available");return}const y=prompt("new file name:");if(y)try{await s.create_file(y)}catch(n){console.error("failed to create file:",n),alert(`failed to create file: ${n}`)}},k=async()=>{if(!e(l)){alert("cannot create folder: filesystem is not available");return}const y=prompt("New folder name:");if(y)try{await s.create_directory(y)}catch(n){console.error("failed to create folder:",n),alert(`failed to create folder: ${n}`)}};var E=ct(),G=i(E);{var R=y=>{var n=lt();_(y,n)},x=y=>{var n=$(),C=N(n);{var r=d=>{var w=ot(),p=i(w);ye(p,{}),t(w),_(d,w)},m=d=>{var w=_t(),p=N(w),b=i(p),h=i(b);W(h,{get glyph(){return Ie}});var Y=c(h);t(b);var K=c(b,2),X=i(K);ge(X,{pending:u,class:"plain compact",get title(){return`create file in ${e(l)??""}`},onclick:f,children:(z,L)=>{W(z,{get glyph(){return Ke}})},$$slots:{default:!0}});var Z=c(X,2);ge(Z,{pending:o,class:"plain compact",get title(){return`create folder in ${e(l)??""}`},onclick:k,children:(z,L)=>{W(z,{get glyph(){return Me}})},$$slots:{default:!0}});var _e=c(Z,2);{var ce=z=>{var L=nt();let S;L.__click=()=>v.toggle_sort_controls();var H=i(L);W(H,{get glyph(){return Ne}}),t(L),q(()=>S=de(L,1,"plain compact selectable deselectable",null,S,{selected:v.show_sort_controls})),_(z,L)};A(_e,z=>{D.diskfiles.items.size>1&&z(ce)})}t(K),t(p);var re=c(p,2);{const z=(H,P=Re)=>{const B=I(()=>s.selected_file_id===P().id);var V=dt();let le;var ve=i(V);Se(ve,{get diskfile(){return P()},get selected(){return e(B)},onselect:(we,De)=>{s.select(we.id,De)}}),t(V),q(()=>le=de(V,1,"diskfile_listitem_wrapper svelte-1a3hakb",null,le,{selected:e(B)})),J(3,V,()=>te),_(H,V)};let L=I(()=>[he("path_asc","path (a-z)","path_relative"),he("path_desc","path (z-a)","path_relative","desc"),oe("updated_newest","updated (latest)","updated","desc"),oe("updated_oldest","updated (past)","updated","asc"),oe("created_newest","created (newest)","created","desc"),oe("created_oldest","created (oldest)","created","asc")]),S=I(()=>a.empty?void 0:"[no files available]");Qe(re,{get items(){return s.items.values},get show_sort_controls(){return v.show_sort_controls},get sorters(){return e(L)},sort_key_default:"path_asc",get no_items(){return e(S)},children:z,$$slots:{default:!0}})}var F=c(re,2);{var M=z=>{var L=$(),S=N(L);Ee(S,()=>a.empty),_(z,L)};A(F,z=>{a.empty&&s.items.size===0&&z(M)})}q(()=>j(Y,` ${e(l)??""}`)),_(d,w)};A(C,d=>{e(l)===null?d(r):d(m,!1)},!0)}_(y,n)};A(G,y=>{e(l)===void 0?y(R):y(x,!1)})}t(E),_(T,E),U()}se(["click"]);var ft=g("<div> </div>"),ut=g('<small class="font_family_mono"><div> </div> <div> </div></small>'),mt=g('<div class="display_flex flex_direction_column gap_xs width_100"><small class="overflow_wrap_break_all width_100"><!> </small> <small><div> </div> <!></small> <!> <!> <small class="font_family_mono"> </small></div>');function bt(T,a){Q(a,!0);const D=ee.get();var s=mt(),v=i(s),l=i(v);W(l,{get glyph(){return qe}});var u=c(l,1,!0);t(v);var o=c(v,2),f=i(o),k=i(f);t(f);var E=c(f,2);{var G=r=>{var m=ft(),d=i(m);t(m),q(()=>j(d,`updated ${a.diskfile.updated_formatted_datetime??""}`)),J(3,m,()=>te),_(r,m)};A(E,r=>{a.diskfile.updated_formatted_datetime!==a.diskfile.created_formatted_datetime&&r(G)})}t(o);var R=c(o,2);Xe(R,{get editor_state(){return a.editor_state}});var x=c(R,2);{var y=r=>{var m=ut(),d=i(m),w=i(d);t(d);var p=c(d,2),b=i(p);t(p),t(m),q(()=>{j(w,`${a.diskfile.dependencies_count??""} dependencies`),j(b,`${a.diskfile.dependents_count??""} dependents`)}),J(3,m,()=>te),_(r,m)};A(x,r=>{Ye(a.diskfile)&&r(y)})}var n=c(x,2),C=i(n,!0);t(n),t(s),q(r=>{j(u,r),j(k,`created ${a.diskfile.created_formatted_datetime??""}`),j(C,a.diskfile.id)},[()=>D.diskfiles.to_relative_path(a.diskfile.path)]),_(T,s),U()}var pt=g('<a class="prompt_ref svelte-1ul6cxc"> </a>'),gt=g('<div class="prompt_refs font_size_xs mt_xs2 svelte-1ul6cxc"><span class="text_color_5"> </span> <!></div>'),ht=g('<div class="panel p_md"><h3 class="mt_0 mb_sm">Referenced by part</h3> <div class="column gap_xs"><div class="part_reference svelte-1ul6cxc"><!> <!></div></div></div>');function kt(T,a){Q(a,!0);const D=ee.get(),s=I(()=>a.diskfile.part),v=I(()=>e(s)?D.prompts.filter_by_part(e(s)):null);var l=$(),u=N(l);{var o=f=>{var k=ht(),E=c(i(k),2),G=i(E),R=i(G);it(R,{get part(){return e(s)}});var x=c(R,2);{var y=n=>{var C=gt(),r=i(C),m=i(r);t(r);var d=c(r,2);ke(d,17,()=>e(v),w=>w.id,(w,p)=>{var b=pt(),h=i(b,!0);t(b),q(Y=>{ne(b,"href",Y),j(h,e(p).name)},[()=>at(`/prompts/${e(p).id}`)]),_(w,b)}),t(C),q(()=>j(m,`In prompt${e(v).length!==1?"s":""}:`)),_(n,C)};A(x,n=>{e(v)?.length&&n(y)})}t(G),t(E),t(k),J(3,k,()=>te),_(f,k)};A(u,f=>{e(s)&&f(o)})}_(T,l),U()}var yt=g('<div class="browser_nav display_flex gap_xs svelte-2yyh3u"><button type="button" class="icon_button plain p_xs border_radius_lg" title="previous diskfile"><!></button> <button type="button" class="icon_button plain p_xs border_radius_lg" title="next diskfile"><!></button> <button type="button" class="icon_button plain p_xs border_radius_lg" title="refresh from disk" disabled><!></button></div>');function xt(T,a){Q(a,!0);const D=ee.get(),{diskfiles:s}=D,{editor:v}=s;let l=ae(me([])),u=ae(me([])),o=ae(null);ue(()=>{v.tabs.selected_tab_id&&e(o)===null&&O(o,v.tabs.selected_tab_id,!0)}),ue(()=>{const d=v.tabs.selected_tab_id;d&&d!==e(o)&&(e(o)&&O(l,[e(o),...e(l)],!0),O(u,[],!0),O(o,d,!0))});const f=I(()=>e(l).length>0),k=I(()=>e(u).length>0),E=()=>{if(!e(f))return;const d=e(l)[0];if(!d)return;const w=e(l).slice(1);e(o)&&O(u,[e(o),...e(u)],!0),O(l,w,!0);const p=v.tabs.navigate_to_tab(d);p.resulting_tab_id&&(p.resulting_tab_id!==d?(O(o,p.resulting_tab_id,!0),O(u,e(u).map(b=>b===d?p.resulting_tab_id:b),!0)):O(o,p.resulting_tab_id,!0))},G=()=>{if(!e(k))return;const d=e(u)[0];if(!d)return;const w=e(u).slice(1);e(o)&&O(l,[e(o),...e(l)],!0),O(u,w,!0);const p=v.tabs.navigate_to_tab(d);p.resulting_tab_id&&(p.resulting_tab_id!==d?(O(o,p.resulting_tab_id,!0),O(l,e(l).map(b=>b===d?p.resulting_tab_id:b),!0)):O(o,p.resulting_tab_id,!0))};var R=yt(),x=i(R);x.__click=E;var y=i(x);W(y,{get glyph(){return Ve}}),t(x);var n=c(x,2);n.__click=G;var C=i(n);W(C,{get glyph(){return je}}),t(n);var r=c(n,2);r.__click=()=>{a.editor_state};var m=i(r);W(m,{get glyph(){return We}}),t(r),t(R),q(()=>{x.disabled=!e(f),n.disabled=!e(k)}),_(T,R),U()}se(["click"]);var wt=g(`<div class="pt_lg"><div><aside><p>⚠️ This filesystem interface is an early proof of concept and lacks most features you'd
					expect. Some basics work if you're using this with Node, and there will be more soon.
					Chatting creates files, and you can modify and save them, and see the edit history.</p> <button type="button" class="compact">ok</button></aside></div></div>`);function Dt(T,a){Q(a,!0);const D=ee.get();var s=$(),v=N(s);{var l=u=>{var o=wt(),f=i(o),k=i(f),E=c(i(k),2);E.__click=()=>{D.ui.tutorial_for_diskfiles=!1},t(k),t(f),t(o),J(2,k,()=>Ae,()=>({duration:fe,x:10,y:-1})),J(2,f,()=>Fe,()=>({duration:fe})),J(2,o,()=>te,()=>({delay:fe})),_(u,o)};A(v,u=>{D.ui.tutorial_for_diskfiles&&u(l)})}_(T,s),U()}se(["click"]);var Et=g("<div><!></div>"),Pt=g('<div class="display_flex height_100"><div class="flex_1 width_atleast_sm height_100 column"><!></div> <div class="width_upto_sm width_atleast_sm py_md"><div class="px_md mb_lg"><!></div> <div class="px_md mb_lg"><!></div> <div class="px_md mb_lg"><!></div> <!> <!> <div class="px_md"><!></div></div></div>');function Lt(T,a){Q(a,!0);const D=ee.get(),s=new Ze({app:D,diskfile:a.diskfile});let v=ae(void 0);ze(()=>{s.content_was_modified_by_user&&a.onmodified?.(a.diskfile.id)}),ue(()=>{const l=a.diskfile.id,u=a.diskfile.content;He(()=>{s.diskfile.id!==l?s.update_diskfile(a.diskfile):u!==s.last_seen_disk_content&&s.check_disk_changes()})}),xe(T,{get diskfile(){return a.diskfile},children:(l,u)=>{var o=Pt(),f=i(o),k=i(f);{let b=I(()=>Be+" "+a.diskfile.path_relative);Ue($e(k,{get token_count(){return s.current_token_count},get placeholder(){return e(b)},readonly:!1,attrs:{class:"height_100 border_radius_0"},onsave:async h=>{await D.diskfiles.update(a.diskfile.path,h)},get content(){return s.current_content},set content(h){s.current_content=h}}),h=>O(v,h,!0),()=>e(v))}t(f);var E=c(f,2),G=i(E),R=i(G);et(R,{get diskfile(){return a.diskfile},get editor_state(){return s}}),t(G);var x=c(G,2),y=i(x);xt(y,{get editor_state(){return s}}),t(x);var n=c(x,2),C=i(n);bt(C,{get diskfile(){return a.diskfile},get editor_state(){return s}}),t(n);var r=c(n,2);{var m=b=>{var h=Et(),Y=i(h);tt(Y,{get editor_state(){return s},onselectentry:K=>{s.set_content_from_history(K),e(v)?.focus()}}),t(h),J(3,h,()=>te),_(b,h)};A(r,b=>{s.has_history&&b(m)})}var d=c(r,2);kt(d,{get diskfile(){return a.diskfile}});var w=c(d,2),p=i(w);Dt(p,{}),t(w),t(E),t(o),_(l,o)},$$slots:{default:!0}}),U()}var Rt=g('<div><div role="button" tabindex="0"><div class="ellipsis font_weight_400 flex_1"><small class="ml_xs"> </small></div> <button type="button" class="tab_close_button plain icon_button compact border_radius_md ml_sm" title="close tab"><!></button></div></div>');function zt(T,a){Q(a,!0);const D=I(()=>a.tab.diskfile),s=I(()=>e(D)?.path_relative??"[no diskfile found]");xe(T,{get diskfile(){return e(D)},children:(v,l)=>{var u=Rt();let o;var f=i(u);let k;f.__click=n=>{ie(n),a.tab.is_preview&&n.detail===2?a.onopen(a.tab):a.onselect(a.tab)},f.__keydown=n=>{(n.key==="Enter"||n.key===" ")&&(ie(n),a.onselect(a.tab))};var E=i(f),G=i(E),R=i(G,!0);t(G),t(E);var x=c(E,2);x.__click=n=>{ie(n),a.onclose(a.tab)};var y=i(x);W(y,{get glyph(){return Je}}),t(x),t(f),t(u),q(()=>{o=de(u,1,"diskfile_tab_container svelte-16lvq1g",null,o,{selected:a.tab.is_selected,preview:a.tab.is_preview}),k=de(f,1,"diskfile_tab_button border_radius_0 plain px_sm py_xs svelte-16lvq1g",null,k,{selected:a.tab.is_selected,preview:a.tab.is_preview}),ne(f,"aria-label",`Tab ${e(s)}`),ne(f,"aria-pressed",a.tab.is_selected),j(R,e(s)),ne(x,"aria-label",`close tab ${e(s)}`)}),_(v,u)},$$slots:{default:!0}}),U()}se(["click","keydown"]);var Ht=g(`<p>Filesystem is not available. File management requires a backend connection with
						filesystem access.</p> <p class="mt_md"><button type="button">retry connection</button></p>`,1),Gt=g('<div class="box height_100 width_100"><div class="width_upto_sm"><!></div></div>'),Tt=g('<div class="box height_100 width_100 display_flex align_items_center justify_content_center"><div class="text_align_center"><p class="mt_md">loading filesystem <!></p></div></div>'),Ot=g('<li class="display_flex py_xs3 px_xs4"><div class="display_flex"><!></div></li>'),Yt=g('<div class="box height_100"><p>Something went wrong, this tab has no diskfile</p></div>'),At=g('<div class="box height_100"><p><button type="button" class="inline">select</button> a file from the list or <button type="button" class="inline color_f">go fish</button> to view and edit its content</p></div>'),Ft=g('<div class="box height_100"><p>no files yet, <button type="button" class="inline color_d">create a new file</button>?</p></div>'),St=g('<div class="height_100 overflow_hidden width_upto_sm"><!></div> <div class="flex_1 column overflow_auto height_100"><menu class="unstyled display_flex overflow_x_auto scrollbar_width_thin"></menu> <!></div>',1),Ct=g('<div class="height_100 display_flex"><!></div> <!>',1);function It(T,a){Q(a,!0);const D=ee.get(),{diskfiles:s,capabilities:v}=D,{editor:l}=s,u=new st({item_class:null}),o=I(()=>l.tabs.selected_tab),f=I(()=>e(o)?s.items.by_id.get(e(o).diskfile_id):void 0);let k=ae(!1);Pe(()=>{v.init_backend_check()});const E=async()=>{if(!D.zzz_dir){alert("cannot create file: filesystem is not available");return}const r=prompt("new file name:");if(r)try{await s.create_file(r)}catch(m){console.error("failed to create file:",m),alert(`failed to create file: ${m}`)}};var G=Ct();Le("keydown",Ge,r=>{if(!Te(r.target)){if(r.ctrlKey&&!r.shiftKey&&!r.altKey&&r.key==="q"){ie(r);const m=l.tabs.selected_tab;m&&l.close_tab(m.id)}r.ctrlKey&&r.shiftKey&&r.key==="Q"&&(ie(r),l.reopen_last_closed_tab())}});var R=N(G),x=i(R);{var y=r=>{var m=Gt(),d=i(m),w=i(d);rt(w,{children:(p,b)=>{var h=Ht(),Y=c(N(h),2),K=i(Y);K.__click=()=>v.check_backend(),t(Y),q(()=>K.disabled=v.backend.status==="pending"),_(p,h)},$$slots:{default:!0}}),t(d),t(m),_(r,m)},n=r=>{var m=$(),d=N(m);{var w=b=>{var h=Tt(),Y=i(h),K=i(Y),X=c(i(K));ye(X,{inline:!0}),t(K),t(Y),t(h),_(b,h)},p=b=>{var h=St(),Y=N(h),K=i(Y);vt(K,{}),t(Y);var X=c(Y,2),Z=i(X);ke(Z,23,()=>l.tabs.ordered_tabs,F=>F.id,(F,M,z)=>{var L=Ot(),S=i(L),H=i(S);zt(H,{get tab(){return e(M)},onselect:P=>s.select(P.diskfile_id),onclose:P=>{P.diskfile_id===e(f)?.id&&s.select(null),l.close_tab(P.id)},onopen:P=>l.open_tab(P.id)}),t(S),pe(S,()=>u.item({index:e(z)})),t(L),_(F,L)}),t(Z),pe(Z,()=>u.list({onreorder:(F,M)=>l.reorder_tabs(F,M)}));var _e=c(Z,2);{var ce=F=>{var M=$(),z=N(M);{var L=H=>{Lt(H,{get diskfile(){return e(f)},onmodified:P=>l.handle_file_modified(P)})},S=H=>{var P=Yt();_(H,P)};A(z,H=>{e(f)?H(L):H(S,!1)})}_(F,M)},re=F=>{var M=$(),z=N(M);{var L=H=>{var P=At(),B=i(P),V=i(B);V.__click=()=>{O(k,!0)};var le=c(V,2);le.__click=()=>{const ve=Oe(D.diskfiles.items.values);s.select(ve.id)},be(),t(B),t(P),_(H,P)},S=H=>{var P=Ft(),B=i(P),V=c(i(B));V.__click=E,be(),t(B),t(P),_(H,P)};A(z,H=>{s.items.size>0?H(L):H(S,!1)},!0)}_(F,M)};A(_e,F=>{e(o)?F(ce):F(re,!1)})}t(X),_(b,h)};A(d,b=>{v.filesystem_available===null||v.filesystem_available===void 0?b(w):b(p,!1)},!0)}_(r,m)};A(x,r=>{v.filesystem_available===!1?r(y):r(n,!1)})}t(R);var C=c(R,2);Ce(C,{onpick:r=>r?(s.select(r.id),!0):!1,get show(){return e(k)},set show(r){O(k,r,!0)}}),_(T,G),U()}se(["click"]);function oa(T){It(T,{})}export{oa as component};
