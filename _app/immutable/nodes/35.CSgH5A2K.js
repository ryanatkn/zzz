import"../chunks/DsnmJJEf.js";import{I as H,x as u,z as y,y as D,a9 as xe,p as te,e as O,a as S,b as c,f as P,d as i,r as o,t as J,c as se,s as b,ap as ke,n as F,h as N}from"../chunks/vp8LXHGR.js";import{e as $,r as be,a as fe,d as ne,s as ve}from"../chunks/pja_h9dl.js";import{p as pe,i as U}from"../chunks/Dl5udER_.js";import{s as I,c as M,e as ze,f as ue,b as Le,r as Ee}from"../chunks/Bs1WACQy.js";import{i as G,x as Te,j as Ae,n as He,E as Pe,k as Be,r as Ie,F as Re}from"../chunks/CtEBPyZ8.js";import{d as de,C as ce,g as me,h as V,H as oe}from"../chunks/DTG56X07.js";import{I as je,a as Ce,b as Ge,d as Fe,f as Ke}from"../chunks/Dt1T9vKA.js";import{s as Z,_ as Se,n as Ue,h as we,k as _e,a as le}from"../chunks/Dz-m46CK.js";import{b as Ye}from"../chunks/ovaY63up.js";import{s as q,i as De}from"../chunks/V2q5a4YM.js";import{k as Oe}from"../chunks/DaARz4O6.js";import{R as Ze}from"../chunks/DU5r4Hwp.js";import{E as he}from"../chunks/C4hxwCfw.js";const ee=ce.extend({title:Z(),url:Z(),selected:we().default(!1),refresh_counter:Ue().default(0),type:Se(["raw","embedded_html","external_url"]),content:Z().optional()}).meta({cell_class_name:"BrowserTab"});class Q extends de{#e=H();get title(){return u(this.#e)}set title(e){y(this.#e,e,!0)}#t=H();get url(){return u(this.#t)}set url(e){y(this.#t,e,!0)}#s=H();get selected(){return u(this.#s)}set selected(e){y(this.#s,e,!0)}#r=H();get refresh_counter(){return u(this.#r)}set refresh_counter(e){y(this.#r,e,!0)}#a=H();get type(){return u(this.#a)}set type(e){y(this.#a,e,!0)}#i=H();get content(){return u(this.#i)}set content(e){y(this.#i,e,!0)}constructor(e){super(ee,e),this.init()}refresh(){this.refresh_counter++}}_e(Q);const qe={new_tab:{content:`
			<div style="padding: 20px; font-family: system-ui;">
				<h1>new tab</h1>
				<ul>
					<li><a href="https://www.zzz.software/about" target="_blank" rel="noopener">about Zzz</a></li>
					<li><a href="https://github.com/fuzdev/zzz" target="_blank" rel="noopener">source code</a></li>
				</ul>
			</div>
		`}},K=me(),Je=[{id:V(),title:"Zzz is a browser",url:"https://www.zzz.software/tabs",type:"raw",selected:!0,refresh_counter:0,created:K,updated:K},{id:V(),title:"Fuz CSS",selected:!1,url:"https://css.fuz.dev/",type:"external_url",refresh_counter:0,created:K,updated:K},{id:V(),title:"Fuz UI",selected:!1,url:"https://ui.fuz.dev/",type:"external_url",refresh_counter:0,created:K,updated:K}],Me=ce.extend({tabs:le(ee).default(()=>[]),recently_closed_tabs:le(ee).default(()=>[])}).meta({cell_class_name:"BrowserTabs"});class ye extends de{items=new je({indexes:[Ce({key:"url",extractor:e=>e.url,query_schema:Z()}),Ge({key:"manual_order",compute:e=>e.values})]});#e=D(()=>this.items.derived_index("manual_order"));get ordered_tabs(){return u(this.#e)}set ordered_tabs(e){y(this.#e,e)}#t=H(xe([]));get recently_closed_tabs(){return u(this.#t)}set recently_closed_tabs(e){y(this.#t,e,!0)}#s=D(()=>this.ordered_tabs.find(e=>e.selected));get selected_tab(){return u(this.#s)}set selected_tab(e){y(this.#s,e)}#r=D(()=>this.selected_tab?.url||"");get selected_url(){return u(this.#r)}set selected_url(e){y(this.#r,e)}constructor(e){super(Me,e),this.decoders={tabs:t=>{if(Array.isArray(t)){this.items.clear();for(const a of t){const s=new Q({app:this.app,json:a});this.items.add(s)}}return oe},recently_closed_tabs:t=>(Array.isArray(t)&&(this.recently_closed_tabs=t.map(a=>new Q({app:this.app,json:a}))),oe)},this.init()}add(e){const t=new Q({app:this.app,json:e});this.items.add(t)}add_new_tab(){for(const t of this.items.by_id.values())t.selected=!1;const e=me();this.add({id:V(),title:"new tab",selected:!0,url:"/newtab",type:"embedded_html",content:qe.new_tab.content,refresh_counter:0,created:e,updated:e})}close(e){const t=this.ordered_tabs;if(e>=0&&e<t.length){const a=t[e];if(!a)return;const s=a.selected;if(this.recently_closed_tabs.push(a),this.items.remove(a.id),s&&this.ordered_tabs.length>0){const p=Math.min(this.ordered_tabs.length-1,e),h=this.ordered_tabs[p];h&&(h.selected=!0)}}}reopen_last_closed_tab(){if(this.recently_closed_tabs.length>0){const e=this.recently_closed_tabs.pop();if(e){if(e.selected)for(const t of this.items.by_id.values())t.selected=!1;this.items.add(e)}}}select(e){const t=this.ordered_tabs;if(e>=0&&e<t.length)for(let a=0;a<t.length;a++){const s=t[a];s&&(s.selected=a===e)}}update_url(e){const t=this.selected_tab;t&&(t.url=e,t.type==="embedded_html"&&e!=="~newtab"&&e!=="/newtab"&&(t.type="external_url",t.content=void 0),t.type==="external_url"&&t.refresh())}refresh_selected(){const e=this.selected_tab;e&&e.refresh()}reorder_tabs(e,t){this.items.indexes.manual_order=Fe(this.ordered_tabs,e,t)}}_e(ye);const We=ce.extend({tabs:le(ee).default(()=>[]),edited_url:Z().default(""),browserified:we().default(!1)}).meta({cell_class_name:"Browser"});class ge extends de{tabs=new ye({app:this.app});#e=H();get edited_url(){return u(this.#e)}set edited_url(e){y(this.#e,e,!0)}#t=H();get browserified(){return u(this.#t)}set browserified(e){y(this.#t,e,!0)}#s=D(()=>this.edited_url!==this.tabs.selected_url);get url_edited(){return u(this.#s)}set url_edited(e){y(this.#s,e)}constructor(e){super(We,e),this.decoders={tabs:t=>{if(Array.isArray(t)){for(const s of t)this.tabs.add(s);if(!this.tabs.ordered_tabs.find(s=>s.selected)&&this.tabs.ordered_tabs.length>0){const s=this.tabs.ordered_tabs[0];s&&(s.selected=!0)}this.edited_url=this.tabs.selected_url}return oe}},this.init()}navigate_to(e){this.tabs.update_url(e),this.edited_url=e}go_back(){}go_forward(){}refresh(){this.tabs.refresh_selected()}add_new_tab(){this.tabs.add_new_tab(),this.edited_url=this.tabs.selected_url}close_tab(e){this.tabs.close(e),this.edited_url=this.tabs.selected_url}reopen_last_closed_tab(){this.tabs.reopen_last_closed_tab(),this.edited_url=this.tabs.selected_url}select_tab(e){this.tabs.select(e),this.edited_url=this.tabs.selected_url}submit_edited_url(){this.navigate_to(this.edited_url)}reorder_tab(e,t){this.tabs.reorder_tabs(e,t)}}_e(ge);var Xe=P('<div class="iframe_container svelte-hkazk7"><iframe sandbox="allow-scripts allow-popups" class="svelte-hkazk7"></iframe></div>'),Ne=P('<div class="iframe_container svelte-hkazk7"><iframe sandbox="allow-scripts allow-same-origin" class="svelte-hkazk7"></iframe></div>'),Ve=P('<div class="p_lg"><!></div>');function Qe(E,e){te(e,!0);const t=pe(e,"tab",7);function a(z){const g=z.target;try{const l=g.contentDocument?.title;l?.trim()&&l!==t().title&&(t().title=l.trim())}catch(l){console.log("Unable to access iframe content:",l)}}const s=D(()=>t().type==="embedded_html"&&t().content?`<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<style>
		:root {
			color-scheme: light dark;
		}
		body {
			background: light-dark(white, #1a1a1a);
			color: light-dark(#000, #fff);
			margin: 0;
		}
	</style>
</head>
<body>
${t().content}
</body>
</html>`:t().content);var p=O(),h=S(p);Oe(h,()=>t().refresh_counter,z=>{var g=O(),l=S(g);{var _=d=>{var m=Xe(),L=i(m);o(m),J(()=>{I(L,"title",t().title),I(L,"srcdoc",u(s))}),$("load",L,a),be(L),c(d,m)},w=d=>{var m=O(),L=S(m);{var B=f=>{var x=Ne(),k=i(x);o(x),J(()=>{I(k,"title",t().title),I(k,"src",t().url)}),$("load",k,a),be(k),c(f,x)},R=f=>{var x=Ve(),k=i(x);fe(k,()=>e.children),o(x),c(f,x)};U(L,f=>{t().type==="external_url"?f(B):f(R,!1)},!0)}c(d,m)};U(l,d=>{t().type==="embedded_html"?d(_):d(w,!1)})}c(z,g)}),c(E,p),se()}var $e=P('<div><div role="button" tabindex="0"><div class="ellipsis font_weight_400 flex_1"><!> <small class="ml_xs"> </small></div> <button type="button" class="tab_close_button plain icon_button compact border_radius_md ml_sm" title="close tab"><!></button></div></div>');function et(E,e){te(e,!0);var t=$e();let a;var s=i(t);let p;s.__click=()=>e.onselect(e.index),s.__keydown=d=>{(d.key==="Enter"||d.key===" ")&&(q(d),e.onselect(e.index))};var h=i(s),z=i(h);G(z,{glyph:"⎕"});var g=b(z,2),l=i(g,!0);o(g),o(h);var _=b(h,2);_.__click=d=>{q(d),e.onclose(e.index)};var w=i(_);G(w,{get glyph(){return Te}}),o(_),o(s),o(t),J(()=>{a=M(t,1,"browser_tab_container svelte-1qfemsj",null,a,{selected:e.tab.selected}),p=M(s,1,"browser_tab_button border_radius_0 plain px_sm py_xs svelte-1qfemsj",null,p,{selected:e.tab.selected}),I(s,"aria-label",`Tab ${e.tab.title}`),I(s,"aria-pressed",e.tab.selected),ve(l,e.tab.title),I(_,"aria-label",`close tab ${e.tab.title}`)}),c(E,t),se()}ne(["click","keydown"]);var tt=P('<li class="display_flex"><!></li>'),st=P('<div class="browser_container svelte-1xbkv5s"><div class="browser_chrome svelte-1xbkv5s"><ul class="browser_tab_bar unstyled display_flex overflow_x_auto overflow_y_hidden scrollbar_width_thin svelte-1xbkv5s"><!> <div class="p_sm"><button type="button" class="plain ml_xs border_radius_md" title="new tab"><!></button></div></ul> <div class="browser_controls display_flex gap_sm p_xs4"><div class="browser_nav_buttons display_flex gap_xs"><button type="button" class="icon_button plain p_xs border_radius_lg" title="back" disabled><!></button> <button type="button" class="icon_button plain p_xs border_radius_lg" title="forward" disabled><!></button> <button type="button" class="icon_button plain p_xs border_radius_lg" title="refresh"><!></button></div> <div class="browser_address_bar flex_1 svelte-1xbkv5s"><input type="text"/></div> <div class="display_flex gap_xs"><button type="button" class="icon_button plain p_xs" title="main menu">☰</button></div></div></div> <div class="browser_content svelte-1xbkv5s"><!></div></div>');function rt(E,e){te(e,!0);const t=pe(e,"browser",7),a=new Ze({item_class:null});var s=st();$("keydown",ke,r=>{if(!De(r.target)&&(r.ctrlKey&&!r.shiftKey&&!r.altKey&&r.key==="q"&&(q(r),t().add_new_tab()),r.ctrlKey&&r.shiftKey&&r.key==="Q"&&(q(r),t().reopen_last_closed_tab()),r.ctrlKey&&r.altKey&&!r.shiftKey&&r.key==="q")){q(r);const T=t().tabs.ordered_tabs.findIndex(n=>n.selected);T!==-1&&t().close_tab(T)}});var p=i(s),h=i(p),z=i(h);ze(z,19,()=>t().tabs.ordered_tabs,r=>r.id,(r,T,n)=>{var v=tt(),C=i(v);et(C,{get tab(){return u(T)},get index(){return u(n)},onselect:ie=>t().select_tab(ie),onclose:ie=>t().close_tab(ie)}),o(v),ue(v,()=>a.item({index:u(n)})),c(r,v)});var g=b(z,2),l=i(g);l.__click=()=>t().add_new_tab(),Le(l,"",{},{width:"32px","min-width":"32px",height:"32px","min-height":"32px"});var _=i(l);G(_,{get glyph(){return Ae}}),o(l),o(g),o(h),ue(h,()=>a.list({onreorder:(r,T)=>t().reorder_tab(r,T)}));var w=b(h,2),d=i(w),m=i(d);m.__click=()=>t().go_back();var L=i(m);G(L,{get glyph(){return He}}),o(m);var B=b(m,2);B.__click=()=>t().go_forward();var R=i(B);G(R,{get glyph(){return Pe}}),o(B);var f=b(B,2);f.__click=()=>t().refresh();var x=i(f);G(x,{get glyph(){return Be}}),o(f),o(d);var k=b(d,2),A=i(k);Ee(A);let j;o(k);var Y=b(k,2),re=i(Y);re.__click=()=>{alert("not yet, thanks for clicking")},o(Y),o(w),o(p);var W=b(p,2),ae=i(W);{var X=r=>{Qe(r,{get tab(){return t().tabs.selected_tab},children:(T,n)=>{var v=O(),C=S(v);fe(C,()=>e.children),c(T,v)},$$slots:{default:!0}})};U(ae,r=>{t().tabs.selected_tab&&r(X)})}o(W),o(s),J(()=>{j=M(A,1,"width_100 plain svelte-1xbkv5s",null,j,{url_edited:t().url_edited}),I(A,"placeholder",Ie)}),$("keypress",A,r=>{r.key==="Enter"&&t().submit_edited_url()}),Ye(A,()=>t().edited_url,r=>t().edited_url=r),c(E,s),se()}ne(["click"]);var at=P(`<aside>⚠️⚠️ This is just a demo of planned functionality, nothing works like it should. Zzz needs a
				native installation to function like a real browser. Long term, a user-friendly design would
				allow choosing your engine among Chromium, Firefox, Safari, Servo, Ladybird, etc.</aside>`),it=P(`<h1><!> tabs</h1> <section class="width_upto_md"><!> <p>Zzz can be used to build installable apps that extend the web browser, using the form factor
			you already know well -- imagine your current browser, and then add a sidebar on the left like
			the one on this page, then <button type="button"> </button> I'm planning to make a native version of Zzz.</p> <p>And users don't have to buy in, either -- the basic browser UX is unchanged. Press <code>[backtick \`]</code> to <button type="button"><!></button> (that's just the current keybinding, it will probably change, also see the button at the bottom
			left corner of this window)</p> <p>This simple change recontextualizes the web's UX -- instead of the browser being its own silo,
			users compose tabs in a larger integrated system that's open and extensible by design.</p> <p>As a simple example, you could add metadata like tags to both your browser tabs and files,
			both local and in the cloud, so you can find things no matter their type or location. Maybe
			you want to summon UI that leverages that data for specific needs in specific contexts --
			without any technical knowledge, third parties, or unnecessary friction. The best usecases are
			still unknown, and today's browsers weren't designed for LLMs or experimentation at this
			level.</p> <p>I think that by optimizing for UX, Zzz and a lot of software is converging on similar
			architectures. I'm not well-read in The Literature or staying current with the design or
			product communities, but some of my favorite writing is from Ink and Switch: <!> and <!>. I think that we can all have software that's really nice to use, not that expensive to
			produce, that also respects individual rights and is designed for our benefit, that <small class="font_size_xs">UNLEASHES THE FULL POWER OF THE WEB</small>, and integrates our
			experience across the web and our devices how we each prefer.</p></section>`,1),ot=P('<div class="p_lg"><!></div>');function gt(E,e){te(e,!0);const t=l=>{var _=it(),w=S(_),d=i(w);G(d,{get glyph(){return Re}}),F(),o(w);var m=b(w,2),L=i(m);{var B=n=>{var v=at();c(n,v)};U(L,n=>{s.browserified&&n(B)})}var R=b(L,2),f=b(i(R));f.__click=()=>s.browserified=!s.browserified;let x;var k=i(f);o(f),F(),o(R);var A=b(R,2),j=b(i(A),3);let Y;j.__click=()=>{a.ui.toggle_sidebar(),s.browserified||(s.browserified=!0)};var re=i(j);{var W=n=>{var v=N("remember your power");c(n,v)},ae=n=>{var v=N("pretend it's all a dream");c(n,v)};U(re,n=>{a.ui.show_sidebar?n(ae,!1):n(W)})}o(j),F(),o(A);var X=b(A,6),r=b(i(X));he(r,{href:"https://www.inkandswitch.com/local-first/",children:(n,v)=>{F();var C=N("local-first");c(n,C)},$$slots:{default:!0}});var T=b(r,2);he(T,{href:"https://www.inkandswitch.com/malleable-software/",children:(n,v)=>{F();var C=N("malleable software");c(n,C)},$$slots:{default:!0}}),F(3),o(X),o(m),J(()=>{x=M(f,1,"inline compact",null,x,{color_i:!s.browserified,color_h:s.browserified}),ve(k,`${s.browserified?"un":""}browserify!`),Y=M(j,1,"inline compact",null,Y,{color_d:a.ui.show_sidebar,color_f:!a.ui.show_sidebar})}),c(l,_)},a=Ke.get(),s=a.browser??=new ge({app:a,json:{tabs:Je}});var p=O(),h=S(p);{var z=l=>{rt(l,{get browser(){return s},children:(_,w)=>{t(_)},$$slots:{default:!0}})},g=l=>{var _=ot(),w=i(_);t(w),o(_),c(l,_)};U(h,l=>{s.browserified?l(z):l(g,!1)})}c(E,p),se()}ne(["click"]);export{gt as component};
