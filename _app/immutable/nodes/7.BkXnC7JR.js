import"../chunks/DsnmJJEf.js";import{p as Y,c as q,n as I,h as at,b as f,f as x,a as W,s as o,d as e,x as _,y as S,r as a,t as J,e as V,a2 as ot,z as F,L as rt}from"../chunks/-CpFIzHZ.js";import{s as z,d as X}from"../chunks/DzZ7Rzvg.js";import{i as H}from"../chunks/DH5XRg4H.js";import{c as nt,a as it,b as st}from"../chunks/trDA34-_.js";import{s as dt,r as _t,p as M}from"../chunks/Rk-Dv8br.js";import{f as Z}from"../chunks/CtVB41cF.js";import{t as lt,s as ct}from"../chunks/D7AV01aJ.js";import{C as mt,P as vt}from"../chunks/DNrAa8_K.js";import{i as O,g as $,o as ut,C as ft,D as tt,t as ht}from"../chunks/CIQxfFOX.js";import{C as gt,a as bt,b as K}from"../chunks/CCs77x1m.js";import{S as pt,s as Q,a as U}from"../chunks/Dh_Ly8-d.js";import{C as yt}from"../chunks/Bg2OdvGn.js";import{D as xt,T as wt}from"../chunks/Dh57LEha.js";import{a as kt}from"../chunks/COtaM-Gk.js";import{r as Ct}from"../chunks/CF_rgvJJ.js";var Lt=x("<span>delete from history</span>"),Pt=x("<!> <!> <!> <!>",1);function zt(w,t){Y(t,!0);const c=i=>{bt(i,{icon:n=>{O(n,{get glyph(){return $}})},menu:n=>{var v=Pt(),s=W(v);K(s,{get content(){return t.action.method},label:"copy method"});var y=o(s,2);K(y,{get content(){return t.action.id},label:"copy id"});var d=o(y,2);K(d,{content:()=>t.action.json_serialized,label:"copy json data",show_preview:!1});var u=o(d,2);mt(u,{run:()=>{confirm("delete this action from history? that sounds destructive")&&m.actions.items.remove(t.action.id)},icon:l=>{O(l,{get glyph(){return ut}})},children:(l,j)=>{var r=Lt();f(l,r)},$$slots:{icon:!0,default:!0}}),f(n,v)},children:(n,v)=>{I();var s=at("action");f(n,s)},$$slots:{icon:!0,menu:!0,default:!0}})},h=_t(t,["$$slots","$$events","$$legacy","action"]),m=Z.get();gt(w,dt(()=>h,{get entries(){return c}})),q()}var St=x('<button type="button"><div class="font_weight_400 display_flex align_items_center gap_xs width_100"><!> <!> <span class="font_family_mono flex_1 ellipsis"> </span> <!> <small class="font_family_mono ml_auto"> </small></div></button>');function Tt(w,t){Y(t,!0);const c=M(t,"selected",3,!1);zt(w,{get action(){return t.action},children:(h,m)=>{var i=St();let k;i.__click=()=>{t.onselect?.(t.action)};var p=e(i),n=e(p);{let r=S(()=>ft(t.action.method));O(n,{get glyph(){return _(r)}})}var v=o(n,2);{let r=S(()=>tt(t.action.kind));O(v,{get glyph(){return _(r)}})}var s=o(v,2),y=e(s,!0);a(s);var d=o(s,2);{var u=r=>{vt(r,{inline:!0})},C=r=>{var g=V(),L=W(g);{var D=E=>{O(E,{class:"color_c",get glyph(){return ht}})};H(L,E=>{t.action.has_error&&E(D)},!0)}f(r,g)};H(d,r=>{t.action.pending?r(u):r(C,!1)})}var l=o(d,2),j=e(l,!0);a(l),a(p),a(i),J(()=>{k=nt(i,1,"width_100 text_align_left justify_content_start py_xs px_md border_radius_0 border_style_none box_shadow_none",null,k,{selected:c(),color_c:t.action.has_error}),z(y,t.action.method),z(j,t.action.created_formatted_time)}),lt(3,i,()=>ct),f(h,i)},$$slots:{default:!0}}),q()}X(["click"]);var jt=x('<div class="p_sm text_align_center"><small> </small></div>'),At=x("<div><!> <!></div>");function Dt(w,t){Y(t,!0);const c=M(t,"limit",3,20),h=M(t,"selected_action_id",3,null),m=Z.get(),{actions:i}=m,k=S(()=>i.items.size),p=S(()=>i.items.values.slice(0,c()));var n=At();it(n,()=>({...t.attrs,class:`flex_1 unstyled overflow_auto scrollbar_width_thin ${t.attrs?.class??""}`}));var v=e(n);{const d=(C,l=ot)=>{{let j=S(()=>l().id===h());Tt(C,{get action(){return l()},get selected(){return _(j)},get onselect(){return t.onselect}})}};let u=S(()=>[Q("created_newest","newest first","created_date","desc"),Q("created_oldest","oldest first","created_date","asc"),U("method_asc","method (a-z)","method"),U("method_desc","method (z-a)","method","desc")]);pt(v,{get items(){return _(p)},get sorters(){return _(u)},sort_key_default:"created_newest",show_sort_controls:!0,no_items:"",children:d,$$slots:{default:!0}})}var s=o(v,2);{var y=d=>{var u=jt(),C=e(u),l=e(C);a(C),a(u),J(()=>z(l,`Showing ${c()??""} of ${_(k)??""} actions`)),f(d,u)};H(s,d=>{_(k)>c()&&d(y)})}a(n),f(w,n),q()}var Et=x("<tr><td>updated</td><td> </td></tr>"),Gt=x('<tr><td>error</td><td class="font_family_mono color_c"> </td></tr>'),Ot=x('<div class="mb_md"><h3 class="mt_md"><!> </h3> <table><tbody class="font_family_mono"><tr><td>id</td><td> </td></tr><tr><td>created</td><td> </td></tr><!><tr><td>kind</td><td> </td></tr><!></tbody></table></div> <div class="display_flex gap_md mb_sm"><!></div> <pre class="font_family_mono font_size_sm white_space_pre_wrap word_break_break_word p_sm width_100"> </pre>',1);function Ht(w,t){Y(t,!0);var c=Ot(),h=W(c),m=e(h),i=e(m);{let b=S(()=>tt(t.action.kind));O(i,{get glyph(){return _(b)}})}var k=o(i);a(m);var p=o(m,2),n=e(p),v=e(n),s=o(e(v)),y=e(s,!0);a(s),a(v);var d=o(v),u=o(e(d)),C=e(u);a(u),a(d);var l=o(d);{var j=b=>{var G=Et(),R=o(e(G)),B=e(R);a(R),a(G),J(()=>z(B,`${t.action.updated_formatted_datetime??""}
						${t.action.updated_formatted_time??""}`)),f(b,G)};H(l,b=>{t.action.updated_formatted_datetime!==t.action.created_formatted_datetime&&b(j)})}var r=o(l),g=o(e(r)),L=e(g,!0);a(g),a(r);var D=o(r);{var E=b=>{var G=Gt(),R=o(e(G)),B=e(R,!0);a(R),a(G),J(et=>z(B,et),[()=>JSON.stringify(t.action.action_event_data.error)]),f(b,G)};H(D,b=>{t.action.action_event_data?.error&&b(E)})}a(n),a(p),a(h);var P=o(h,2),T=e(P);{let b=S(()=>JSON.stringify(t.action.json,null,2));yt(T,{get text(){return _(b)},class:"plain"})}a(P);var A=o(P,2),N=e(A,!0);a(A),J(b=>{z(k,` ${t.action.method??""}`),z(y,t.action.id),z(C,`${t.action.created_formatted_datetime??""}
					${t.action.created_formatted_time??""}`),z(L,t.action.kind),z(N,b)},[()=>JSON.stringify(t.action.json,null,2)]),f(w,c),q()}var Jt=x("<h1><!> system actions</h1>"),Nt=x('<div class="box height_100"><p>select an action from the list or <button type="button" class="inline color_f">go fish</button> to view its details</p></div>'),Rt=x('<div class="box height_100"><p>no actions yet, <button type="button" class="inline color_d">do something?</button>?</p></div>'),Yt=x(`<div class="column p_lg height_100"><!> <p class="width_upto_md">This page shows the actions that have happened behind the scenes. It's a work in progress and
		not too useful yet. The idea is to make the system visible, auditable, and manipulable.</p> <p class="row gap_sm"><button type="button" class="compact">clear action history</button> <button type="button" class="compact">ping</button></p> <div class="flex_1 display_grid overflow_hidden"><div class="overflow_auto scrollbar_width_thin border_right svelte-122qwj4"><!></div> <div class="panel p_md overflow_auto height_100"><!></div></div></div>`);function qt(w,t){Y(t,!0);const c=kt.get(),h=S(()=>c.actions);let m=rt(null);var i=Yt(),k=e(i);xt(k,{header:g=>{var L=Jt(),D=e(L);O(D,{get glyph(){return $}}),I(),a(L),f(g,L)},children:(g,L)=>{wt(g,{get value(){return c.time.now}})}});var p=o(k,4),n=e(p);n.__click=()=>{_(h).items.clear(),F(m,null)};var v=o(n,2);v.__click=()=>c.api.ping(),a(p);var s=o(p,2);st(s,"",{},{"grid-template-columns":"320px 1fr",gap:"var(--space_md)"});var y=e(s),d=e(y);{let r=S(()=>_(m)?.id);Dt(d,{limit:100,get selected_action_id(){return _(r)},onselect:g=>{F(m,g,!0)}})}a(y);var u=o(y,2),C=e(u);{var l=r=>{Ht(r,{get action(){return _(m)}})},j=r=>{var g=V(),L=W(g);{var D=P=>{var T=Nt(),A=e(T),N=o(e(A));N.__click=()=>{F(m,Ct(_(h).items.values),!0)},I(),a(A),a(T),f(P,T)},E=P=>{var T=Rt(),A=e(T),N=o(e(A));N.__click=()=>{c.api.toggle_main_menu()},I(),a(A),a(T),f(P,T)};H(L,P=>{_(h).items.size>0?P(D):P(E,!1)},!0)}f(r,g)};H(C,r=>{_(m)?r(l):r(j,!1)})}a(u),a(s),a(i),J(()=>n.disabled=!_(h).items.size),f(w,i),q()}X(["click"]);function re(w){qt(w,{})}export{re as component};
