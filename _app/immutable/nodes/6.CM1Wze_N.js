import"../chunks/DsnmJJEf.js";import{p as R,c as Y,n as I,h as at,b as h,f as k,a as W,s as r,d as e,i as c,j as T,r as a,t as H,e as U,m as ot,k as rt,l as K}from"../chunks/DsYFF3e0.js";import{d as V,s as S}from"../chunks/D6t6EFf3.js";import{s as nt,r as it,p as F,i as D}from"../chunks/Nwe5dM3j.js";import{h as O,f as X,p as st,t as _t,N as dt,O as Z,z as lt,k as ct,s as vt}from"../chunks/dRtQjgBD.js";import{f as $}from"../chunks/ChYHAxKB.js";import{t as mt,s as ut}from"../chunks/R2QwTmpq.js";import{C as ft,P as ht}from"../chunks/4X2iJCGk.js";import{C as gt,a as bt,b as B}from"../chunks/BMCZ99yj.js";import{S as pt,s as M,a as Q}from"../chunks/DCN01I-p.js";import{C as yt}from"../chunks/Cxhqr6gh.js";import{D as xt,T as wt}from"../chunks/DA4V8MIL.js";import{a as kt}from"../chunks/DIXdchkG.js";import{r as Ct}from"../chunks/CF_rgvJJ.js";var Pt=k("<span>delete from history</span>"),zt=k("<!> <!> <!> <!>",1);function Lt(u,t){R(t,!0);const i=s=>{bt(s,{icon:n=>{O(n,{get glyph(){return X}})},menu:n=>{var d=zt(),l=W(d);B(l,{get content(){return t.action.method},label:"copy method"});var L=r(l,2);B(L,{get content(){return t.action.id},label:"copy id"});var _=r(L,2);B(_,{content:()=>t.action.json_serialized,label:"copy json data",show_preview:!1});var b=r(_,2);ft(b,{run:()=>{confirm("delete this action from history? that sounds destructive")&&f.actions.items.remove(t.action.id)},icon:v=>{O(v,{get glyph(){return st}})},children:(v,m)=>{var o=Pt();h(v,o)},$$slots:{icon:!0,default:!0}}),h(n,d)},children:(n,d)=>{I();var l=at("action");h(n,l)},$$slots:{icon:!0,menu:!0,default:!0}})},g=it(t,["$$slots","$$events","$$legacy","action"]),f=$.get();gt(u,nt(()=>g,{get entries(){return i}})),Y()}var St=(u,t)=>{t.onselect?.(t.action)},Tt=k('<button type="button"><div class="font_weight_400 display_flex align_items_center gap_xs width_100"><!> <!> <span class="font_family_mono flex_1 ellipsis"> </span> <!> <small class="font_family_mono ml_auto"> </small></div></button>');function jt(u,t){R(t,!0);const i=F(t,"selected",3,!1);Lt(u,{get action(){return t.action},children:(g,f)=>{var s=Tt();let C;s.__click=[St,t];var y=e(s),n=e(y);{let o=T(()=>dt(t.action.method));O(n,{get glyph(){return c(o)}})}var d=r(n,2);{let o=T(()=>Z(t.action.kind));O(d,{get glyph(){return c(o)}})}var l=r(d,2),L=e(l,!0);a(l);var _=r(l,2);{var b=o=>{ht(o,{inline:!0})},P=o=>{var x=U(),j=W(x);{var N=w=>{O(w,{class:"color_c",get glyph(){return lt}})};D(j,w=>{t.action.has_error&&w(N)},!0)}h(o,x)};D(_,o=>{t.action.pending?o(b):o(P,!1)})}var v=r(_,2),m=e(v,!0);a(v),a(y),a(s),H(o=>{C=_t(s,1,"width_100 text_align_left justify_content_start py_xs px_md border_radius_0 border_style_none box_shadow_none",null,C,o),S(L,t.action.method),S(m,t.action.created_formatted_time)},[()=>({selected:i(),color_c:t.action.has_error})]),mt(3,s,()=>ut),h(g,s)},$$slots:{default:!0}}),Y()}V(["click"]);var At=k('<div class="p_sm text_align_center"><small> </small></div>'),Et=k("<div><!> <!></div>");function Ot(u,t){R(t,!0);const i=F(t,"limit",3,20),g=F(t,"selected_action_id",3,null),f=$.get(),{actions:s}=f,C=T(()=>s.items.size),y=T(()=>s.items.values.slice(0,i()));var n=Et();ct(n,()=>({...t.attrs,class:`flex_1 unstyled overflow_auto scrollbar_width_thin ${t.attrs?.class??""}`}));var d=e(n);{const _=(P,v=ot)=>{{let m=T(()=>v().id===g());jt(P,{get action(){return v()},get selected(){return c(m)},get onselect(){return t.onselect}})}};let b=T(()=>[M("created_newest","newest first","created_date","desc"),M("created_oldest","oldest first","created_date","asc"),Q("method_asc","method (a-z)","method"),Q("method_desc","method (z-a)","method","desc")]);pt(d,{get items(){return c(y)},get sorters(){return c(b)},sort_key_default:"created_newest",show_sort_controls:!0,no_items:"",children:_,$$slots:{default:!0}})}var l=r(d,2);{var L=_=>{var b=At(),P=e(b),v=e(P);a(P),a(b),H(()=>S(v,`Showing ${i()??""} of ${c(C)??""} actions`)),h(_,b)};D(l,_=>{c(C)>i()&&_(L)})}a(n),h(u,n),Y()}var Dt=k("<tr><td>updated</td><td> </td></tr>"),Gt=k('<tr><td>error</td><td class="font_family_mono color_c"> </td></tr>'),Ht=k('<div class="mb_md"><h3 class="mt_md"><!> </h3> <table><tbody class="font_family_mono"><tr><td>id</td><td> </td></tr><tr><td>created</td><td> </td></tr><!><tr><td>kind</td><td> </td></tr><!></tbody></table></div> <div class="display_flex gap_md mb_sm"><!></div> <pre class="font_family_mono font_size_sm white_space_pre_wrap word_break_break_word p_sm width_100"> </pre>',1);function Nt(u,t){R(t,!0);var i=Ht(),g=W(i),f=e(g),s=e(f);{let p=T(()=>Z(t.action.kind));O(s,{get glyph(){return c(p)}})}var C=r(s);a(f);var y=r(f,2),n=e(y),d=e(n),l=r(e(d)),L=e(l,!0);a(l),a(d);var _=r(d),b=r(e(_)),P=e(b);a(b),a(_);var v=r(_);{var m=p=>{var E=Dt(),J=r(e(E)),q=e(J);a(J),a(E),H(()=>S(q,`${t.action.updated_formatted_datetime??""}
						${t.action.updated_formatted_time??""}`)),h(p,E)};D(v,p=>{t.action.updated_formatted_datetime!==t.action.created_formatted_datetime&&p(m)})}var o=r(v),x=r(e(o)),j=e(x,!0);a(x),a(o);var N=r(o);{var w=p=>{var E=Gt(),J=r(e(E)),q=e(J,!0);a(J),a(E),H(et=>S(q,et),[()=>JSON.stringify(t.action.action_event_data.error)]),h(p,E)};D(N,p=>{t.action.action_event_data?.error&&p(w)})}a(n),a(y),a(g);var z=r(g,2),A=e(z);{let p=T(()=>JSON.stringify(t.action.json,null,2));yt(A,{get text(){return c(p)},attrs:{class:"plain"}})}a(z);var G=r(z,2),tt=e(G,!0);a(G),H(p=>{S(C,` ${t.action.method??""}`),S(L,t.action.id),S(P,`${t.action.created_formatted_datetime??""}
					${t.action.created_formatted_time??""}`),S(j,t.action.kind),S(tt,p)},[()=>JSON.stringify(t.action.json,null,2)]),h(u,i),Y()}var Jt=k("<h1><!> system actions</h1>"),Rt=(u,t,i)=>{c(t).items.clear(),K(i,null)},Yt=(u,t,i)=>{K(t,Ct(c(i).items.values),!0)},It=k('<div class="box height_100"><p>select an action from the list or <button type="button" class="inline color_f">go fish</button> to view its details</p></div>'),Wt=(u,t)=>{t.api.toggle_main_menu()},qt=k('<div class="box height_100"><p>no actions yet, <button type="button" class="inline color_d">do something?</button>?</p></div>'),Bt=k(`<div class="column p_lg height_100"><!> <p class="width_upto_md">This page shows the actions that have happened behind the scenes. It's a work in progress and
		not too useful yet. The idea is to make the system visible, auditable, and manipulable.</p> <p><button type="button" class="compact">clear action history</button></p> <div class="flex_1 display_grid overflow_hidden"><div class="overflow_auto scrollbar_width_thin border_right svelte-1xl34lf"><!></div> <div class="panel p_md overflow_auto height_100"><!></div></div></div>`);function Ft(u,t){R(t,!0);const i=kt.get(),g=T(()=>i.actions);let f=rt(null);var s=Bt(),C=e(s);xt(C,{header:o=>{var x=Jt(),j=e(x);O(j,{get glyph(){return X}}),I(),a(x),h(o,x)},children:(o,x)=>{wt(o,{get value(){return i.time.now}})}});var y=r(C,4),n=e(y);n.__click=[Rt,g,f],a(y);var d=r(y,2);vt(d,"",{},{"grid-template-columns":"320px 1fr",gap:"var(--space_md)"});var l=e(d),L=e(l);{let m=T(()=>c(f)?.id);Ot(L,{limit:100,get selected_action_id(){return c(m)},onselect:o=>{K(f,o,!0)}})}a(l);var _=r(l,2),b=e(_);{var P=m=>{Nt(m,{get action(){return c(f)}})},v=m=>{var o=U(),x=W(o);{var j=w=>{var z=It(),A=e(z),G=r(e(A));G.__click=[Yt,f,g],I(),a(A),a(z),h(w,z)},N=w=>{var z=qt(),A=e(z),G=r(e(A));G.__click=[Wt,i],I(),a(A),a(z),h(w,z)};D(x,w=>{c(g).items.size>0?w(j):w(N,!1)},!0)}h(m,o)};D(b,m=>{c(f)?m(P):m(v,!1)})}a(_),a(d),a(s),H(()=>n.disabled=!c(g).items.size),h(u,s),Y()}V(["click"]);function ie(u){Ft(u,{})}export{ie as component};
