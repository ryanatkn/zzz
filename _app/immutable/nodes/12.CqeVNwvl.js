import"../chunks/DsnmJJEf.js";import{d as se,s as N,a as Pe,b as Ee,e as Le}from"../chunks/D6t6EFf3.js";import{p as B,f as h,d as s,i as a,j as I,r as i,b as f,c as J,e as $,a as C,s as u,m as Re,t as K,k as ae,a7 as me,g as fe,l as O,u as ze,v as He,ah as Ge,n as be}from"../chunks/DsYFF3e0.js";import{i as A}from"../chunks/Nwe5dM3j.js";import{h as q,X as Te,Y as Oe,Z as Ye,t as _e,J as je,b as Ae,j as ke,q as oe,o as Fe,P as Ie,l as Se,w as Ce,E as Ke,I as pe}from"../chunks/dRtQjgBD.js";import{s as ie,i as Me}from"../chunks/BlUH4YWX.js";import{r as Ne}from"../chunks/CF_rgvJJ.js";import{P as ye}from"../chunks/4X2iJCGk.js";import{f as ee,h as Ve}from"../chunks/ChYHAxKB.js";import{t as W,s as te,f as qe,b as We}from"../chunks/R2QwTmpq.js";import{P as ge}from"../chunks/td2F1UoZ.js";import{a as Be,b as we,D as Je}from"../chunks/CPf3P_HK.js";import{S as Qe,a as he,s as le}from"../chunks/DCN01I-p.js";import{b as Ue}from"../chunks/BwYh6stK.js";import{D as Xe,f as Ze,h as $e,i as et,j as tt}from"../chunks/DcGg3-OB.js";import{r as at,D as ve}from"../chunks/z7712QSE.js";import{P as it}from"../chunks/CUoH4DM0.js";import{R as st}from"../chunks/D7jkYwLB.js";import{E as rt}from"../chunks/BBNa1a7U.js";var lt=h("<div>&nbsp;</div>"),ot=h('<div class="row height_input_height"><!></div>'),_t=(d,e)=>e.toggle_sort_controls(),nt=h('<button type="button" title="toggle sort controls"><!></button>'),dt=h("<div><!></div>"),ct=h('<div class="row height_input_height justify_content_space_between px_xs"><small class="ellipsis"><!> </small> <div class="display_flex gap_xs2"><!> <!> <!></div></div> <!> <!>',1),vt=h('<div class="height_100 overflow_auto scrollbar_width_thin"><!></div>');function ft(d,e){B(e,!0);const c=ee.get(),{diskfiles:t}=c,{editor:r}=t,o=I(()=>c.zzz_cache_dir),v=!1,_=!1,l=async()=>{if(!a(o)){alert("cannot create file: filesystem is not available");return}const w=prompt("new file name:");if(w)try{await t.create_file(w)}catch(p){console.error("failed to create file:",p),alert(`failed to create file: ${p}`)}},b=async()=>{if(!a(o)){alert("cannot create folder: filesystem is not available");return}const w=prompt("New folder name:");if(w)try{await t.create_directory(w)}catch(p){console.error("failed to create folder:",p),alert(`failed to create folder: ${p}`)}};var y=vt(),x=s(y);{var Y=w=>{var p=lt();f(w,p)},D=w=>{var p=$(),n=C(p);{var m=L=>{var T=ot(),R=s(T);ye(R,{}),i(T),f(L,T)},H=L=>{var T=ct(),R=C(T),g=s(R),k=s(g);q(k,{get glyph(){return Te}});var F=u(k);i(g);var V=u(g,2),Q=s(V);ge(Q,{pending:v,attrs:{class:"plain compact"},get title(){return`create file in ${a(o)??""}`},onclick:l,children:(z,G)=>{q(z,{get glyph(){return Oe}})},$$slots:{default:!0}});var re=u(Q,2);ge(re,{pending:_,attrs:{class:"plain compact"},get title(){return`create folder in ${a(o)??""}`},onclick:b,children:(z,G)=>{q(z,{get glyph(){return Ye}})},$$slots:{default:!0}});var ne=u(re,2);{var de=z=>{var G=nt();let P;G.__click=[_t,r];var E=s(G);q(E,{get glyph(){return je}}),i(G),K(M=>P=_e(G,1,"plain compact selectable deselectable",null,P,M),[()=>({selected:r.show_sort_controls})]),f(z,G)};A(ne,z=>{c.diskfiles.items.size>1&&z(de)})}i(V),i(R);var j=u(R,2);{const z=(E,M=Re)=>{const X=I(()=>t.selected_file_id===M().id);var Z=dt();let ue;var xe=s(Z);Be(xe,{get diskfile(){return M()},get selected(){return a(X)},onselect:(ce,De)=>{t.select(ce.id,De)}}),i(Z),K(ce=>ue=_e(Z,1,"diskfile_listitem_wrapper svelte-1wyuni",null,ue,ce),[()=>({selected:a(X)})]),W(3,Z,()=>te),f(E,Z)};let G=I(()=>[he("path_asc","path (a-z)","path_relative"),he("path_desc","path (z-a)","path_relative","desc"),le("updated_newest","updated (latest)","updated","desc"),le("updated_oldest","updated (past)","updated","asc"),le("created_newest","created (newest)","created","desc"),le("created_oldest","created (oldest)","created","asc")]),P=I(()=>e.empty?void 0:"[no files available]");Qe(j,{get items(){return t.items.values},get show_sort_controls(){return r.show_sort_controls},get sorters(){return a(G)},sort_key_default:"path_asc",get no_items(){return a(P)},children:z,$$slots:{default:!0}})}var S=u(j,2);{var U=z=>{var G=$(),P=C(G);Pe(P,()=>e.empty),f(z,G)};A(S,z=>{e.empty&&t.items.size===0&&z(U)})}K(()=>N(F,` ${a(o)??""}`)),f(L,T)};A(n,L=>{a(o)===null?L(m):L(H,!1)},!0)}f(w,p)};A(x,w=>{a(o)===void 0?w(Y):w(D,!1)})}i(y),f(d,y),J()}se(["click"]);var ut=h("<div> </div>"),mt=h('<small class="font_family_mono"><div> </div> <div> </div></small>'),bt=h('<div class="display_flex flex_direction_column gap_xs width_100"><small class="overflow_wrap_break_all width_100"><!> </small> <small><div> </div> <!></small> <!> <!> <small class="font_family_mono"> </small></div>');function pt(d,e){B(e,!0);const c=ee.get();var t=bt(),r=s(t),o=s(r);q(o,{get glyph(){return Ae}});var v=u(o,1,!0);i(r);var _=u(r,2),l=s(_),b=s(l);i(l);var y=u(l,2);{var x=m=>{var H=ut(),L=s(H);i(H),K(()=>N(L,`updated ${e.diskfile.updated_formatted_datetime??""}`)),W(3,H,()=>te),f(m,H)};A(y,m=>{e.diskfile.updated_formatted_datetime!==e.diskfile.created_formatted_datetime&&m(x)})}i(_);var Y=u(_,2);Xe(Y,{get editor_state(){return e.editor_state}});var D=u(Y,2);{var w=m=>{var H=mt(),L=s(H),T=s(L);i(L);var R=u(L,2),g=s(R);i(R),i(H),K(()=>{N(T,`${e.diskfile.dependencies_count??""} dependencies`),N(g,`${e.diskfile.dependents_count??""} dependents`)}),W(3,H,()=>te),f(m,H)};A(D,m=>{Ve(e.diskfile)&&m(w)})}var p=u(D,2),n=s(p,!0);i(p),i(t),K(m=>{N(v,m),N(b,`created ${e.diskfile.created_formatted_datetime??""}`),N(n,e.diskfile.id)},[()=>c.diskfiles.to_relative_path(e.diskfile.path)]),f(d,t),J()}var gt=h('<a class="prompt_ref svelte-1ybw3jw"> </a>'),ht=h('<div class="prompt_refs font_size_xs mt_xs2 svelte-1ybw3jw"><span class="text_color_5"> </span> <!></div>'),kt=h('<div class="panel p_md"><h3 class="mt_0 mb_sm">Referenced by part</h3> <div class="column gap_xs"><div class="part_reference svelte-1ybw3jw"><!> <!></div></div></div>');function yt(d,e){B(e,!0);const c=ee.get(),t=I(()=>e.diskfile.part),r=I(()=>a(t)?c.prompts.filter_by_part(a(t)):null);var o=$(),v=C(o);{var _=l=>{var b=kt(),y=u(s(b),2),x=s(y),Y=s(x);it(Y,{get part(){return a(t)}});var D=u(Y,2);{var w=p=>{var n=ht(),m=s(n),H=s(m);i(m);var L=u(m,2);ke(L,17,()=>a(r),T=>T.id,(T,R)=>{var g=gt(),k=s(g,!0);i(g),K(F=>{oe(g,"href",F),N(k,a(R).name)},[()=>at(`/prompts/${a(R).id}`)]),f(T,g)}),i(n),K(()=>N(H,`In prompt${a(r).length!==1?"s":""}:`)),f(p,n)};A(D,p=>{a(r)?.length&&p(w)})}i(x),i(y),i(b),W(3,b,()=>te),f(l,b)};A(v,l=>{a(t)&&l(_)})}f(d,o),J()}const wt=(d,e,c,t,r,o)=>{if(!a(e))return;const v=a(c)[0],_=a(c).slice(1);a(t)&&O(r,[a(t),...a(r)],!0),O(c,_,!0);const l=o.tabs.navigate_to_tab(v);l.resulting_tab_id&&(l.resulting_tab_id!==v?(O(t,l.resulting_tab_id,!0),O(r,a(r).map(b=>b===v?l.resulting_tab_id:b),!0)):O(t,l.resulting_tab_id,!0))},xt=(d,e,c,t,r,o)=>{if(!a(e))return;const v=a(c)[0],_=a(c).slice(1);a(t)&&O(r,[a(t),...a(r)],!0),O(c,_,!0);const l=o.tabs.navigate_to_tab(v);l.resulting_tab_id&&(l.resulting_tab_id!==v?(O(t,l.resulting_tab_id,!0),O(r,a(r).map(b=>b===v?l.resulting_tab_id:b),!0)):O(t,l.resulting_tab_id,!0))};var Dt=(d,e)=>{e.editor_state},Pt=h('<div class="browser_nav display_flex gap_xs svelte-1rt089y"><button type="button" class="icon_button plain p_xs border_radius_lg" title="previous diskfile"><!></button> <button type="button" class="icon_button plain p_xs border_radius_lg" title="next diskfile"><!></button> <button type="button" class="icon_button plain p_xs border_radius_lg" title="refresh from disk" disabled><!></button></div>');function Et(d,e){B(e,!0);const c=ee.get(),{diskfiles:t}=c,{editor:r}=t;let o=ae(me([])),v=ae(me([])),_=ae(null);fe(()=>{r.tabs.selected_tab_id&&a(_)===null&&O(_,r.tabs.selected_tab_id,!0)}),fe(()=>{const m=r.tabs.selected_tab_id;m&&m!==a(_)&&(a(_)&&O(o,[a(_),...a(o)],!0),O(v,[],!0),O(_,m,!0))});const l=I(()=>a(o).length>0),b=I(()=>a(v).length>0);var y=Pt(),x=s(y);x.__click=[wt,l,o,_,v,r];var Y=s(x);q(Y,{get glyph(){return Fe}}),i(x);var D=u(x,2);D.__click=[xt,b,v,_,o,r];var w=s(D);q(w,{get glyph(){return Ie}}),i(D);var p=u(D,2);p.__click=[Dt,e];var n=s(p);q(n,{get glyph(){return Se}}),i(p),i(y),K(()=>{x.disabled=!a(l),D.disabled=!a(b)}),f(d,y),J()}se(["click"]);var Lt=h(`<div class="pt_lg"><div><aside><p>⚠️ This filesystem interface is an early proof of concept and lacks most features you'd
					expect. Some basics work if you're using this with Node, and there will be more soon.
					Chatting creates files, and you can modify and save them, and see the edit history.</p> <button type="button" class="compact">ok</button></aside></div></div>`);function Rt(d,e){B(e,!0);const c=ee.get();var t=$(),r=C(t);{var o=v=>{var _=Lt(),l=s(_),b=s(l),y=u(s(b),2);y.__click=()=>{c.ui.tutorial_for_diskfiles=!1},i(b),i(l),i(_),W(2,b,()=>qe,()=>({duration:ve,x:10,y:-1})),W(2,l,()=>We,()=>({duration:ve})),W(2,_,()=>te,()=>({delay:ve})),f(v,_)};A(r,v=>{c.ui.tutorial_for_diskfiles&&v(o)})}f(d,t),J()}se(["click"]);var zt=h("<div><!></div>"),Ht=h('<div class="display_flex height_100"><div class="flex_1 width_atleast_sm height_100 column"><!></div> <div class="width_upto_sm width_atleast_sm py_md"><div class="px_md mb_lg"><!></div> <div class="px_md mb_lg"><!></div> <div class="px_md mb_lg"><!></div> <!> <!> <div class="px_md"><!></div></div></div>');function Gt(d,e){B(e,!0);const c=ee.get(),t=new Ze({app:c,diskfile:e.diskfile});let r=ae(void 0);ze(()=>{t.content_was_modified_by_user&&e.onmodified?.(e.diskfile.id)}),fe(()=>{const o=e.diskfile.id,v=e.diskfile.content;He(()=>{t.diskfile.id!==o?t.update_diskfile(e.diskfile):v!==t.last_seen_disk_content&&t.check_disk_changes()})}),we(d,{get diskfile(){return e.diskfile},children:(o,v)=>{var _=Ht(),l=s(_),b=s(l);{let g=I(()=>Ce+" "+e.diskfile.path_relative);Ue($e(b,{get token_count(){return t.current_token_count},get placeholder(){return a(g)},readonly:!1,attrs:{class:"height_100 border_radius_0"},onsave:async k=>{await c.diskfiles.update(e.diskfile.path,k)},get content(){return t.current_content},set content(k){t.current_content=k}}),k=>O(r,k,!0),()=>a(r))}i(l);var y=u(l,2),x=s(y),Y=s(x);et(Y,{get diskfile(){return e.diskfile},get editor_state(){return t}}),i(x);var D=u(x,2),w=s(D);Et(w,{get editor_state(){return t}}),i(D);var p=u(D,2),n=s(p);pt(n,{get diskfile(){return e.diskfile},get editor_state(){return t}}),i(p);var m=u(p,2);{var H=g=>{var k=zt(),F=s(k);tt(F,{get editor_state(){return t},onselectentry:V=>{t.set_content_from_history(V),a(r)?.focus()}}),i(k),W(3,k,()=>te),f(g,k)};A(m,g=>{t.has_history&&g(H)})}var L=u(m,2);yt(L,{get diskfile(){return e.diskfile}});var T=u(L,2),R=s(T);Rt(R,{}),i(T),i(y),i(_),f(o,_)},$$slots:{default:!0}}),J()}var Tt=(d,e)=>{ie(d),e.tab.is_preview&&d.detail===2?e.onopen(e.tab):e.onselect(e.tab)},Ot=(d,e)=>{(d.key==="Enter"||d.key===" ")&&(ie(d),e.onselect(e.tab))},Yt=(d,e)=>{ie(d),e.onclose(e.tab)},jt=h('<div><div role="button" tabindex="0"><div class="ellipsis font_weight_400 flex_1"><small class="ml_xs"> </small></div> <button type="button" class="tab_close_button plain icon_button compact border_radius_md ml_sm" title="close tab"><!></button></div></div>');function At(d,e){B(e,!0);const c=I(()=>e.tab.diskfile),t=I(()=>a(c)?.path_relative??"[no diskfile found]");we(d,{get diskfile(){return a(c)},children:(r,o)=>{var v=jt();let _;var l=s(v);let b;l.__click=[Tt,e],l.__keydown=[Ot,e];var y=s(l),x=s(y),Y=s(x,!0);i(x),i(y);var D=u(y,2);D.__click=[Yt,e];var w=s(D);q(w,{get glyph(){return Ke}}),i(D),i(l),i(v),K((p,n)=>{_=_e(v,1,"diskfile_tab_container svelte-ntjzt6",null,_,p),b=_e(l,1,"diskfile_tab_button border_radius_0 plain px_sm py_xs svelte-ntjzt6",null,b,n),oe(l,"aria-label",`Tab ${a(t)}`),oe(l,"aria-pressed",e.tab.is_selected),N(Y,a(t)),oe(D,"aria-label",`close tab ${a(t)}`)},[()=>({selected:e.tab.is_selected,preview:e.tab.is_preview}),()=>({selected:e.tab.is_selected,preview:e.tab.is_preview})]),f(r,v)},$$slots:{default:!0}}),J()}se(["click","keydown"]);const Ft=async(d,e,c)=>{if(!e.zzz_cache_dir){alert("cannot create file: filesystem is not available");return}const t=prompt("new file name:");if(t)try{await c.create_file(t)}catch(r){console.error("failed to create file:",r),alert(`failed to create file: ${r}`)}};var It=(d,e)=>e.check_backend(),St=h(`<p>Filesystem is not available. File management requires a backend connection with
						filesystem access.</p> <p class="mt_md"><button type="button">retry connection</button></p>`,1),Ct=h('<div class="box height_100 width_100"><div class="width_upto_sm"><!></div></div>'),Kt=h('<div class="box height_100 width_100 display_flex align_items_center justify_content_center"><div class="text_align_center"><p class="mt_md">loading filesystem <!></p></div></div>'),Mt=h('<li class="display_flex py_xs3 px_xs4"><div class="display_flex"><!></div></li>'),Nt=h('<div class="box height_100"><p>Something went wrong, this tab has no diskfile</p></div>'),Vt=(d,e)=>{O(e,!0)},qt=(d,e,c)=>{const t=Ne(e.diskfiles.items.values);c.select(t.id)},Wt=h('<div class="box height_100"><p><button type="button" class="inline">select</button> a file from the list or <button type="button" class="inline color_f">go fish</button> to view and edit its content</p></div>'),Bt=h('<div class="box height_100"><p>no files yet, <button type="button" class="inline color_d">create a new file</button>?</p></div>'),Jt=h('<div class="height_100 overflow_hidden width_upto_sm"><!></div> <div class="flex_1 column overflow_auto height_100"><menu class="unstyled display_flex overflow_x_auto scrollbar_width_thin"></menu> <!></div>',1),Qt=h('<div class="height_100 display_flex"><!></div> <!>',1);function Ut(d,e){B(e,!0);const c=ee.get(),{diskfiles:t,capabilities:r}=c,{editor:o}=t,v=new st({item_class:null}),_=I(()=>o.tabs.selected_tab),l=I(()=>a(_)?t.items.by_id.get(a(_).diskfile_id):void 0);let b=ae(!1);Ee(()=>{r.init_backend_check()});var y=Qt();Le("keydown",Ge,n=>{if(!Me(n.target)){if(n.ctrlKey&&!n.shiftKey&&!n.altKey&&n.key==="q"){ie(n);const m=o.tabs.selected_tab;m&&o.close_tab(m.id)}n.ctrlKey&&n.shiftKey&&n.key==="Q"&&(ie(n),o.reopen_last_closed_tab())}});var x=C(y),Y=s(x);{var D=n=>{var m=Ct(),H=s(m),L=s(H);rt(L,{children:(T,R)=>{var g=St(),k=u(C(g),2),F=s(k);F.__click=[It,r],i(k),K(()=>F.disabled=r.backend.status==="pending"),f(T,g)},$$slots:{default:!0}}),i(H),i(m),f(n,m)},w=n=>{var m=$(),H=C(m);{var L=R=>{var g=Kt(),k=s(g),F=s(k),V=u(s(F));ye(V,{inline:!0}),i(F),i(k),i(g),f(R,g)},T=R=>{var g=Jt(),k=C(g),F=s(k);ft(F,{}),i(k);var V=u(k,2),Q=s(V);ke(Q,23,()=>o.tabs.ordered_tabs,j=>j.id,(j,S,U)=>{var z=Mt(),G=s(z),P=s(G);At(P,{get tab(){return a(S)},onselect:E=>t.select(E.diskfile_id),onclose:E=>{E.diskfile_id===a(l)?.id&&t.select(null),o.close_tab(E.id)},onopen:E=>o.open_tab(E.id)}),i(G),pe(G,()=>v.item({index:a(U)})),i(z),f(j,z)}),i(Q),pe(Q,()=>v.list({onreorder:(j,S)=>o.reorder_tabs(j,S)}));var re=u(Q,2);{var ne=j=>{var S=$(),U=C(S);{var z=P=>{Gt(P,{get diskfile(){return a(l)},onmodified:E=>o.handle_file_modified(E)})},G=P=>{var E=Nt();f(P,E)};A(U,P=>{a(l)?P(z):P(G,!1)})}f(j,S)},de=j=>{var S=$(),U=C(S);{var z=P=>{var E=Wt(),M=s(E),X=s(M);X.__click=[Vt,b];var Z=u(X,2);Z.__click=[qt,c,t],be(),i(M),i(E),f(P,E)},G=P=>{var E=Bt(),M=s(E),X=u(s(M));X.__click=[Ft,c,t],be(),i(M),i(E),f(P,E)};A(U,P=>{t.items.size>0?P(z):P(G,!1)},!0)}f(j,S)};A(re,j=>{a(_)?j(ne):j(de,!1)})}i(V),f(R,g)};A(H,R=>{r.filesystem_available===null||r.filesystem_available===void 0?R(L):R(T,!1)},!0)}f(n,m)};A(Y,n=>{r.filesystem_available===!1?n(D):n(w,!1)})}i(x);var p=u(x,2);Je(p,{onpick:n=>n?(t.select(n.id),!0):!1,get show(){return a(b)},set show(n){O(b,n,!0)}}),f(d,y),J()}se(["click"]);function ba(d){Ut(d,{})}export{ba as component};
